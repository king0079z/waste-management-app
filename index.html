<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Autonautics Smart Waste Management - Powered by AI</title>
    
    <!-- Prevent Microsoft/Outlook credential manager popups -->
    <meta name="ms-credential-manager" content="off">
    <meta name="msapplication-config" content="none">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="credential-manager" content="disabled">
    <meta name="password-manager" content="disabled">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    
    <!-- Font Awesome CDN with Multiple Fallbacks -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" onload="window.__fontAwesomeLoaded=true" onerror="console.warn('Font Awesome failed to load')">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" crossorigin="anonymous" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.0/css/all.css" crossorigin="anonymous" media="print" onload="this.media='all'">
    
    <!-- Enhanced Messaging System CSS -->
    <link rel="stylesheet" href="messaging-styles.css">
    
    <!-- Enhanced Driver System Styles -->
    <link rel="stylesheet" href="ENHANCED_DRIVER_STYLES.css">
    <link rel="stylesheet" href="driver-mobile-nav.css">
    
    <!-- Inline Font Awesome CSS Fallback for offline/CORS issues -->
    <style>
        /* Basic Font Awesome icon styles for fallback */
        .fas, .fa-solid { 
            font-family: 'Font Awesome 6 Free', sans-serif; 
            font-weight: 900; 
            display: inline-block;
            font-style: normal;
            font-variant: normal;
            text-rendering: auto;
            line-height: 1;
        }
        
        /* Comprehensive Fallback icons using Unicode symbols */
        .fa-chart-line::before { content: 'ğŸ“ˆ'; }
        .fa-tachometer-alt::before { content: 'âš¡'; }
        .fa-crystal-ball::before { content: 'ğŸ”®'; }
        .fa-cogs::before { content: 'âš™ï¸'; }
        .fa-leaf::before { content: 'ğŸŒ¿'; }
        .fa-dollar-sign::before { content: '$'; }
        .fa-truck::before { content: 'ğŸš›'; }
        .fa-user::before { content: 'ğŸ‘¤'; }
        .fa-map::before { content: 'ğŸ—ºï¸'; }
        .fa-bell::before { content: 'ğŸ””'; }
        .fa-home::before { content: 'ğŸ '; }
        .fa-search::before { content: 'ğŸ”'; }
        
        /* Additional icons for driver and system functionality */
        .fa-cube::before { content: 'ğŸ“¦'; }
        .fa-user-tie::before { content: 'ğŸ‘”'; }
        .fa-user-shield::before { content: 'ğŸ›¡ï¸'; }
        .fa-sign-in-alt::before { content: 'ğŸšª'; }
        .fa-sign-out-alt::before { content: 'ğŸšª'; }
        .fa-wrench::before { content: 'ğŸ”§'; }
        
        /* Map clustering styles */
        .marker-cluster {
            background: rgba(110, 204, 57, 0.8);
            border-radius: 50%;
            text-align: center;
            font-weight: bold;
            color: white;
            border: 2px solid rgba(110, 204, 57, 1);
        }
        
        .cluster-small {
            background: rgba(81, 163, 81, 0.9);
            width: 30px;
            height: 30px;
            line-height: 30px;
            font-size: 12px;
        }
        
        .cluster-medium {
            background: rgba(241, 128, 23, 0.9);
            width: 40px;
            height: 40px;
            line-height: 40px;
            font-size: 14px;
        }
        
        .cluster-large {
            background: rgba(253, 56, 56, 0.9);
            width: 50px;
            height: 50px;
            line-height: 50px;
            font-size: 16px;
        }
        .fa-info-circle::before { content: 'â„¹ï¸'; }
        .fa-user-plus::before { content: 'â•'; }
        .fa-satellite-dish::before { content: 'ğŸ“¡'; }
        .fa-sync::before { content: 'ğŸ”„'; }
        .fa-cloud-upload-alt::before { content: 'â˜ï¸'; }
        .fa-route::before { content: 'ğŸ›£ï¸'; }
        .fa-trash::before { content: 'ğŸ—‘ï¸'; }
        .fa-gas-pump::before { content: 'â›½'; }
        .fa-star::before { content: 'â­'; }
        .fa-play-circle::before { content: 'â–¶ï¸'; }
        .fa-chevron-right::before { content: 'â–º'; }
        .fa-chevron-left::before { content: 'â—„'; }
        .fa-chevron-down::before { content: 'â–¼'; }
        .fa-chevron-up::before { content: 'â–²'; }
        .fa-times::before { content: 'âŒ'; }
        .fa-check::before { content: 'âœ…'; }
        .fa-plus::before { content: 'â•'; }
        .fa-minus::before { content: 'â–'; }
        .fa-edit::before { content: 'âœï¸'; }
        .fa-trash-alt::before { content: 'ğŸ—‘ï¸'; }
        .fa-eye::before { content: 'ğŸ‘ï¸'; }
        .fa-download::before { content: 'â¬‡ï¸'; }
        .fa-upload::before { content: 'â¬†ï¸'; }
        .fa-calendar::before { content: 'ğŸ“…'; }
        .fa-clock::before { content: 'ğŸ•’'; }
        .fa-location-arrow::before { content: 'ğŸ“'; }
        .fa-map-marker-alt::before { content: 'ğŸ“'; }
        .fa-phone::before { content: 'ğŸ“'; }
        .fa-envelope::before { content: 'âœ‰ï¸'; }
        .fa-warning::before { content: 'âš ï¸'; }
        .fa-exclamation-triangle::before { content: 'âš ï¸'; }
        .fa-exclamation-circle::before { content: 'â—'; }
        
        /* AI/ML and Analytics Specific Icons */
        .fa-brain::before { content: 'ğŸ§ '; }
        .fa-robot::before { content: 'ğŸ¤–'; }
        .fa-microchip::before { content: 'ğŸ”¬'; }
        .fa-network-wired::before { content: 'ğŸŒ'; }
        .fa-database::before { content: 'ğŸ—„ï¸'; }
        .fa-server::before { content: 'ğŸ–¥ï¸'; }
        .fa-chart-bar::before { content: 'ğŸ“Š'; }
        .fa-chart-pie::before { content: 'ğŸ¥§'; }
        .fa-chart-area::before { content: 'ğŸ“ˆ'; }
        .fa-analytics::before { content: 'ğŸ“Š'; }
        .fa-lightbulb::before { content: 'ğŸ’¡'; }
        .fa-atom::before { content: 'âš›ï¸'; }
        .fa-flask::before { content: 'ğŸ§ª'; }
        .fa-microscope::before { content: 'ğŸ”¬'; }
        .fa-cpu::before { content: 'âš™ï¸'; }
        .fa-memory::before { content: 'ğŸ’¾'; }
        
        /* Navigation and UI Icons */
        .fa-city::before { content: 'ğŸ™ï¸'; }
        .fa-users::before { content: 'ğŸ‘¥'; }
        .fa-smile::before { content: 'ğŸ˜Š'; }
        .fa-frown::before { content: 'ğŸ˜'; }
        .fa-meh::before { content: 'ğŸ˜'; }
        .fa-history::before { content: 'â°'; }
        .fa-qrcode::before { content: 'â¬œ'; }
        .fa-coffee::before { content: 'â˜•'; }
        .fa-power-off::before { content: 'â»'; }
        .fa-settings::before { content: 'âš™ï¸'; }
        .fa-gear::before { content: 'âš™ï¸'; }
        
        /* Status and Action Icons */
        .fa-check-circle::before { content: 'âœ…'; }
        .fa-times-circle::before { content: 'âŒ'; }
        .fa-play::before { content: 'â–¶ï¸'; }
        .fa-pause::before { content: 'â¸ï¸'; }
        .fa-stop::before { content: 'â¹ï¸'; }
        .fa-refresh::before { content: 'ğŸ”„'; }
        .fa-sync-alt::before { content: 'ğŸ”„'; }
        .fa-undo::before { content: 'â†¶'; }
        .fa-redo::before { content: 'â†·'; }
        .fa-save::before { content: 'ğŸ’¾'; }
        .fa-print::before { content: 'ğŸ–¨ï¸'; }
        .fa-share::before { content: 'ğŸ“¤'; }
        .fa-copy::before { content: 'ğŸ“‹'; }
        .fa-cut::before { content: 'âœ‚ï¸'; }
        .fa-paste::before { content: 'ğŸ“‹'; }
        
        /* Map and Location Icons */
        .fa-map-marked-alt::before { content: 'ğŸ—ºï¸'; }
        .fa-compass::before { content: 'ğŸ§­'; }
        .fa-directions::before { content: 'ğŸ§­'; }
        .fa-gps::before { content: 'ğŸ“'; }
        .fa-marker::before { content: 'ğŸ“Œ'; }
        .fa-flag::before { content: 'ğŸš©'; }
        .fa-flag-checkered::before { content: 'ğŸ'; }
        
        /* Data and Analytics Icons */
        .fa-table::before { content: 'ğŸ“‹'; }
        .fa-list::before { content: 'ğŸ“'; }
        .fa-th::before { content: 'âŠ'; }
        .fa-th-large::before { content: 'â–¦'; }
        .fa-th-list::before { content: 'â˜°'; }
        .fa-filter::before { content: 'ğŸ”'; }
        .fa-sort::before { content: 'â‡…'; }
        .fa-sort-up::before { content: 'â‡ˆ'; }
        .fa-sort-down::before { content: 'â‡Š'; }
        
        /* System and Technical Icons */
        .fa-terminal::before { content: 'ğŸ’»'; }
        .fa-code::before { content: '<>'; }
        .fa-bug::before { content: 'ğŸ›'; }
        .fa-shield-alt::before { content: 'ğŸ›¡ï¸'; }
        .fa-lock::before { content: 'ğŸ”’'; }
        .fa-unlock::before { content: 'ğŸ”“'; }
        .fa-key::before { content: 'ğŸ—ï¸'; }
        .fa-wifi::before { content: 'ğŸ“¶'; }
        .fa-signal::before { content: 'ğŸ“¶'; }
        .fa-battery-full::before { content: 'ğŸ”‹'; }
        .fa-battery-half::before { content: 'ğŸ”‹'; }
        .fa-battery-empty::before { content: 'ğŸª«'; }
        
        /* Communication Icons */
        .fa-comments::before { content: 'ğŸ’¬'; }
        .fa-comment::before { content: 'ğŸ’­'; }
        .fa-message::before { content: 'ğŸ’Œ'; }
        .fa-inbox::before { content: 'ğŸ“¥'; }
        .fa-outbox::before { content: 'ğŸ“¤'; }
        
        /* Media and Control Icons */
        .fa-volume-up::before { content: 'ğŸ”Š'; }
        .fa-volume-down::before { content: 'ğŸ”‰'; }
        .fa-volume-mute::before { content: 'ğŸ”‡'; }
        .fa-image::before { content: 'ğŸ–¼ï¸'; }
        .fa-video::before { content: 'ğŸ“¹'; }
        .fa-camera::before { content: 'ğŸ“·'; }
        
        /* Weather and Environment Icons */
        .fa-sun::before { content: 'â˜€ï¸'; }
        .fa-moon::before { content: 'ğŸŒ™'; }
        .fa-cloud::before { content: 'â˜ï¸'; }
        .fa-rain::before { content: 'ğŸŒ§ï¸'; }
        .fa-snow::before { content: 'â„ï¸'; }
        .fa-wind::before { content: 'ğŸ’¨'; }
        .fa-temperature-high::before { content: 'ğŸŒ¡ï¸'; }
        .fa-temperature-low::before { content: 'ğŸ§Š'; }
        
        /* Transportation Icons */
        .fa-car::before { content: 'ğŸš—'; }
        .fa-bus::before { content: 'ğŸšŒ'; }
        .fa-motorcycle::before { content: 'ğŸï¸'; }
        .fa-bicycle::before { content: 'ğŸš²'; }
        .fa-plane::before { content: 'âœˆï¸'; }
        .fa-ship::before { content: 'ğŸš¢'; }
        .fa-train::before { content: 'ğŸš†'; }
        
        /* Business and Finance Icons */
        .fa-coins::before { content: 'ğŸª™'; }
        .fa-credit-card::before { content: 'ğŸ’³'; }
        .fa-wallet::before { content: 'ğŸ‘›'; }
        .fa-receipt::before { content: 'ğŸ§¾'; }
        .fa-calculator::before { content: 'ğŸ§®'; }
        .fa-chart-growth::before { content: 'ğŸ“ˆ'; }
        .fa-trending-up::before { content: 'ğŸ“ˆ'; }
        .fa-trending-down::before { content: 'ğŸ“‰'; }
        
        /* Document and File Icons */
        .fa-file-pdf::before { content: 'ğŸ“„'; }
        .fa-file-csv::before { content: 'ğŸ“Š'; }
        .fa-file-alt::before { content: 'ğŸ“'; }
        .fa-file::before { content: 'ğŸ“„'; }
        .fa-folder::before { content: 'ğŸ“'; }
        .fa-archive::before { content: 'ğŸ—ƒï¸'; }
        
        /* Missing AI Card Icons */
        .fa-cog::before { content: 'âš™ï¸'; }
        .fa-question-circle::before { content: 'â“'; }
        .fa-trash-alt::before { content: 'ğŸ—‘ï¸'; }
        .fa-fill-drip::before { content: 'ğŸ’§'; }
        .fa-arrow-right::before { content: 'â†’'; }
        .fa-route-highway::before { content: 'ğŸ›£ï¸'; }
        .fa-road::before { content: 'ğŸ›£ï¸'; }
        .fa-stopwatch::before { content: 'â±ï¸'; }
        .fa-leaf-oak::before { content: 'ğŸƒ'; }
        .fa-seedling::before { content: 'ğŸŒ±'; }
        .fa-award::before { content: 'ğŸ†'; }
        .fa-medal::before { content: 'ğŸ¥‡'; }
        .fa-bullseye::before { content: 'ğŸ¯'; }
        .fa-crosshairs::before { content: 'ğŸ¯'; }
        .fa-percentage::before { content: '%'; }
        .fa-thumbs-up::before { content: 'ğŸ‘'; }
        .fa-thumbs-down::before { content: 'ğŸ‘'; }
        .fa-eye-slash::before { content: 'ğŸ™ˆ'; }
        .fa-info::before { content: 'â„¹ï¸'; }
        .fa-magic::before { content: 'âœ¨'; }
        .fa-wand-magic::before { content: 'âœ¨'; }
        .fa-sparkles::before { content: 'âœ¨'; }
        .fa-gem::before { content: 'ğŸ’'; }
        .fa-crown::before { content: 'ğŸ‘‘'; }
        .fa-fire-alt::before { content: 'ğŸ”¥'; }
        .fa-rocket::before { content: 'ğŸš€'; }
        
        /* Additional AI Card Specific Icons */
        .fa-random::before { content: 'ğŸ”€'; }
        .fa-shuffle::before { content: 'ğŸ”€'; }
        .fa-exclamation::before { content: 'â—'; }
        .fa-trophy::before { content: 'ğŸ†'; }
        .fa-arrow-down::before { content: 'â†“'; }
        .fa-arrow-up::before { content: 'â†‘'; }
        .fa-text-success::before { content: 'âœ…'; }
        .fa-text-warning::before { content: 'âš ï¸'; }
        .fa-check-circle::before { content: 'âœ…'; }
        .fa-map-marked-alt::before { content: 'ğŸ—ºï¸'; }
        .fa-history::before { content: 'â°'; }
        .fa-flask::before { content: 'ğŸ§ª'; }
        .fa-route::before { content: 'ğŸ›£ï¸'; }
        .fa-info-circle::before { content: 'â„¹ï¸'; }
        
        /* Final missing icons for AI card */
        .fa-chevron-right::before { content: 'â–¶ï¸'; }
        .fa-gas-pump::before { content: 'â›½'; }
        .fa-map-marker::before { content: 'ğŸ“'; }
        .fa-sync::before { content: 'ğŸ”„'; }
        .fa-user-plus::before { content: 'ğŸ‘¤â•'; }
        .fa-satellite-dish::before { content: 'ğŸ“¡'; }
        
        /* Font Loading Detection for better fallback */
        @font-face {
            font-family: 'FontAwesome';
            src: url('data:font/woff2;base64,') format('woff2');
            font-display: swap;
        }
        
        /* Utility and Tool Icons */
        .fa-tools::before { content: 'ğŸ› ï¸'; }
        .fa-hammer::before { content: 'ğŸ”¨'; }
        .fa-screwdriver::before { content: 'ğŸª›'; }
        .fa-bolt::before { content: 'âš¡'; }
        .fa-fire::before { content: 'ğŸ”¥'; }
        .fa-water::before { content: 'ğŸ’§'; }
        .fa-snowflake::before { content: 'â„ï¸'; }
        .fa-recycle::before { content: 'â™»ï¸'; }
        .fa-magic::before { content: 'âœ¨'; }
        
        /* User and Identity Icons */
        .fa-user-check::before { content: 'âœ…'; }
        .fa-user-cog::before { content: 'âš™ï¸'; }
        .fa-user-plus::before { content: 'ğŸ‘¤'; }
        .fa-id-card::before { content: 'ğŸªª'; }
        .fa-badge::before { content: 'ğŸ·ï¸'; }
        
        /* Vehicle and Transportation Details */
        .fa-car::before { content: 'ğŸš—'; }
        .fa-weight::before { content: 'âš–ï¸'; }
        .fa-tachometer::before { content: 'âš¡'; }
        .fa-speedometer::before { content: 'ğŸï¸'; }
        
        /* Environment and Nature Icons */
        .fa-tree::before { content: 'ğŸŒ³'; }
        .fa-tint::before { content: 'ğŸ’§'; }
        .fa-droplet::before { content: 'ğŸ’§'; }
        .fa-seedling::before { content: 'ğŸŒ±'; }
        
        /* Arrow and Direction Icons */
        .fa-arrow-up::before { content: 'â¬†ï¸'; }
        .fa-arrow-down::before { content: 'â¬‡ï¸'; }
        .fa-arrow-left::before { content: 'â¬…ï¸'; }
        .fa-arrow-right::before { content: 'â¡ï¸'; }
        .fa-arrow-circle-up::before { content: 'ğŸ”'; }
        .fa-arrow-circle-down::before { content: 'ğŸ”½'; }
        
        /* Alert and Status Icons */
        .fa-circle::before { content: 'âš«'; }
        .fa-dot-circle::before { content: 'ğŸ”˜'; }
        .fa-square::before { content: 'â¬›'; }
        .fa-heart::before { content: 'â¤ï¸'; }
        .fa-thumbs-up::before { content: 'ğŸ‘'; }
        .fa-thumbs-down::before { content: 'ğŸ‘'; }
        .fa-like::before { content: 'ğŸ‘'; }
        .fa-dislike::before { content: 'ğŸ‘'; }
        
        /* Advanced System Icons */
        .fa-memory::before { content: 'ğŸ’¾'; }
        .fa-hdd::before { content: 'ğŸ’¿'; }
        .fa-ethernet::before { content: 'ğŸŒ'; }
        .fa-plug::before { content: 'ğŸ”Œ'; }
        .fa-power::before { content: 'âš¡'; }
        
        /* Additional Specialized Icons */
        .fa-magic-wand::before { content: 'ğŸª„'; }
        .fa-sparkles::before { content: 'âœ¨'; }
        .fa-crystal-ball::before { content: 'ğŸ”®'; }
        .fa-atom::before { content: 'âš›ï¸'; }
        .fa-dna::before { content: 'ğŸ§¬'; }
        .fa-microscope::before { content: 'ğŸ”¬'; }
        
        /* Control and Media Icons */
        .fa-volume::before { content: 'ğŸ”Š'; }
        .fa-speaker::before { content: 'ğŸ”ˆ'; }
        .fa-microphone::before { content: 'ğŸ¤'; }
        .fa-headphones::before { content: 'ğŸ§'; }
        
        /* Time and Calendar Extended */
        .fa-hourglass::before { content: 'â³'; }
        .fa-stopwatch::before { content: 'â±ï¸'; }
        .fa-alarm-clock::before { content: 'â°'; }
        .fa-timer::before { content: 'â²ï¸'; }
        .fa-calendar-check::before { content: 'ğŸ“…'; }
        .fa-calendar-alt::before { content: 'ğŸ“…'; }
        .fa-calendar-plus::before { content: 'ğŸ“…'; }
        .fa-calendar-minus::before { content: 'ğŸ“…'; }
        
        /* Additional Business Icons */
        .fa-briefcase::before { content: 'ğŸ’¼'; }
        .fa-handshake::before { content: 'ğŸ¤'; }
        .fa-presentation::before { content: 'ğŸ“Š'; }
        .fa-meeting::before { content: 'ğŸ¤'; }
        
        /* Navigation and Layout Icons */
        .fa-th-large::before { content: 'â–¦'; }
        .fa-th::before { content: 'âŠ'; }
        .fa-th-list::before { content: 'â˜°'; }
        .fa-bars::before { content: 'â˜°'; }
        .fa-ellipsis-v::before { content: 'â‹®'; }
        .fa-ellipsis-h::before { content: 'â‹¯'; }
        .fa-menu::before { content: 'â˜°'; }
        .fa-hamburger::before { content: 'â˜°'; }
        
        /* Additional Specialized Icons for AI/ML/Analytics */
        .fa-flask-vial::before { content: 'ğŸ§ª'; }
        .fa-test-tube::before { content: 'ğŸ§ª'; }
        .fa-laboratory::before { content: 'ğŸ”¬'; }
        .fa-science::before { content: 'âš—ï¸'; }
        .fa-research::before { content: 'ğŸ”¬'; }
        .fa-experiment::before { content: 'ğŸ§ª'; }
        .fa-algorithm::before { content: 'âš™ï¸'; }
        .fa-neural-network::before { content: 'ğŸ§ '; }
        .fa-artificial-intelligence::before { content: 'ğŸ¤–'; }
        .fa-machine-learning::before { content: 'ğŸ”¬'; }
        .fa-deep-learning::before { content: 'ğŸ§ '; }
        .fa-data-science::before { content: 'ğŸ“Š'; }
        .fa-statistics::before { content: 'ğŸ“ˆ'; }
        .fa-metrics::before { content: 'ğŸ“Š'; }
        .fa-insights::before { content: 'ğŸ’¡'; }
        .fa-optimization::before { content: 'âš™ï¸'; }
        .fa-efficiency::before { content: 'âš¡'; }
        .fa-performance::before { content: 'ğŸš€'; }
        .fa-automation::before { content: 'ğŸ¤–'; }
        .fa-intelligence::before { content: 'ğŸ§ '; }
        .fa-prediction::before { content: 'ğŸ”®'; }
        .fa-forecasting::before { content: 'ğŸ“ˆ'; }
        .fa-analytics::before { content: 'ğŸ“Š'; }
        .fa-dashboard::before { content: 'ğŸ“Š'; }
        .fa-monitoring::before { content: 'ğŸ“¡'; }
        .fa-surveillance::before { content: 'ğŸ‘ï¸'; }
        .fa-tracking::before { content: 'ğŸ“'; }
        
        /* Additional System and Technical Icons */
        .fa-api::before { content: 'ğŸ”—'; }
        .fa-json::before { content: 'ğŸ“„'; }
        .fa-xml::before { content: 'ğŸ“„'; }
        .fa-csv::before { content: 'ğŸ“Š'; }
        .fa-export::before { content: 'ğŸ“¤'; }
        .fa-import::before { content: 'ğŸ“¥'; }
        .fa-backup::before { content: 'ğŸ’¾'; }
        .fa-restore::before { content: 'â†º'; }
        .fa-version::before { content: 'ğŸ·ï¸'; }
        .fa-update::before { content: 'ğŸ”„'; }
        .fa-upgrade::before { content: 'â¬†ï¸'; }
        .fa-downgrade::before { content: 'â¬‡ï¸'; }
        
        /* IoT and Smart City Icons */
        .fa-sensor::before { content: 'ğŸ“¡'; }
        .fa-iot::before { content: 'ğŸŒ'; }
        .fa-smart-city::before { content: 'ğŸ™ï¸'; }
        .fa-connected::before { content: 'ğŸ”—'; }
        .fa-wireless::before { content: 'ğŸ“¶'; }
        .fa-bluetooth::before { content: 'ğŸ“¶'; }
        .fa-nfc::before { content: 'ğŸ“±'; }
        .fa-rfid::before { content: 'ğŸ“¡'; }
        .fa-beacon::before { content: 'ğŸ“¶'; }
        .fa-satellite::before { content: 'ğŸ›°ï¸'; }
        .fa-gps-tracker::before { content: 'ğŸ“'; }
        .fa-geolocation::before { content: 'ğŸŒ'; }
        
        /* Emergency and Safety Icons */
        .fa-emergency::before { content: 'ğŸš¨'; }
        .fa-alert::before { content: 'âš ï¸'; }
        .fa-siren::before { content: 'ğŸš¨'; }
        .fa-first-aid::before { content: 'ğŸ¥'; }
        .fa-medical::before { content: 'âš•ï¸'; }
        .fa-health::before { content: 'â¤ï¸'; }
        .fa-safety::before { content: 'ğŸ¦º'; }
        .fa-helmet::before { content: 'â›‘ï¸'; }
        .fa-shield::before { content: 'ğŸ›¡ï¸'; }
        .fa-security::before { content: 'ğŸ”’'; }
        .fa-surveillance-camera::before { content: 'ğŸ“¹'; }
        .fa-cctv::before { content: 'ğŸ“¹'; }
        
        /* Leaflet Popup Styling - Ensure popups are visible */
        .leaflet-popup {
            z-index: 1000 !important;
        }
        .leaflet-popup-pane {
            z-index: 700 !important;
        }
        .bin-popup .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            padding: 0;
            overflow: hidden;
        }
        .bin-popup .leaflet-popup-content {
            margin: 12px;
            color: #e2e8f0;
            font-size: 14px;
        }
        .bin-popup .leaflet-popup-tip {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .bin-popup .leaflet-popup-close-button {
            color: #94a3b8;
            font-size: 24px;
            padding: 8px;
            top: 8px;
            right: 8px;
            z-index: 10;
        }
        .bin-popup .leaflet-popup-close-button:hover {
            color: #f1f5f9;
        }
        /* Vehicle popup styling */
        .vehicle-popup .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .vehicle-popup .leaflet-popup-content {
            margin: 12px;
            color: #e2e8f0;
        }
        .vehicle-popup .leaflet-popup-tip {
            background: #1e293b;
        }
        /* Enhanced popup styling */
        .enhanced-popup .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            padding: 0;
            overflow: visible;
        }
        .enhanced-popup .leaflet-popup-content {
            margin: 12px;
            color: #e2e8f0;
            font-size: 14px;
            overflow: visible;
        }
        .enhanced-popup .leaflet-popup-tip {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .enhanced-popup .leaflet-popup-close-button {
            color: #94a3b8;
            font-size: 24px;
            padding: 8px;
            top: 8px;
            right: 8px;
            z-index: 10;
        }
        .enhanced-popup .leaflet-popup-close-button:hover {
            color: #f1f5f9;
        }
        /* Ensure popups are always on top */
        .leaflet-pane.leaflet-popup-pane {
            z-index: 700 !important;
        }
        /* Analytics Dashboard: print only the analytics section, hide nav/sidebar/other UI */
        @media print {
            body * { visibility: hidden; }
            #analytics, #analytics * { visibility: visible; }
            #analytics {
                display: block !important;
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                padding: 1rem !important;
                background: #fff !important;
                box-shadow: none !important;
            }
            .analytics-actions, .no-print, button[onclick="window.print()"] { display: none !important; }
        }
        /* Analytics detail tables - world-class */
        .analytics-detail-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .analytics-detail-table th, .analytics-detail-table td { padding: 0.65rem 0.85rem; text-align: left; border-bottom: 1px solid rgba(148, 163, 184, 0.2); }
        .analytics-detail-table th { background: rgba(59, 130, 246, 0.12); color: #e2e8f0; font-weight: 600; }
        .analytics-detail-table tbody tr:hover { background: rgba(59, 130, 246, 0.06); }
        .analytics-detail-table .status-ok { color: #34d399; }
        .analytics-detail-table .status-warning { color: #fbbf24; }
        .analytics-detail-table .status-critical { color: #f87171; }

        /* Bin details â€“ Sensor Information (world-class UI) */
        .sensor-info-card {
            padding: 1.35rem 1.6rem;
            border-radius: 14px;
            border-left: 3px solid var(--primary, #3b82f6);
            background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
        }
        .sensor-info-title {
            margin: 0 0 1.1rem 0;
            font-size: 1.05rem;
            font-weight: 600;
            color: #e2e8f0;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sensor-info-title::before {
            content: '';
            width: 4px;
            height: 1em;
            background: var(--primary, #3b82f6);
            border-radius: 2px;
        }
        .sensor-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(172px, 1fr));
            gap: 0.65rem 1rem;
        }
        .sensor-info-item {
            display: flex;
            align-items: center;
            gap: 0.85rem;
            padding: 0.7rem 0.95rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.07);
            transition: background 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
        }
        .sensor-info-item:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.1);
        }
        .sensor-info-item--name {
            grid-column: 1 / -1;
            padding: 0.85rem 1rem;
            background: rgba(255,255,255,0.06);
        }
        .sensor-info-icon {
            width: 1.35rem;
            font-size: 1rem;
            flex-shrink: 0;
            color: rgba(148, 163, 184, 0.85);
            transition: color 0.2s ease;
        }
        .sensor-info-item[data-battery-level="ok"] .sensor-info-icon { color: #34d399; }
        .sensor-info-item[data-battery-level="mid"] .sensor-info-icon { color: #fbbf24; }
        .sensor-info-item[data-battery-level="low"] .sensor-info-icon { color: #f87171; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="good"] .sensor-info-icon { color: #34d399; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="weak"] .sensor-info-icon { color: #fbbf24; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="poor"] .sensor-info-icon { color: #f87171; }
        .sensor-info-meta { display: flex; flex-direction: column; gap: 0.2rem; min-width: 0; }
        .sensor-info-label {
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(148, 163, 184, 0.8);
            font-weight: 500;
        }
        .sensor-info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #f1f5f9;
            letter-spacing: 0.01em;
        }
        .sensor-info-item[data-battery-level]:not([data-battery-level=""]) .sensor-info-value { color: #34d399; }
        .sensor-info-item[data-battery-level][data-battery-level="low"] .sensor-info-value { color: #f87171; }
        .sensor-info-item[data-battery-level][data-battery-level="mid"] .sensor-info-value { color: #fbbf24; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="good"] .sensor-info-value { color: #34d399; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="weak"] .sensor-info-value { color: #fbbf24; }
        .sensor-info-item[data-metric="signal"][data-signal-strength="poor"] .sensor-info-value { color: #f87171; }
        .sensor-info-value[data-unavailable="true"] { color: #64748b !important; font-weight: 500; }
        .sensor-history-charts-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            width: 100%;
            justify-content: center;
            padding: 0.7rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary, #3b82f6);
            background: rgba(59, 130, 246, 0.12);
            border: 1px solid rgba(59, 130, 246, 0.35);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
        }
        .sensor-history-charts-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        .sensor-history-charts-btn i { font-size: 1rem; }
        /* Sensor History Charts Modal */
        .sensor-charts-modal .modal-content { max-width: 920px; max-height: 92vh; overflow-y: auto; border-radius: 16px; box-shadow: 0 24px 48px rgba(0,0,0,0.3); }
        .sensor-charts-modal .sensor-charts-header { padding: 1.5rem 2rem; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
        .sensor-charts-modal .sensor-charts-title { margin: 0; font-size: 1.25rem; font-weight: 600; color: #e2e8f0; display: flex; align-items: center; gap: 0.6rem; }
        .sensor-charts-modal .sensor-charts-body { padding: 1.5rem 2rem 2rem; }
        .sensor-chart-block { background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%); border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); padding: 1.25rem; margin-bottom: 1.5rem; }
        .sensor-chart-block:last-child { margin-bottom: 0; }
        .sensor-chart-block h4 { margin: 0 0 1rem 0; font-size: 0.95rem; font-weight: 600; color: #cbd5e1; display: flex; align-items: center; gap: 0.5rem; }
        .sensor-chart-block h4 i { opacity: 0.9; }
        .sensor-chart-block .chart-wrap { position: relative; height: 220px; }
        .sensor-chart-block .chart-wrap canvas { max-height: 220px; }
        .sensor-chart-empty { text-align: center; padding: 2rem; color: #64748b; font-size: 0.9rem; border-radius: 10px; background: rgba(0,0,0,0.15); }
    </style>
    
    <!-- Load Leaflet CSS (Keep for main monitoring map) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" 
          onerror="this.onerror=null; this.href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';" />
    
    <!-- Load Mapbox GL JS (for Fleet Management map) -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    
    <!-- Try multiple CDN sources with fallbacks -->
    <script>
        // Load Chart.js with multiple fallback sources
        function loadChartJS() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js',
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js'
            ];
            
            let sourceIndex = 0;
            
            function tryNextSource() {
                if (sourceIndex >= sources.length) {
                    console.warn('âš ï¸ All Chart.js sources failed, creating fallback');
                    createChartJSFallback();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = function() {
                    console.log('âœ… Chart.js loaded from:', sources[sourceIndex]);
                };
                script.onerror = function() {
                    console.warn('âŒ Failed to load Chart.js from:', sources[sourceIndex]);
                    sourceIndex++;
                    tryNextSource();
                };
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        function createChartJSFallback() {
            // Create a basic Chart fallback object
            window.Chart = window.Chart || {
                register: function() {},
                defaults: { responsive: true },
                Chart: function(ctx, config) {
                    this.ctx = ctx;
                    this.config = config;
                    this.data = config.data || {};
                    this.options = config.options || {};
                    
                    // Create a simple fallback visualization
                    if (ctx && ctx.getContext) {
                        const canvas = ctx.getContext('2d');
                        canvas.fillStyle = '#e3f2fd';
                        canvas.fillRect(0, 0, ctx.width || 400, ctx.height || 200);
                        canvas.fillStyle = '#1976d2';
                        canvas.font = '16px Arial';
                        canvas.textAlign = 'center';
                        canvas.fillText('Chart: ' + (config.type || 'Data'), (ctx.width || 400)/2, (ctx.height || 200)/2);
                    }
                    
                    return {
                        update: function() {},
                        destroy: function() {},
                        data: this.data,
                        options: this.options
                    };
                }
            };
            
            // Create constructor aliases
            ['Bar', 'Line', 'Doughnut', 'Pie', 'Radar', 'PolarArea'].forEach(type => {
                window.Chart[type] = window.Chart.Chart;
            });
            
            console.log('ğŸ“Š Chart.js fallback created');
        }
        
        // Load other libraries with fallbacks
        function loadLibraryWithFallback(sources, name, fallbackFn) {
            let sourceIndex = 0;
            
            function tryNext() {
                if (sourceIndex >= sources.length) {
                    console.warn(`âš ï¸ All ${name} sources failed`);
                    if (fallbackFn) fallbackFn();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = () => console.log(`âœ… ${name} loaded from:`, sources[sourceIndex]);
                script.onerror = () => {
                    console.warn(`âŒ Failed to load ${name} from:`, sources[sourceIndex]);
                    sourceIndex++;
                    tryNext();
                };
                document.head.appendChild(script);
            }
            
            tryNext();
        }
        
        // Library loading status management
        let loadingStatus = {
            chartjs: false,
            leaflet: false,
            jspdf: false
        };
        
        function updateLoadingStatus(library, success) {
            loadingStatus[library] = success;
            const statusEl = document.getElementById('status-text');
            const statusContainer = document.getElementById('library-status');
            
            if (!statusEl || !statusContainer) return;
            
            const loaded = Object.values(loadingStatus).filter(Boolean).length;
            const total = Object.keys(loadingStatus).length;
            
            if (loaded === total) {
                statusEl.innerHTML = 'âœ… All libraries ready';
                statusEl.style.color = '#22c55e';
                setTimeout(() => {
                    statusContainer.style.opacity = '0';
                    setTimeout(() => statusContainer.style.display = 'none', 300);
                }, 2000);
            } else {
                const successCount = Object.entries(loadingStatus).filter(([lib, status]) => status).length;
                const failureCount = Object.entries(loadingStatus).filter(([lib, status]) => status === false && lib !== 'pending').length;
                
                if (failureCount > 0) {
                    statusEl.innerHTML = `âš ï¸ ${successCount}/${total} libraries loaded (${failureCount} using fallbacks)`;
                    statusEl.style.color = '#f59e0b';
                } else {
                    statusEl.innerHTML = `ğŸ”„ Loading libraries... (${loaded}/${total})`;
                    statusEl.style.color = '#3b82f6';
                }
            }
        }
        
        // Enhanced loadChartJS with status updates
        function loadChartJS() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js',
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js'
            ];
            
            let sourceIndex = 0;
            
            function tryNextSource() {
                if (sourceIndex >= sources.length) {
                    console.warn('âš ï¸ All Chart.js sources failed, creating fallback');
                    createChartJSFallback();
                    updateLoadingStatus('chartjs', 'fallback');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = function() {
                    console.log('âœ… Chart.js loaded from:', sources[sourceIndex]);
                    updateLoadingStatus('chartjs', true);
                };
                script.onerror = function() {
                    console.warn('âŒ Failed to load Chart.js from:', sources[sourceIndex]);
                    sourceIndex++;
                    tryNextSource();
                };
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        // Enhanced library loader with status updates
        function loadLibraryWithFallback(sources, name, fallbackFn) {
            let sourceIndex = 0;
            
            function tryNext() {
                if (sourceIndex >= sources.length) {
                    console.warn(`âš ï¸ All ${name} sources failed`);
                    if (fallbackFn) fallbackFn();
                    updateLoadingStatus(name.toLowerCase(), 'fallback');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = () => {
                    console.log(`âœ… ${name} loaded from:`, sources[sourceIndex]);
                    updateLoadingStatus(name.toLowerCase(), true);
                };
                script.onerror = () => {
                    console.warn(`âŒ Failed to load ${name} from:`, sources[sourceIndex]);
                    sourceIndex++;
                    tryNext();
                };
                document.head.appendChild(script);
            }
            
            tryNext();
        }
        
        // Load all libraries with status tracking
        document.addEventListener('DOMContentLoaded', function() {
            updateLoadingStatus('chartjs', 'pending');
            updateLoadingStatus('leaflet', 'pending'); 
            updateLoadingStatus('jspdf', 'pending');
            
            loadChartJS();
            
            // Load Leaflet with fallback
            loadLibraryWithFallback([
                'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js',
                'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'
            ], 'Leaflet', function() {
                // Create comprehensive Leaflet fallback that works with MapManager
                console.log('ğŸ—ºï¸ Creating comprehensive Leaflet fallback...');
                
                window.L = {
                    // Map constructor
                    map: function(elementId, options) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            element.innerHTML = `
                                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); 
                                           display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; 
                                           border-radius: 10px; position: relative; box-shadow: inset 0 0 50px rgba(0,0,0,0.3);">
                                    <div style="text-align: center; z-index: 10;">
                                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ—ºï¸</div>
                                        <div style="font-weight: bold; margin-bottom: 8px;">Interactive Map</div>
                                        <div style="font-size: 14px; opacity: 0.8; margin-bottom: 16px;">
                                            Doha, Qatar â€¢ Real-time Tracking Available
                                        </div>
                                        <div style="font-size: 12px; opacity: 0.6; background: rgba(255,255,255,0.1); 
                                                  padding: 8px 12px; border-radius: 15px; display: inline-block;">
                                            ğŸ“ GPS: 25.2854Â°N, 51.5310Â°E
                                        </div>
                                    </div>
                                    <div id="mapDriverMarkers" style="position: absolute; bottom: 20px; right: 20px; 
                                                                   background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; 
                                                                   font-size: 12px;">
                                        <div style="color: #4ade80;">ğŸš› Drivers: <span id="activeDriverCount">0</span></div>
                                        <div style="color: #60a5fa;">ğŸ“ Locations: Tracked</div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        return {
                            setView: function(center, zoom) {
                                console.log(`ğŸ—ºï¸ Map view set to: ${center} at zoom ${zoom}`);
                                return this;
                            },
                            addTo: function(container) { return this; },
                            on: function(event, handler) {
                                console.log(`ğŸ—ºï¸ Map event listener added: ${event}`);
                                return this;
                            },
                            off: function(event, handler) { return this; },
                            invalidateSize: function() { return this; },
                            addLayer: function(layer) {
                                console.log('ğŸ—ºï¸ Layer added to map');
                                return this;
                            },
                            removeLayer: function(layer) {
                                console.log('ğŸ—ºï¸ Layer removed from map');
                                return this;
                            },
                            fitBounds: function(bounds, options) {
                                console.log('ğŸ—ºï¸ Map bounds fitted');
                                return this;
                            },
                            getBounds: function() {
                                return {
                                    getSouthWest: () => ({ lat: 25.2, lng: 51.4 }),
                                    getNorthEast: () => ({ lat: 25.3, lng: 51.6 })
                                };
                            },
                            getCenter: function() {
                                return { lat: 25.2854, lng: 51.5310 };
                            },
                            getZoom: function() { return 13; },
                            panTo: function(latlng) {
                                console.log(`ğŸ—ºï¸ Map panned to: ${latlng}`);
                                return this;
                            }
                        };
                    },
                    
                    // Tile layer
                    tileLayer: function(url, options) {
                        console.log('ğŸ—ºï¸ Tile layer created:', url);
                        return {
                            addTo: function(map) {
                                console.log('ğŸ—ºï¸ Tile layer added to map');
                                return this;
                            },
                            remove: function() { return this; }
                        };
                    },
                    
                    // Markers
                    marker: function(latlng, options) {
                        console.log('ğŸ“ Marker created at:', latlng);
                        // Update driver count display
                        const driverCount = document.getElementById('activeDriverCount');
                        if (driverCount) {
                            const current = parseInt(driverCount.textContent) || 0;
                            driverCount.textContent = current + 1;
                        }
                        
                        return {
                            addTo: function(map) {
                                console.log('ğŸ“ Marker added to map');
                                return this;
                            },
                            bindPopup: function(content) {
                                console.log('ğŸ“ Popup bound to marker:', content);
                                return this;
                            },
                            openPopup: function() {
                                console.log('ğŸ“ Marker popup opened');
                                return this;
                            },
                            closePopup: function() { return this; },
                            setLatLng: function(latlng) {
                                console.log('ğŸ“ Marker position updated:', latlng);
                                return this;
                            },
                            getLatLng: function() {
                                return latlng || { lat: 25.2854, lng: 51.5310 };
                            },
                            remove: function() {
                                console.log('ğŸ“ Marker removed');
                                return this;
                            },
                            setIcon: function(icon) {
                                console.log('ğŸ“ Marker icon set');
                                return this;
                            }
                        };
                    },
                    
                    // Layer groups
                    layerGroup: function(layers) {
                        return {
                            addTo: function(map) {
                                console.log('ğŸ“ Layer group added');
                                return this;
                            },
                            clearLayers: function() {
                                console.log('ğŸ“ Layer group cleared');
                                return this;
                            },
                            addLayer: function(layer) { return this; },
                            removeLayer: function(layer) { return this; }
                        };
                    },
                    
                    // Icons
                    divIcon: function(options) {
                        console.log('ğŸ¯ Div icon created');
                        return { options: options || {} };
                    },
                    
                    icon: function(options) {
                        console.log('ğŸ¯ Icon created');
                        return { options: options || {} };
                    },
                    
                    // Polylines for routes
                    polyline: function(latlngs, options) {
                        console.log('ğŸ“ Route polyline created');
                        return {
                            addTo: function(map) {
                                console.log('ğŸ“ Route added to map');
                                return this;
                            },
                            remove: function() {
                                console.log('ğŸ“ Route removed');
                                return this;
                            },
                            setLatLngs: function(latlngs) { return this; },
                            getLatLngs: function() { return []; }
                        };
                    },
                    
                    // Utility functions
                    latLng: function(lat, lng) {
                        return { lat: lat, lng: lng };
                    },
                    
                    latLngBounds: function(corner1, corner2) {
                        return {
                            extend: function(latlng) { return this; },
                            isValid: function() { return true; }
                        };
                    }
                };
                
                console.log('ğŸ—ºï¸ Comprehensive Leaflet fallback created successfully');
            });
            
            // Load jsPDF with fallback
            loadLibraryWithFallback([
                'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js',
                'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'
            ], 'jsPDF', function() {
                // Fallback jsPDF if loading fails
                window.jspdf = window.jspdf || {
                    jsPDF: function() {
                        return {
                            text: function() { return this; },
                            save: function(filename) { 
                                console.log('ğŸ“„ PDF save requested (fallback):', filename);
                                alert('PDF generation requires jsPDF library. Please check your internet connection.');
                            },
                            addPage: function() { return this; },
                            setFontSize: function() { return this; },
                            autoTable: function() { return this; }
                        };
                    }
                };
                window.jsPDF = window.jspdf.jsPDF;
            });
            
            // Load jsPDF AutoTable plugin
            setTimeout(() => {
                const autoTableScript = document.createElement('script');
                autoTableScript.src = 'https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js';
                autoTableScript.onload = () => {
                    console.log('âœ… jsPDF AutoTable plugin loaded');
                    updateLoadingStatus('jspdf', 'success');
                };
                autoTableScript.onerror = () => {
                    console.warn('âš ï¸ jsPDF AutoTable plugin failed to load');
                };
                document.head.appendChild(autoTableScript);
            }, 1000);
            
            // Load html2canvas for comprehensive reports
            const html2canvasScript = document.createElement('script');
            html2canvasScript.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
            html2canvasScript.onload = () => {
                console.log('âœ… html2canvas loaded successfully');
            };
            html2canvasScript.onerror = () => {
                console.warn('âš ï¸ html2canvas failed to load');
                // Create fallback
                window.html2canvas = function() {
                    return Promise.resolve({
                        toDataURL: () => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=='
                    });
                };
            };
            document.head.appendChild(html2canvasScript);
        });
    </script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="map-fix.css">
    
    <!-- ğŸ¨ World-Class UI Design System -->
    <link rel="stylesheet" href="WORLD_CLASS_UI.css">
    <link rel="stylesheet" href="ENHANCED_LIVE_MONITORING_UI.css">
    <link rel="stylesheet" href="admin-sensor-table-styles.css">
</head>
<body>
    <!-- Mobile wake: tap-to-reload when app was in background long (runs first, no dependencies) -->
    <script>
(function(){
var _lastHidden = 0;
function showReloadOverlay(){
    if(document.getElementById('mobile-wake-reload-overlay')) return;
    var o = document.createElement('div');
    o.id = 'mobile-wake-reload-overlay';
    o.style.cssText = 'position:fixed;inset:0;z-index:2147483647;background:rgba(15,23,42,0.95);display:flex;align-items:center;justify-content:center;font-family:system-ui,sans-serif;-webkit-tap-highlight-color:transparent;';
    o.innerHTML = '<div style="text-align:center;color:#fff;padding:24px;max-width:320px;"><p style="font-size:1.15rem;margin:0 0 8px;font-weight:600;">App unresponsive?</p><p style="font-size:0.95rem;margin:0 0 20px;opacity:0.9;">Tap the button below to reload</p><button type="button" style="padding:14px 28px;font-size:1rem;background:#3b82f6;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;">Reload app</button></div>';
    o.onclick = function(e){ if(e.target.tagName === 'BUTTON' || e.target === o) window.location.reload(); };
    document.body.appendChild(o);
}
document.addEventListener('visibilitychange', function(){
    if(document.hidden) _lastHidden = Date.now();
    else if(_lastHidden && (Date.now() - _lastHidden) > 12000) setTimeout(showReloadOverlay, 300);
});
window.addEventListener('pageshow', function(e){
    if(_lastHidden && (Date.now() - _lastHidden) > 12000) setTimeout(showReloadOverlay, 300);
});
})();
    </script>
    <!-- ğŸš€ Application Loading Screen -->
    <div id="app-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); z-index: 999999; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
        <div style="text-align: center;">
            <!-- Logo/Icon -->
            <div style="font-size: 64px; margin-bottom: 24px; animation: pulse 2s ease-in-out infinite;">
                â™»ï¸
            </div>
            
            <!-- App Title -->
            <h1 style="color: #ffffff; font-size: 32px; font-weight: 600; margin: 0 0 12px 0; letter-spacing: -0.5px;">
                Autonautics Smart Waste
            </h1>
            
            <!-- Loading Status -->
            <p id="loader-status" style="color: #94a3b8; font-size: 16px; margin: 0 0 32px 0; font-weight: 400;">
                Initializing system...
            </p>
            
            <!-- Animated Spinner -->
            <div style="width: 48px; height: 48px; margin: 0 auto; border: 3px solid rgba(59, 130, 246, 0.2); border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            
            <!-- Progress Details -->
            <div id="loader-details" style="margin-top: 24px; color: #64748b; font-size: 13px; max-width: 400px; line-height: 1.6;">
                Loading dependencies...
            </div>
        </div>
        
        <!-- Error Display (hidden by default) -->
        <div id="loader-error" style="display: none; position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px 24px; max-width: 500px; text-align: center;">
            <div style="color: #ef4444; font-weight: 600; margin-bottom: 8px;">âš ï¸ Initialization Error</div>
            <div id="loader-error-message" style="color: #fca5a5; font-size: 13px;"></div>
            <button onclick="location.reload()" style="margin-top: 12px; background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">
                Reload Application
            </button>
        </div>
    </div>
    
    <!-- Animations for loader -->
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
    
    <!-- Library Loading Status -->
    <div id="library-status" style="position: fixed; top: 10px; right: 10px; background: rgba(255, 255, 255, 0.95); padding: 8px 12px; border-radius: 6px; box-shadow: 0 2px 12px rgba(0,0,0,0.15); font-size: 12px; z-index: 10000; display: block; backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.1);">
        <div id="status-text" style="color: #666; font-weight: 500;">
            ğŸ”„ Loading external libraries...
        </div>
    </div>
    
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-cube"></i>
                </div>
                <h2 style="color: #e2e8f0; margin-bottom: 0.5rem;">Autonautics</h2>
                <p style="color: #94a3b8; font-size: 0.875rem;">Smart Waste Management System</p>
            </div>
            
            <div class="user-type-selector">
                <div class="user-type-btn active" data-user-type="manager">
                    <i class="fas fa-user-tie" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Manager</div>
                </div>
                <div class="user-type-btn" data-user-type="driver">
                    <i class="fas fa-truck" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Driver</div>
                </div>
                <div class="user-type-btn" data-user-type="admin">
                    <i class="fas fa-user-shield" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Admin</div>
                </div>
            </div>
            
            <div id="loginErrorBanner" style="display: none; margin-bottom: 1rem; padding: 0.875rem 1rem; background: linear-gradient(135deg, rgba(239,68,68,0.15) 0%, rgba(220,38,38,0.08) 100%); border: 1px solid rgba(239,68,68,0.4); border-radius: 10px; color: #fca5a5; font-size: 0.9rem; align-items: center; gap: 0.75rem; box-shadow: 0 2px 8px rgba(239,68,68,0.15); flex-direction: row;">
                <span style="flex-shrink: 0; width: 28px; height: 28px; background: rgba(239,68,68,0.3); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;"><i class="fas fa-exclamation-circle" style="font-size: 1rem;"></i></span>
                <span id="loginErrorText">Username or password is incorrect.</span>
            </div>
            <!-- Reset Password (forgot password) panel - hidden by default -->
            <div id="resetPasswordPanel" style="display: none; margin-bottom: 1rem; padding: 1.25rem; background: #1e293b; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #e2e8f0; font-size: 1.1rem;"><i class="fas fa-key"></i> Reset password</h3>
                    <button type="button" id="closeResetPasswordBtn" style="background: none; border: none; color: #94a3b8; cursor: pointer; padding: 0.25rem; font-size: 1.25rem;">&times;</button>
                </div>
                <p style="margin: 0 0 1rem 0; color: #94a3b8; font-size: 0.875rem;">Enter your username and a new password.</p>
                <div class="form-group" style="margin-bottom: 0.75rem;">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="resetPasswordUsername" placeholder="Your username" autocomplete="username">
                </div>
                <div class="form-group" style="margin-bottom: 0.75rem;">
                    <label class="form-label">New password</label>
                    <input type="password" class="form-input" id="resetPasswordNew" placeholder="At least 6 characters" minlength="6" autocomplete="new-password">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label">Confirm new password</label>
                    <input type="password" class="form-input" id="resetPasswordConfirm" placeholder="Repeat new password" minlength="6" autocomplete="new-password">
                </div>
                <div id="resetPasswordMessage" style="display: none; margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 6px; font-size: 0.875rem;"></div>
                <button type="button" id="submitResetPasswordBtn" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-check"></i> Reset password
                </button>
            </div>
            <form id="loginForm" autocomplete="off">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" placeholder="Enter your username" required autocomplete="off" data-lpignore="true" data-form-type="other">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter your password" required autocomplete="new-password" data-lpignore="true" data-form-type="other">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </form>
            <div style="margin-top: 0.75rem; text-align: right;">
                <a href="#" id="showResetPasswordLink" style="color: #94a3b8; font-size: 0.875rem; text-decoration: none;">Forgot password?</a>
            </div>
            <div style="margin-top: 1rem; text-align: center;">
                <a href="#" id="showRegistrationLink" style="color: var(--primary); text-decoration: none;">
                    New user? Register here
                </a>
            </div>
            
            <div style="margin-top: 1.5rem; text-align: center; color: #64748b; font-size: 0.875rem;">
                <p>Demo Credentials:</p>
                <p>Admin: admin / admin123</p>
                <p>Manager: manager1 / manager123</p>
                <p>Driver: driver1 / driver123</p>
                <div style="margin-top: 1rem;">
                    <button type="button" id="fixAccountsBtn" class="btn btn-secondary btn-sm" style="font-size: 0.75rem;">
                        <i class="fas fa-wrench"></i> Fix Demo Accounts
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registrationModal" class="modal" style="z-index: 10000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>User Registration</h2>
                <span class="close" data-modal="registrationModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registrationForm" autocomplete="off">
                    <div class="form-group">
                        <label class="form-label">User Type</label>
                        <select class="form-input" id="regUserType" autocomplete="off">
                            <option value="driver">Driver</option>
                            <option value="manager">Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="regFullName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-input" id="regUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="regPhone" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-input" id="regPassword" required minlength="6" autocomplete="new-password" data-lpignore="true" data-form-type="other">
                    </div>
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid var(--warning); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <p style="margin: 0; color: var(--warning); font-size: 0.875rem;">
                            <i class="fas fa-info-circle"></i> Note: Registration requires admin approval. The manager or admin will link the driver's vehicle to the driver once approved.
                        </p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i>
                        Submit Registration
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Info Badge -->
    <div class="user-info-badge" id="userInfoBadge" style="display: none;">
        <div class="user-avatar" id="userAvatar">AD</div>
        <div class="user-details">
            <div class="user-name" id="userName">Admin User</div>
            <div class="user-role" id="userRole">Manager</div>
        </div>
        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <!-- Background Elements -->
    <div class="bg-container"></div>
    <div class="grid-background"></div>
    <div class="floating-orbs">
        <div class="orb orb1"></div>
        <div class="orb orb2"></div>
    </div>
    
    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>
    
    <!-- Navigation - World-class top bar -->
    <nav class="nav" id="mainNav" style="display: none;" role="navigation" aria-label="Main navigation">
        <div class="nav-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-cube" aria-hidden="true"></i>
                </div>
                <span>Autonautics</span>
            </div>
            <ul class="nav-menu" id="navMenu">
                <!-- Navigation items populated dynamically by user type -->
            </ul>
            <button type="button" class="nav-toggle" id="navToggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="navMenu">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
        </div>
    </nav>

    <!-- Driver Only View - World-Class Mobile UI with Bottom Navigation -->
    <div class="driver-only-view" id="driverOnlyView" style="display: none;">
        <div class="driver-mobile-wrapper">
            <!-- Left drawer menu (world-class nav) -->
            <div class="driver-drawer-overlay" id="driverDrawerOverlay" aria-hidden="true"></div>
            <aside class="driver-drawer" id="driverDrawer" aria-label="Main menu">
                <div class="driver-drawer-header">
                    <span class="driver-drawer-title">Menu</span>
                    <button type="button" class="driver-drawer-close" id="driverDrawerClose" aria-label="Close menu"><i class="fas fa-times"></i></button>
                </div>
                <nav class="driver-drawer-nav">
                    <button type="button" class="driver-drawer-item active" data-page="home"><i class="fas fa-home"></i><span>Home</span><span class="driver-drawer-badge" id="driverDrawerHomeBadge" style="display: none;">0</span></button>
                    <button type="button" class="driver-drawer-item" data-page="routes"><i class="fas fa-route"></i><span>Routes</span></button>
                    <button type="button" class="driver-drawer-item" data-page="ai"><i class="fas fa-robot"></i><span>AI Assistant</span></button>
                    <button type="button" class="driver-drawer-item" data-page="messages"><i class="fas fa-comments"></i><span>Messages</span><span class="driver-drawer-badge" id="driverDrawerMessageBadge" style="display: none;">0</span></button>
                    <button type="button" class="driver-drawer-item" data-page="more"><i class="fas fa-th-large"></i><span>More</span><span class="driver-drawer-badge" id="driverDrawerMoreBadge" style="display: none;">0</span></button>
                </nav>
            </aside>

            <!-- Page: Home -->
            <div class="driver-page active" id="driverPageHome" data-page="home">
                <div class="driver-mobile-container">
                    <div class="driver-mobile-header">
                        <button type="button" class="driver-header-menu-btn" id="driverMenuBtn" aria-label="Open menu"><i class="fas fa-bars"></i></button>
                        <div class="driver-header-center">
                            <div class="driver-header-title">Driver Dashboard</div>
                            <div class="driver-header-subtitle" id="driverNameMobile">John Kirt</div>
                        </div>
                        <div class="driver-header-status">
                            <div id="driverStatusIndicator" class="driver-status-online">Online</div>
                        </div>
                    </div>

                    <!-- Compact status strip: GPS + Sync in one row -->
                    <div class="driver-status-strip">
                        <div class="driver-status-strip-item driver-status-gps">
                            <i class="fas fa-satellite-dish"></i>
                            <div class="driver-status-strip-text">
                                <span class="driver-status-strip-label">GPS</span>
                                <span id="gpsStatus" class="driver-status-strip-value">Searching...</span>
                            </div>
                            <button class="btn btn-primary btn-sm driver-status-strip-btn" id="refreshGPSBtn" aria-label="Refresh GPS"><i class="fas fa-sync"></i></button>
                        </div>
                        <div class="driver-status-strip-item driver-status-sync">
                            <i class="fas fa-cloud-upload-alt" id="syncIcon"></i>
                            <div class="driver-status-strip-text">
                                <span class="driver-status-strip-label">Sync</span>
                                <span id="syncStatus" class="driver-status-strip-value">Connecting...</span>
                            </div>
                            <div id="syncIndicator" class="driver-sync-dot"></div>
                        </div>
                    </div>

                    <!-- Today's summary: X to collect, Y done, Z remaining (world-class quick win #15) -->
                    <div id="driverTodaysSummaryCard" class="driver-todays-summary-card" style="display: none; margin-bottom: 1rem; padding: 1rem 1.25rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 14px;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-bullseye" style="color: #60a5fa; font-size: 1.25rem;"></i>
                            <h4 style="margin: 0; font-size: 1rem; font-weight: 700; color: #f1f5f9;">Today's goal</h4>
                        </div>
                        <div id="driverTodaysSummaryText" style="font-size: 0.95rem; color: #cbd5e1;">â€” bins to collect â€¢ â€” done â€¢ â€” remaining</div>
                        <div id="driverTodaysSummaryNext" style="font-size: 0.85rem; color: #94a3b8; margin-top: 0.35rem;"></div>
                    </div>

                    <div class="driver-stats-grid">
                        <div class="driver-stat-card">
                            <i class="fas fa-route driver-stat-icon"></i>
                            <div class="driver-stat-value" id="driverTodayCollections">0</div>
                            <div class="driver-stat-label">Today</div>
                        </div>
                        <div class="driver-stat-card">
                            <i class="fas fa-trash driver-stat-icon"></i>
                            <div class="driver-stat-value" id="driverPendingBins">0</div>
                            <div class="driver-stat-label">Pending</div>
                        </div>
                        <div class="driver-stat-card">
                            <i class="fas fa-gas-pump driver-stat-icon"></i>
                            <div class="driver-stat-value" id="driverFuelLevel">75%</div>
                            <div class="driver-stat-label">Fuel</div>
                        </div>
                        <div class="driver-stat-card">
                            <i class="fas fa-star driver-stat-icon driver-stat-star"></i>
                            <div class="driver-stat-value" id="driverRating">5.0</div>
                            <div class="driver-stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="driver-action-buttons-grid">
                        <button class="driver-action-card issue" id="reportIssueDriverBtn" data-action="issue">
                            <div class="action-icon-container"><i class="fas fa-exclamation-triangle"></i><div class="action-pulse-ring"></div></div>
                            <div class="action-content">
                                <h4 class="action-title">Report Issue</h4>
                                <p class="action-subtitle">Emergency & problems</p>
                            </div>
                            <div class="action-arrow"><i class="fas fa-chevron-right"></i></div>
                        </button>
                        <button class="driver-action-card fuel" id="updateFuelBtn" data-action="fuel">
                            <div class="action-icon-container">
                                <i class="fas fa-gas-pump"></i>
                                <div class="fuel-level-indicator" id="fuelLevelIndicator"><div class="fuel-bar" id="fuelBar"></div></div>
                            </div>
                            <div class="action-content">
                                <h4 class="action-title">Update Fuel</h4>
                                <p class="action-subtitle" id="fuelStatusText">75% remaining</p>
                            </div>
                            <div class="action-arrow"><i class="fas fa-chevron-right"></i></div>
                        </button>
                    </div>

                    <!-- Assigned Routes (on Home) -->
                    <div class="driver-home-routes-section">
                        <h3 class="driver-section-title"><i class="fas fa-route"></i> Assigned Routes</h3>
                        <div class="driver-route-list" id="driverRouteList"></div>
                    </div>
                </div>
            </div>

            <!-- Page: Routes (redirects to Home - routes shown there) -->
            <div class="driver-page" id="driverPageRoutes" data-page="routes">
                <div class="driver-mobile-container driver-page-content">
                    <div class="driver-page-header">
                        <h2 class="driver-page-title"><i class="fas fa-route"></i> Routes</h2>
                    </div>
                    <p class="driver-routes-note">Your assigned routes are shown on the <strong>Home</strong> tab.</p>
                    <button type="button" class="btn btn-primary driver-full-btn" onclick="window.driverSystemV3 && window.driverSystemV3.switchDriverPage('home')">
                        <i class="fas fa-home"></i> Go to Home
                    </button>
                </div>
            </div>

            <!-- Page: AI Assistant -->
            <div class="driver-page" id="driverPageAi" data-page="ai">
                <div class="driver-mobile-container driver-page-content">
                    <div class="driver-page-header">
                        <h2 class="driver-page-title"><i class="fas fa-robot"></i> Smart Collection Assistant</h2>
                    </div>
                    <div id="v3SmartCollectionPanel" class="driver-ai-panel-placeholder"></div>
            <!-- ğŸ¤– ENHANCED AI RECOMMENDATION CARD - Connected to Main AI System -->
            <div class="enhanced-ai-suggestion-card" id="aiSuggestionCard" style="display: none;">
                <!-- AI Status Indicator -->
                <div class="ai-status-bar">
                    <div class="ai-status-indicator" id="aiStatusIndicator">
                        <div class="ai-pulse-dot"></div>
                        <span id="aiStatusText">AI Active</span>
                    </div>
                    <div class="ai-confidence-badge" id="aiConfidenceBadge">
                        <i class="fas fa-brain"></i>
                        <span id="aiConfidenceLevel">95%</span>
                    </div>
                </div>

                <!-- AI Header with Animation -->
                <div class="ai-header-section">
                    <div class="ai-title-area">
                        <div class="ai-brain-icon">
                            <i class="fas fa-robot"></i>
                            <div class="ai-thinking-animation"></div>
                        </div>
                        <div class="ai-title-text">
                            <h3>ğŸ¯ Smart Collection Assistant</h3>
                            <p>AI-powered route optimization</p>
                        </div>
                    </div>
                    <div class="ai-controls">
                        <button class="ai-refresh-btn" onclick="refreshDriverAISuggestion()" title="Refresh AI recommendations">
                            <i class="fas fa-sync-alt" id="aiRefreshIcon"></i>
                        </button>
                        <button class="ai-settings-btn" onclick="showAISettings()" title="AI settings">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>

                <!-- Primary Recommendation -->
                <div class="primary-recommendation" id="primaryRecommendation">
                    <div class="recommendation-header">
                        <div class="priority-badge" id="recommendationPriority">
                            <i class="fas fa-star"></i>
                            <span>HIGH PRIORITY</span>
                        </div>
                        <div class="ai-reasoning-indicator" onclick="showAIReasoning()">
                            <i class="fas fa-question-circle"></i>
                        </div>
                    </div>

                    <div class="bin-recommendation-card">
                        <div class="bin-visual">
                            <div class="bin-icon-container">
                                <i class="fas fa-trash-alt" id="recommendedBinIcon"></i>
                                <div class="fill-level-ring" id="fillLevelRing">
                                    <div class="fill-percentage" id="fillPercentage">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bin-info-section">
                            <div class="bin-primary-info">
                                <h4 class="bin-id" id="recommendedBinId">Analyzing...</h4>
                                <p class="bin-location" id="recommendedBinLocation">Calculating optimal route...</p>
                            </div>
                            
                            <div class="bin-status-chips">
                                <div class="status-chip urgent" id="urgencyChip">
                                    <i class="fas fa-exclamation"></i>
                                    <span id="urgencyLevel">Urgent</span>
                                </div>
                                <div class="status-chip efficiency" id="efficiencyChip">
                                    <i class="fas fa-route"></i>
                                    <span id="efficiencyLevel">Optimal</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Metrics Grid -->
                    <div class="smart-metrics-grid">
                        <div class="metric-card distance">
                            <div class="metric-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartDistance">Calculating...</span>
                                <span class="metric-label">Distance</span>
                            </div>
                            <div class="metric-trend" id="distanceTrend">
                                <i class="fas fa-arrow-down text-success"></i>
                            </div>
                        </div>

                        <div class="metric-card time">
                            <div class="metric-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartTime">Estimating...</span>
                                <span class="metric-label">Est. Time</span>
                            </div>
                            <div class="metric-trend" id="timeTrend">
                                <i class="fas fa-arrow-right text-warning"></i>
                            </div>
                        </div>

                        <div class="metric-card savings">
                            <div class="metric-icon">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartSavings">Computing...</span>
                                <span class="metric-label">COâ‚‚ Saved</span>
                            </div>
                            <div class="metric-trend" id="savingsTrend">
                                <i class="fas fa-arrow-up text-success"></i>
                            </div>
                        </div>

                        <div class="metric-card score">
                            <div class="metric-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartScore">Loading...</span>
                                <span class="metric-label">AI Score</span>
                            </div>
                            <div class="metric-trend" id="scoreTrend">
                                <i class="fas fa-arrow-up text-success"></i>
                            </div>
                        </div>
                    </div>

                    <!-- AI Reasoning Panel -->
                    <div class="ai-reasoning-panel" id="aiReasoningPanel">
                        <div class="reasoning-header">
                            <i class="fas fa-lightbulb"></i>
                            <span>AI Reasoning</span>
                        </div>
                        <div class="reasoning-content" id="aiReasoningContent">
                            Analyzing optimal collection route based on proximity, urgency, and efficiency factors...
                        </div>
                        <div class="reasoning-factors" id="reasoningFactors">
                            <!-- Dynamic reasoning factors will be inserted here -->
                        </div>
                    </div>

                    <!-- Smart Action Buttons -->
                    <div class="smart-action-buttons">
                        <button class="primary-action-btn" onclick="acceptSmartRecommendation()" id="acceptBtn">
                            <div class="btn-icon">
                                <i class="fas fa-route"></i>
                            </div>
                            <div class="btn-content">
                                <span class="btn-title">Start Collection</span>
                                <span class="btn-subtitle">Accept AI route</span>
                            </div>
                        </button>

                        <div class="secondary-actions">
                            <button class="secondary-action-btn" onclick="viewRecommendationDetails()" title="View full details">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="secondary-action-btn" onclick="showAlternativeRoutes()" title="Alternative routes">
                                <i class="fas fa-random"></i>
                            </button>
                            <button class="secondary-action-btn" onclick="dismissSmartRecommendation()" title="Dismiss recommendation">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="ai-loading-state" id="aiLoadingState">
                    <div class="loading-animation">
                        <div class="ai-brain-loader">
                            <i class="fas fa-brain"></i>
                            <div class="pulse-rings">
                                <div class="pulse-ring"></div>
                                <div class="pulse-ring"></div>
                                <div class="pulse-ring"></div>
                            </div>
                        </div>
                        <h4>AI Computing Optimal Route...</h4>
                        <p>Analyzing traffic, bin priorities, and efficiency factors</p>
                    </div>
                </div>

                <!-- No Recommendations State -->
                <div class="no-recommendations-state" id="noRecommendationsState" style="display: none;">
                    <div class="empty-state-content">
                        <i class="fas fa-check-circle"></i>
                        <h4>All Set!</h4>
                        <p>No urgent collections needed at the moment</p>
                        <button class="btn-secondary" onclick="refreshDriverAISuggestion()">
                            <i class="fas fa-sync-alt"></i> Check Again
                        </button>
                    </div>
                </div>
            </div>
                </div>
            </div>

            <!-- Page: Messages -->
            <div class="driver-page" id="driverPageMessages" data-page="messages">
                <div class="driver-mobile-container driver-page-content">
                    <div class="driver-page-header">
                        <h2 class="driver-page-title"><i class="fas fa-comments"></i> Messages</h2>
                    </div>
            <div class="enhanced-messaging-system enhanced-messaging-fullpage" id="driverMessagingSystem">
                <div class="messaging-header">
                    <div class="messaging-title">
                        <i class="fas fa-comments"></i>
                        <h3>Messages</h3>
                        <span class="message-count" id="unreadMessageCount" style="display: none;">0</span>
                    </div>
                    <div class="messaging-actions">
                        <button class="messaging-action-btn" onclick="toggleMessagingSystem()" id="toggleMessagingBtn">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messaging-content" id="messagingContent">
                    <!-- Online Status -->
                    <div class="messaging-status">
                        <div class="status-indicator online"></div>
                        <span>Management Team</span>
                        <div class="typing-indicator" id="typingIndicator" style="display: none;">
                            <span>Typing...</span>
                            <div class="typing-dots">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages Container -->
                    <div class="messages-container" id="messagesContainer">
                        <div class="welcome-message">
                            <i class="fas fa-info-circle"></i>
                            <p>Welcome! You can receive messages from the management team here.</p>
                            <p>All messages are delivered in real-time.</p>
                        </div>
                    </div>
                    
                    <!-- Message Input -->
                    <div class="message-input-container">
                        <div class="message-input-wrapper">
                            <input type="text" 
                                   id="driverMessageInput" 
                                   placeholder="Type your message..." 
                                   maxlength="500"
                                   autocomplete="off">
                            <div class="message-input-actions">
                                <button class="emoji-btn" onclick="showEmojiPicker()" title="Add Emoji">
                                    ğŸ˜Š
                                </button>
                                <button class="send-btn" onclick="sendDriverMessage()" id="sendMessageBtn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div class="message-tools">
                            <button class="tool-btn" onclick="attachImage()" title="Attach Image">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="tool-btn" onclick="shareLocation()" title="Share Location">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="tool-btn emergency" onclick="sendEmergencyMessage()" title="Emergency Alert">
                                <i class="fas fa-exclamation-triangle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Replies -->
                    <div class="quick-replies" id="quickReplies">
                        <button class="quick-reply-btn" onclick="sendQuickReply('âœ… Acknowledged')">âœ… Acknowledged</button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('ğŸš› On my way')">ğŸš› On my way</button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('â° Need more time')">â° Need more time</button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('â“ Need clarification')">â“ Need clarification</button>
                    </div>
                </div>
            </div>
                </div>
            </div>

            <!-- Page: More -->
            <div class="driver-page" id="driverPageMore" data-page="more">
                <div class="driver-mobile-container driver-page-content">
                    <div class="driver-page-header">
                        <h2 class="driver-page-title"><i class="fas fa-th-large"></i> More</h2>
                    </div>
                    <div class="driver-more-menu">
                        <button class="driver-more-card" onclick="showDriverHistoryModal()">
                            <div class="driver-more-icon"><i class="fas fa-history"></i></div>
                            <div class="driver-more-text">
                                <span class="driver-more-title">My Collection History</span>
                                <span class="driver-more-desc">View & export your collection report</span>
                            </div>
                            <i class="fas fa-chevron-right driver-more-arrow"></i>
                        </button>
                        <button class="driver-more-card driver-more-hidden" onclick="generateComprehensiveSampleData()">
                            <div class="driver-more-icon driver-more-icon-secondary"><i class="fas fa-flask"></i></div>
                            <div class="driver-more-text">
                                <span class="driver-more-title">Generate Sample Data</span>
                                <span class="driver-more-desc">For testing (dev)</span>
                            </div>
                            <i class="fas fa-chevron-right driver-more-arrow"></i>
                        </button>
                        <button class="driver-more-card driver-more-hidden" onclick="if(window.autoCollectionTestHelper) window.autoCollectionTestHelper.showPanel(); else alert('Test panel not loaded.');">
                            <div class="driver-more-icon driver-more-icon-secondary"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="driver-more-text">
                                <span class="driver-more-title">Test auto-collection</span>
                                <span class="driver-more-desc">Simulate at a bin to test auto-record (no GPS needed)</span>
                            </div>
                            <i class="fas fa-chevron-right driver-more-arrow"></i>
                        </button>
                    </div>
                    <div class="driver-more-section-title driver-more-hidden">Quick actions</div>
                    <div class="driver-quick-actions-inline driver-more-hidden">
                        <button type="button" class="quick-action-btn driver-more-qab" onclick="document.getElementById('scanBinQRBtn')?.click()" title="Scan QR Code"><i class="fas fa-qrcode"></i><span>Scan QR</span></button>
                        <button type="button" class="quick-action-btn driver-more-qab" onclick="document.getElementById('callDispatchBtn')?.click()" title="Call Dispatch"><i class="fas fa-phone"></i><span>Dispatch</span></button>
                        <button type="button" class="quick-action-btn driver-more-qab" onclick="document.getElementById('takeBreakBtn')?.click()" title="Take Break"><i class="fas fa-coffee"></i><span>Break</span></button>
                        <button type="button" class="quick-action-btn driver-more-qab" onclick="document.getElementById('endShiftBtn')?.click()" title="End Shift"><i class="fas fa-power-off"></i><span>End Shift</span></button>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <nav class="driver-bottom-nav" id="driverBottomNav" role="navigation">
                <button class="driver-nav-item active" data-page="home" aria-label="Home">
                    <i class="fas fa-home driver-nav-icon"></i>
                    <span class="driver-nav-label">Home</span>
                    <span class="driver-nav-badge" id="driverNavHomeBadge" style="display: none;">0</span>
                </button>
                <button class="driver-nav-item" data-page="routes" aria-label="Routes">
                    <i class="fas fa-route driver-nav-icon"></i>
                    <span class="driver-nav-label">Routes</span>
                </button>
                <button class="driver-nav-item" data-page="ai" aria-label="AI Assistant">
                    <i class="fas fa-robot driver-nav-icon"></i>
                    <span class="driver-nav-label">AI</span>
                </button>
                <button class="driver-nav-item" data-page="messages" aria-label="Messages">
                    <i class="fas fa-comments driver-nav-icon"></i>
                    <span class="driver-nav-label">Messages</span>
                    <span class="driver-nav-badge" id="driverNavMessageBadge" style="display: none;">0</span>
                </button>
                <button class="driver-nav-item" data-page="more" aria-label="More">
                    <i class="fas fa-th-large driver-nav-icon"></i>
                    <span class="driver-nav-label">More</span>
                    <span class="driver-nav-badge" id="driverNavMoreBadge" style="display: none;">0</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Sync error banner (#22 loading/error states) - hidden by default -->
        <div id="syncErrorBanner" class="sync-error-banner" style="display: none; padding: 0.75rem 1rem; background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 10px; margin-bottom: 1rem; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
            <span><i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> <span id="syncErrorBannerText">Sync failed.</span></span>
            <button type="button" class="btn btn-sm" id="syncErrorBannerRetry" style="background: #ef4444; color: white; border: none;">Retry</button>
        </div>
        <!-- City Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h1 style="font-size: 2.5rem; margin-bottom: 2rem; background: linear-gradient(135deg, #fff 0%, #94a3b8 100%); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Smart City Command Center
            </h1>
            
            <!-- Key Metrics - World Class UI -->
            <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="glass-card stat-card dashboard-metric-card" style="padding: 2rem 1.75rem; min-height: 220px; display: flex; flex-direction: column; align-items: center;">
                    <div class="stat-header" style="margin-bottom: 1.25rem; width: 100%; display: flex; justify-content: center;">
                        <div class="stat-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(59, 130, 246, 0.4); border: 2px solid rgba(59, 130, 246, 0.4);">
                            <i class="fas fa-city" style="color: #60a5fa; font-size: 2.25rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="cleanlinessIndex" style="text-align: center;">0%</div>
                    <div class="stat-label" style="text-align: center;">City Cleanliness Index</div>
                    <div class="progress-bar" style="margin-top: 1rem; width: 100%;">
                        <div class="progress-fill" id="cleanlinessProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="glass-card stat-card dashboard-metric-card" style="padding: 2rem 1.75rem; min-height: 220px; display: flex; flex-direction: column; align-items: center;">
                    <div class="stat-header" style="margin-bottom: 1.25rem; width: 100%; display: flex; justify-content: center;">
                        <div class="stat-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); border: 2px solid rgba(16, 185, 129, 0.4);">
                            <i class="fas fa-check-circle" style="color: #34d399; font-size: 2.25rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="todayCollections" style="text-align: center;">0</div>
                    <div class="stat-label" style="text-align: center;">Collections Today</div>
                    <div class="progress-bar" style="margin-top: 1rem; width: 100%;">
                        <div class="progress-fill" id="collectionsProgress" style="width: 0%; background: linear-gradient(90deg, #10b981 0%, #34d399 100%);"></div>
                    </div>
                </div>

                <div class="glass-card stat-card dashboard-metric-card" style="padding: 2rem 1.75rem; min-height: 220px; display: flex; flex-direction: column; align-items: center;">
                    <div class="stat-header" style="margin-bottom: 1.25rem; width: 100%; display: flex; justify-content: center;">
                        <div class="stat-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(245, 158, 11, 0.4); border: 2px solid rgba(245, 158, 11, 0.4);">
                            <i class="fas fa-users" style="color: #fbbf24; font-size: 2.25rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeComplaintsCount" style="text-align: center;">0</div>
                    <div class="stat-label" style="text-align: center;">Active Complaints</div>
                    <div class="progress-bar" style="margin-top: 1rem; width: 100%;">
                        <div class="progress-fill" id="complaintsProgress" style="width: 0%; background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);"></div>
                    </div>
                </div>

                <div class="glass-card stat-card dashboard-metric-card" style="padding: 2rem 1.75rem; min-height: 220px; display: flex; flex-direction: column; align-items: center;">
                    <div class="stat-header" style="margin-bottom: 1.25rem; width: 100%; display: flex; justify-content: center;">
                        <div class="stat-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(124, 58, 237, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(124, 58, 237, 0.4); border: 2px solid rgba(124, 58, 237, 0.4);">
                            <i class="fas fa-dollar-sign" style="color: #a78bfa; font-size: 2.25rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="costReduction" style="text-align: center;">0%</div>
                    <div class="stat-label" style="text-align: center;">Cost Reduction</div>
                    <div class="progress-bar" style="margin-top: 1rem; width: 100%;">
                        <div class="progress-fill" id="costProgress" style="width: 0%; background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);"></div>
                    </div>
                </div>
            </div>

            <!-- City Overview -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">City-Wide Impact</h2>
                <div class="stats-grid">
                    <div class="city-metric">
                        <i class="fas fa-smile metric-icon-large"></i>
                        <div class="stat-value" id="citizenSatisfaction">0%</div>
                        <div class="stat-label">Citizen Satisfaction</div>
                    </div>
                    <div class="city-metric">
                        <i class="fas fa-leaf metric-icon-large"></i>
                        <div class="stat-value" id="carbonReduction">0%</div>
                        <div class="stat-label">Carbon Emissions</div>
                    </div>
                    <div class="city-metric">
                        <i class="fas fa-clock metric-icon-large"></i>
                        <div class="stat-value" id="avgResponseTime">0min</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="emergencyResponseBtn">
                        <i class="fas fa-exclamation-triangle"></i>
                        Emergency Response
                    </button>
                    <button class="btn btn-secondary" id="optimizeRoutesBtn">
                        <i class="fas fa-magic"></i>
                        Optimize All Routes
                    </button>
                    <button class="btn btn-secondary" id="generateReportBtn" onclick="generateComprehensiveReport()">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Monitoring Section - World-class single header, no duplication -->
        <div id="monitoring" class="content-section monitoring-page" style="display: none;">
            <header class="monitoring-page-header">
                <h1 class="monitoring-title">Live Monitoring System</h1>
                <span class="live-badge" aria-live="polite"><span class="live-dot"></span>LIVE</span>
            </header>
            
            <!-- #12 Quick filters for map -->
            <div id="monitoringMapFilters" class="monitoring-map-filters" style="display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(15,23,42,0.6); border-radius: 12px; border: 1px solid rgba(255,255,255,0.08);">
                <span style="color: #94a3b8; font-size: 0.85rem; font-weight: 600;">Filters:</span>
                <select id="monitoringFilterFill" class="form-input" style="width: auto; min-width: 110px; padding: 0.4rem 0.6rem; font-size: 0.85rem;" title="Fill level">
                    <option value="all">All fill levels</option>
                    <option value="50">&gt;50%</option>
                    <option value="80">&gt;80%</option>
                    <option value="90">Critical (&gt;90%)</option>
                </select>
                <select id="monitoringFilterSensor" class="form-input" style="width: auto; min-width: 110px; padding: 0.4rem 0.6rem; font-size: 0.85rem;" title="Has sensor">
                    <option value="all">All sensors</option>
                    <option value="yes">Has sensor</option>
                    <option value="no">No sensor</option>
                </select>
                <select id="monitoringFilterAssigned" class="form-input" style="width: auto; min-width: 120px; padding: 0.4rem 0.6rem; font-size: 0.85rem;" title="Assigned to route">
                    <option value="all">All</option>
                    <option value="assigned">Assigned</option>
                    <option value="unassigned">Unassigned</option>
                </select>
                <select id="monitoringFilterDriver" class="form-input" style="width: auto; min-width: 140px; padding: 0.4rem 0.6rem; font-size: 0.85rem;" title="Driver">
                    <option value="">All drivers</option>
                    <!-- Populated by JS -->
                </select>
                <button type="button" class="btn btn-sm btn-secondary" id="monitoringFilterApply" style="padding: 0.4rem 0.75rem;"><i class="fas fa-filter"></i> Apply</button>
                <button type="button" class="btn btn-sm" id="monitoringFilterClear" style="padding: 0.4rem 0.75rem; background: rgba(255,255,255,0.1); color: #94a3b8;">Clear</button>
            </div>
            
            <!-- Map Container -->
            <div class="map-container">
                <div id="map" style="width: 100%; border-radius: 20px; min-height: 85vh;"></div>
                <div id="mapLoading" class="map-loading" style="display: none;">
                    <div class="spinner"></div>
                    <div>Loading Map...</div>
                </div>
                
                <!-- Tracking Panel - World Class UI -->
                <div class="tracking-panel">
                    <!-- Live System Status (single LIVE is in page header) -->
                    <div class="glass-card system-status-card">
                        <div class="tracking-header">
                            <h3><i class="fas fa-satellite-dish" style="color: #3b82f6;"></i> System Status</h3>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="status-stat-card sensor-card">
                                <div class="status-stat-icon" style="width: 52px; height: 52px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%); box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); border-radius: 13px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem auto; border: 2px solid rgba(59, 130, 246, 0.4);">
                                    <i class="fas fa-satellite-dish" style="color: #60a5fa; font-size: 1.75rem;"></i>
                                </div>
                                <div class="stat-value" id="activeSensorsCount">0</div>
                                <div class="stat-label">Active Sensors</div>
                            </div>
                            <div class="status-stat-card vehicle-card">
                                <div class="status-stat-icon" style="width: 52px; height: 52px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.2) 100%); box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4); border-radius: 13px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem auto; border: 2px solid rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-truck" style="color: #34d399; font-size: 1.75rem;"></i>
                                </div>
                                <div class="stat-value" id="onlineVehiclesCount">0</div>
                                <div class="stat-label">Online Vehicles</div>
                            </div>
                            <div class="status-stat-card driver-card">
                                <div class="status-stat-icon" style="width: 52px; height: 52px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(124, 58, 237, 0.2) 100%); box-shadow: 0 6px 16px rgba(124, 58, 237, 0.4); border-radius: 13px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem auto; border: 2px solid rgba(124, 58, 237, 0.4);">
                                    <i class="fas fa-user-check" style="color: #a78bfa; font-size: 1.75rem;"></i>
                                </div>
                                <div class="stat-value" id="activeDriversStatus">0</div>
                                <div class="stat-label">Active Drivers</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Critical Bins - Enhanced -->
                    <div class="glass-card critical-bins-section">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(239, 68, 68, 0.2);">
                            <h4 style="font-size: 1rem; font-weight: 700; color: #f1f5f9; display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                                <span style="font-size: 1.1rem;">ğŸš¨</span> Critical Bins
                            </h4>
                            <span id="criticalBinsCount" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);">0</span>
                        </div>
                        <div class="bin-list bin-list-expanded" id="criticalBinsList">
                            <!-- Will be populated dynamically -->
                            <div class="no-data-placeholder" style="text-align: center; padding: 1.5rem; color: #64748b; font-size: 0.85rem;">
                                <i class="fas fa-check-circle" style="font-size: 1.5rem; color: #10b981; margin-bottom: 0.5rem; display: block;"></i>
                                No critical bins at this time
                            </div>
                        </div>
                    </div>
                    
                    <!-- Active Alerts - Enhanced -->
                    <div class="glass-card active-alerts-section">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(245, 158, 11, 0.2);">
                            <h4 style="font-size: 1rem; font-weight: 700; color: #f1f5f9; display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                                <span style="font-size: 1.1rem;">âš¡</span> Active Alerts
                            </h4>
                            <span id="activeAlertsCountBadge" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);">0</span>
                        </div>
                        <div class="alerts-list-expanded" id="activeAlertsList">
                            <!-- Will be populated dynamically -->
                            <div class="no-data-placeholder" style="text-align: center; padding: 1.5rem; color: #64748b; font-size: 0.85rem;">
                                <i class="fas fa-bell-slash" style="font-size: 1.5rem; color: #64748b; margin-bottom: 0.5rem; display: block;"></i>
                                No active alerts
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fleet Management Section -->
        <div id="fleet" class="content-section" style="display: none;">
            <!-- Fleet Management Layout with Sidebar -->
            <div style="display: flex; gap: 0; min-height: calc(100vh - 100px);">
                <!-- Left Sidebar Navigation -->
                <div id="fleetSidebar" class="fleet-sidebar" style="
                    width: 280px;
                    min-width: 280px;
                    background: linear-gradient(180deg, rgba(15,23,42,0.98) 0%, rgba(30,41,59,0.98) 100%);
                    border-right: 1px solid rgba(255,255,255,0.1);
                    padding: 1.5rem 0;
                    overflow-y: auto;
                    position: sticky;
                    top: 0;
                    height: calc(100vh - 80px);
                    z-index: 100;
                ">
                    <div style="padding: 0 1.5rem; margin-bottom: 2rem; position: relative;">
                        <div style="
                            position: absolute;
                            top: -10px;
                            right: -10px;
                            width: 80px;
                            height: 80px;
                            background: linear-gradient(135deg, rgba(59,130,246,0.2) 0%, rgba(37,99,235,0.1) 100%);
                            border-radius: 50%;
                            filter: blur(20px);
                            z-index: 0;
                        "></div>
                        <div style="position: relative; z-index: 1;">
                            <h2 style="font-size: 1.5rem; margin: 0; color: #f1f5f9; font-weight: 800; display: flex; align-items: center; gap: 0.75rem; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                <i class="fas fa-truck" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.75rem;"></i> 
                                Fleet Management
                            </h2>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.5rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase;">Enterprise-Grade Platform</div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.5rem; background: rgba(16,185,129,0.1); border-radius: 8px; border: 1px solid rgba(16,185,129,0.2);">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 8px #10b981; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 0.75rem; color: #10b981; font-weight: 600;">Live Operations</span>
                            </div>
                        </div>
                    </div>
                    
                    <nav class="fleet-sidebar-nav" style="padding: 0 1rem;">
                        <!-- Main Navigation Groups -->
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸ“ Tracking & Telematics</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('map');} return false;" class="nav-item" data-tab="map">
                                <i class="fas fa-map-marked-alt"></i> Live Map
                                <span class="nav-badge" id="navBadgeMap">0</span>
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('geofencing');} return false;" class="nav-item" data-tab="geofencing">
                                <i class="fas fa-map-pin"></i> Geofencing
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('assets');} return false;" class="nav-item" data-tab="assets">
                                <i class="fas fa-box"></i> Asset Tracking
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">âš™ï¸ Vehicle Health</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('diagnostics');} return false;" class="nav-item" data-tab="diagnostics">
                                <i class="fas fa-wrench"></i> Diagnostics
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('maintenance');} return false;" class="nav-item" data-tab="maintenance">
                                <i class="fas fa-tools"></i> Maintenance
                                <span class="nav-badge" id="navBadgeMaintenance">0</span>
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸš¦ Safety & Behavior</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('safety');} return false;" class="nav-item" data-tab="safety">
                                <i class="fas fa-shield-alt"></i> Safety
                                <span class="nav-badge nav-badge-danger" id="navBadgeSafety">0</span>
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('video');} return false;" class="nav-item" data-tab="video">
                                <i class="fas fa-video"></i> Dash Cams
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('coaching');} return false;" class="nav-item" data-tab="coaching">
                                <i class="fas fa-graduation-cap"></i> Driver Coaching
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸ›£ï¸ Operations</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('routes');} return false;" class="nav-item" data-tab="routes">
                                <i class="fas fa-route"></i> Routes
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('dispatch');} return false;" class="nav-item" data-tab="dispatch">
                                <i class="fas fa-tasks"></i> Dispatch
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('drivers');} return false;" class="nav-item" data-tab="drivers">
                                <i class="fas fa-users"></i> Drivers
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('vehicles');} return false;" class="nav-item" data-tab="vehicles">
                                <i class="fas fa-truck"></i> Vehicles
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸ“‹ Compliance</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('compliance');} return false;" class="nav-item" data-tab="compliance">
                                <i class="fas fa-clipboard-check"></i> Compliance
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('eld');} return false;" class="nav-item" data-tab="eld">
                                <i class="fas fa-clock"></i> ELD / HOS
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('inspections');} return false;" class="nav-item" data-tab="inspections">
                                <i class="fas fa-clipboard-list"></i> Inspections
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">â›½ Efficiency</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('fuel');} return false;" class="nav-item" data-tab="fuel">
                                <i class="fas fa-gas-pump"></i> Fuel Management
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('energy');} return false;" class="nav-item" data-tab="energy">
                                <i class="fas fa-bolt"></i> Energy & EV
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸ“Š Analytics</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('analytics');} return false;" class="nav-item" data-tab="analytics">
                                <i class="fas fa-chart-bar"></i> Analytics
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('reports');} return false;" class="nav-item" data-tab="reports">
                                <i class="fas fa-file-alt"></i> Reports
                            </a>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('ml');} return false;" class="nav-item" data-tab="ml">
                                <i class="fas fa-brain"></i> AI Insights
                            </a>
                        </div>
                        
                        <div class="nav-group">
                            <div class="nav-group-title">ğŸ’¬ Communication</div>
                            <a href="#" onclick="if(window.fleetManager){window.fleetManager.switchTab('messaging');} return false;" class="nav-item" data-tab="messaging">
                                <i class="fas fa-comments"></i> Messages
                                <span class="nav-badge" id="navBadgeMessages">0</span>
                            </a>
                        </div>
                    </nav>
                    
                    <!-- Sidebar Footer -->
                    <div class="sidebar-footer" style="padding: 1.5rem; margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); background: linear-gradient(180deg, transparent 0%, rgba(15,23,42,0.3) 100%);">
                        <button onclick="if(window.fleetManager){window.fleetManager.refresh();}" class="btn btn-secondary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                        <button onclick="if(window.fleetManager){window.fleetManager.exportData();}" class="btn btn-secondary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-download"></i> Export All
                        </button>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div style="flex: 1; padding: 2rem; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h1 style="font-size: 2rem; margin: 0; color: #f1f5f9;">ğŸš› Autonautics Fleet Management</h1>
                            <div style="font-size: 0.875rem; color: #94a3b8; margin-top: 0.25rem;">Enterprise-grade fleet operations platform</div>
                        </div>
                        <div style="display: flex; gap: 0.75rem;">
                            <button id="fleetRefreshBtn" class="btn btn-primary" onclick="if(window.fleetManager){window.fleetManager.refresh();}" style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button id="fleetExportBtn" class="btn btn-secondary" onclick="if(window.fleetManager){window.fleetManager.exportData();}" style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
            
            <!-- Enhanced Fleet Overview Stats - Compact Version -->
            <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                
                <!-- Active Vehicles Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); border: 2px solid rgba(59, 130, 246, 0.4);">
                            <i class="fas fa-truck" style="color: #60a5fa; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeVehiclesCount" style="font-size: 2.25rem; font-weight: 800; color: #60a5fa; line-height: 1; margin-bottom: 0.5rem; text-align: center;">0</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">Active Vehicles</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="totalVehiclesCount">of 0 total</div>
                </div>
                
                <!-- Available Drivers Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4); border: 2px solid rgba(16, 185, 129, 0.4);">
                            <i class="fas fa-user-check" style="color: #34d399; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="availableDriversCount" style="font-size: 2.25rem; font-weight: 800; color: #34d399; line-height: 1; margin-bottom: 0.5rem; text-align: center;">0</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">Available Drivers</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="totalDriversCount">of 0 total</div>
                </div>
                
                <!-- Active Routes Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4); border: 2px solid rgba(245, 158, 11, 0.4);">
                            <i class="fas fa-route" style="color: #fbbf24; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeRoutesCount" style="font-size: 2.25rem; font-weight: 800; color: #fbbf24; line-height: 1; margin-bottom: 0.5rem; text-align: center;">2</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">Active Routes</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="mlOptimizedRoutes">0 ML optimized</div>
                </div>
                
                <!-- In Maintenance Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(239, 68, 68, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4); border: 2px solid rgba(239, 68, 68, 0.4);">
                            <i class="fas fa-tools" style="color: #f87171; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="maintenanceVehiclesCount" style="font-size: 2.25rem; font-weight: 800; color: #f87171; line-height: 1; margin-bottom: 0.5rem; text-align: center;">0</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">In Maintenance</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="predictedMaintenance">0 predicted</div>
                </div>
                
                <!-- Fleet Utilization Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(139, 92, 246, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); border: 2px solid rgba(139, 92, 246, 0.4);">
                            <i class="fas fa-chart-line" style="color: #a78bfa; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="fleetUtilization" style="font-size: 2.25rem; font-weight: 800; color: #a78bfa; line-height: 1; margin-bottom: 0.5rem; text-align: center;">3%</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">Fleet Utilization</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="avgEfficiency">Avg: 86%</div>
                </div>
                
                <!-- ML Optimizations Card -->
                <div class="glass-card stat-card fleet-stat-card" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 12px; padding: 1.25rem 1rem; min-height: 140px; transition: all 0.3s ease; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div class="stat-icon" style="width: 55px; height: 55px; background: linear-gradient(135deg, rgba(236, 72, 153, 0.3) 0%, rgba(236, 72, 153, 0.2) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4); border: 2px solid rgba(236, 72, 153, 0.4);">
                            <i class="fas fa-brain" style="color: #f472b6; font-size: 1.75rem;"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="mlOptimizations" style="font-size: 2.25rem; font-weight: 800; color: #f472b6; line-height: 1; margin-bottom: 0.5rem; text-align: center;">0</div>
                    <div class="stat-label" style="font-size: 0.75rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; margin-bottom: 0.35rem; text-align: center;">ML Optimizations</div>
                    <div style="font-size: 0.7rem; color: #64748b; font-weight: 500; text-align: center;" id="mlSavings">$0 saved</div>
                </div>
                
            </div>
            
            <!-- Advanced Search and Filters -->
            <div class="glass-card" style="margin-bottom: 1.5rem; padding: 1.5rem;">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <div style="flex: 1; min-width: 250px;">
                        <input type="text" id="fleetSearchInput" placeholder="ğŸ” Search drivers, vehicles, routes..." 
                            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0; font-size: 0.9rem;"
                            onkeyup="fleetManager.handleSearch(event)">
                    </div>
                    <select id="fleetStatusFilter" onchange="fleetManager.applyFilters()" 
                        style="padding: 0.75rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0; font-size: 0.9rem; min-width: 150px;">
                        <option value="all">All Status</option>
                        <option value="active">Active</option>
                        <option value="on-route">On Route</option>
                        <option value="available">Available</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="offline">Offline</option>
                    </select>
                    <select id="fleetTypeFilter" onchange="fleetManager.applyFilters()"
                        style="padding: 0.75rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0; font-size: 0.9rem; min-width: 150px;">
                        <option value="all">All Types</option>
                        <option value="driver">Drivers</option>
                        <option value="vehicle">Vehicles</option>
                        <option value="route">Routes</option>
                    </select>
                    <button onclick="if(window.fleetManager){window.fleetManager.showAdvancedFilters();}" class="btn btn-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-filter"></i> Advanced
                    </button>
                </div>
            </div>
            
            <!-- Tabs for different views - Enterprise Features (Hidden - using sidebar now) -->
            <div style="display: none; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid rgba(255,255,255,0.1); overflow-x: auto; flex-wrap: wrap;">
                <button id="fleetTabMap" onclick="if(window.fleetManager){window.fleetManager.switchTab('map');}" class="fleet-tab-btn active" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid #3b82f6; color: #3b82f6; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-map-marked-alt"></i> Live Map
                </button>
                <button id="fleetTabDrivers" onclick="if(window.fleetManager){window.fleetManager.switchTab('drivers');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-users"></i> Drivers
                </button>
                <button id="fleetTabVehicles" onclick="if(window.fleetManager){window.fleetManager.switchTab('vehicles');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-truck"></i> Vehicles
                </button>
                <button id="fleetTabSafety" onclick="if(window.fleetManager){window.fleetManager.switchTab('safety');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-shield-alt"></i> Safety
                </button>
                <button id="fleetTabVideo" onclick="if(window.fleetManager){window.fleetManager.switchTab('video');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-video"></i> Video
                </button>
                <button id="fleetTabCoaching" onclick="if(window.fleetManager){window.fleetManager.switchTab('coaching');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-graduation-cap"></i> Coaching
                </button>
                <button id="fleetTabDiagnostics" onclick="if(window.fleetManager){window.fleetManager.switchTab('diagnostics');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-wrench"></i> Diagnostics
                </button>
                <button id="fleetTabCompliance" onclick="if(window.fleetManager){window.fleetManager.switchTab('compliance');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-clipboard-check"></i> Compliance
                </button>
                <button id="fleetTabRoutes" onclick="if(window.fleetManager){window.fleetManager.switchTab('routes');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-route"></i> Routes
                </button>
                <button id="fleetTabMaintenance" onclick="if(window.fleetManager){window.fleetManager.switchTab('maintenance');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-tools"></i> Maintenance
                </button>
                <button id="fleetTabMessaging" onclick="if(window.fleetManager){window.fleetManager.switchTab('messaging');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-comments"></i> Messages
                </button>
                <button id="fleetTabAnalytics" onclick="if(window.fleetManager){window.fleetManager.switchTab('analytics');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-chart-bar"></i> Analytics
                </button>
                <button id="fleetTabReports" onclick="if(window.fleetManager){window.fleetManager.switchTab('reports');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-file-alt"></i> Reports
                </button>
                <button id="fleetTabML" onclick="if(window.fleetManager){window.fleetManager.switchTab('ml');}" class="fleet-tab-btn" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 2px solid transparent; color: #94a3b8; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    <i class="fas fa-brain"></i> AI Insights
                </button>
            </div>
            
            <!-- Live Map Tab Content -->
            <div id="fleetTabContentMap" class="fleet-tab-content">
                <div class="glass-card" style="padding: 0; overflow: hidden;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="margin: 0;">ğŸ—ºï¸ Real-Time Fleet Map</h3>
                        <div style="display: flex; gap: 0.75rem; align-items: center;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; box-shadow: 0 0 8px #10b981;"></div>
                                    <span style="font-size: 0.875rem; color: #94a3b8;">Active</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%; box-shadow: 0 0 8px #f59e0b;"></div>
                                    <span style="font-size: 0.875rem; color: #94a3b8;">In Road</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%; box-shadow: 0 0 8px #ef4444;"></div>
                                    <span style="font-size: 0.875rem; color: #94a3b8;">Maintenance</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 12px; height: 12px; background: #6b7280; border-radius: 50%; box-shadow: 0 0 8px #6b7280;"></div>
                                    <span style="font-size: 0.875rem; color: #94a3b8;">Offline</span>
                                </div>
                            </div>
                            <button onclick="if(window.fleetManager){window.fleetManager.refreshMap();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div id="fleetMapContainer" style="width: 100%; height: 75vh; min-height: 600px; position: relative; background: #0f172a;">
                        <!-- Fleet map will be initialized here -->
                        <div id="fleetMap" style="width: 100%; height: 100%;"></div>
                        <!-- Map Controls Overlay -->
                        <div style="position: absolute; top: 1rem; right: 1rem; z-index: 1000; display: flex; flex-direction: column; gap: 0.5rem;">
                            <button onclick="if(window.fleetManager){window.fleetManager.fitAllVehicles();}" class="btn btn-secondary" style="padding: 0.75rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                                <i class="fas fa-compress-arrows-alt"></i> Fit All
                            </button>
                            <button id="fleetMapRouteLinesBtn" onclick="if(window.fleetManager && window.fleetManager.toggleRouteLines){window.fleetManager.toggleRouteLines();}" class="btn btn-secondary" style="padding: 0.75rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);" title="Show or hide route lines (blue = pending, orange = in progress)">
                                <i class="fas fa-route"></i> <span id="fleetMapRouteLinesLabel">Route lines</span>
                            </button>
                            <button onclick="if(window.fleetManager){window.fleetManager.toggleMapLayers();}" class="btn btn-secondary" style="padding: 0.75rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);" title="Map layers (coming soon)">
                                <i class="fas fa-layer-group"></i> Layers
                            </button>
                            <button id="fleetMapSettingsBtn" onclick="if(typeof window.openFleetMapSettings==='function'){window.openFleetMapSettings();}" class="btn btn-secondary" style="padding: 0.75rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);" title="Map settings">
                                <i class="fas fa-cog"></i> Settings
                            </button>
                        </div>
                        <!-- Map Settings panel (hidden by default) -->
                        <div id="fleetMapSettingsPanel" style="display: none; position: absolute; top: 4.5rem; right: 1rem; z-index: 1001; background: rgba(15,23,42,0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; min-width: 220px; box-shadow: 0 8px 24px rgba(0,0,0,0.4);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: #e2e8f0;"><i class="fas fa-cog"></i> Map settings</strong>
                                <button type="button" onclick="document.getElementById('fleetMapSettingsPanel').style.display='none';" style="background: none; border: none; color: #94a3b8; cursor: pointer; padding: 0 4px; font-size: 1.1rem;">&times;</button>
                            </div>
                            <label style="display: flex; align-items: center; justify-content: space-between; color: #e2e8f0; font-size: 0.9rem; margin-bottom: 0.5rem; cursor: pointer;">
                                <span>Route lines</span>
                                <input type="checkbox" id="fleetMapSettingsRouteLines" checked>
                            </label>
                            <p style="margin: 0 0 0.75rem 0; font-size: 0.75rem; color: #94a3b8;">Show blue/orange route lines on map</p>
                            <button type="button" onclick="document.getElementById('fleetMapSettingsPanel').style.display='none';" class="btn btn-secondary" style="width: 100%; padding: 0.5rem;">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Drivers Tab Content -->
            <div id="fleetTabContentDrivers" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Driver Management</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span style="font-size: 0.875rem; color: #94a3b8;" id="driversCountDisplay">Showing 0 drivers</span>
                            <select id="driversPageSize" onchange="fleetManager.updatePageSize()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;">
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="100">100 per page</option>
                                <option value="500">500 per page</option>
                            </select>
                        </div>
                    </div>
                    <div id="fleetDriversList" class="fleet-list-container" style="max-height: 70vh; overflow-y: auto;">
                        <!-- Will be populated dynamically -->
                    </div>
                    <div id="driversPagination" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                        <!-- Pagination will be added dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Vehicles Tab Content -->
            <div id="fleetTabContentVehicles" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Vehicle Status & Management</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span style="font-size: 0.875rem; color: #94a3b8;" id="vehiclesCountDisplay">Showing 0 vehicles</span>
                            <select id="vehiclesPageSize" onchange="fleetManager.updatePageSize()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;">
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="100">100 per page</option>
                                <option value="500">500 per page</option>
                            </select>
                        </div>
                    </div>
                    <div id="vehicleStatusList" class="fleet-list-container" style="max-height: 70vh; overflow-y: auto;">
                        <!-- Will be populated dynamically -->
                    </div>
                    <div id="vehiclesPagination" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                        <!-- Pagination will be added dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Routes Tab Content -->
            <div id="fleetTabContentRoutes" class="fleet-tab-content" style="display: none; position: relative; z-index: 2;">
                <div class="glass-card" style="position: relative; z-index: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Route Management & Optimization</h3>
                        <button onclick="if(window.fleetManager){window.fleetManager.optimizeAllRoutes();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-brain"></i> ML Optimize All
                        </button>
                    </div>
                    <div id="routesList" class="fleet-list-container" style="max-height: 70vh; min-height: 200px; overflow-y: auto; overflow-x: hidden; position: relative; z-index: 1; pointer-events: auto; -webkit-overflow-scrolling: touch;">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
            
            <!-- Analytics Tab Content -->
            <div id="fleetTabContentAnalytics" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <h3 style="margin-bottom: 1.5rem;">Fleet Analytics & Performance</h3>
                    <div id="fleetAnalyticsContent">
                        <!-- Analytics charts and metrics will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- ML Insights Tab Content -->
            <div id="fleetTabContentML" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <h3 style="margin-bottom: 1.5rem;">ğŸ¤– Machine Learning Insights & Recommendations</h3>
                    <div id="fleetMLContent">
                        <!-- ML insights will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Safety Tab Content -->
            <div id="fleetTabContentSafety" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">ğŸ›¡ï¸ Safety & Risk Management</h3>
                        <button onclick="if(window.fleetManager){window.fleetManager.generateSafetyReport();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-file-pdf"></i> Generate Report
                        </button>
                    </div>
                    <div id="fleetSafetyContent">
                        <!-- Safety content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Video Telematics Tab Content -->
            <div id="fleetTabContentVideo" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">ğŸ“¹ Video Telematics & Dash Cams</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="if(window.fleetManager){window.fleetManager.refreshVideoFeeds();}" class="btn btn-secondary" style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div id="fleetVideoContent">
                        <!-- Video telematics content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Driver Coaching Tab Content -->
            <div id="fleetTabContentCoaching" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <h3 style="margin-bottom: 1.5rem;">ğŸ“ Driver Coaching & Gamification</h3>
                    <div id="fleetCoachingContent">
                        <!-- Coaching content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Vehicle Diagnostics Tab Content -->
            <div id="fleetTabContentDiagnostics" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <h3 style="margin-bottom: 1.5rem;">ğŸ”§ Vehicle Diagnostics & Health</h3>
                    <div id="fleetDiagnosticsContent">
                        <!-- Diagnostics content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Compliance Tab Content -->
            <div id="fleetTabContentCompliance" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">ğŸ“‹ Compliance & Regulatory (HOS, ELD, IFTA)</h3>
                        <button onclick="if(window.fleetManager){window.fleetManager.generateIFTAReport();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-file-invoice"></i> IFTA Report
                        </button>
                    </div>
                    <div id="fleetComplianceContent">
                        <!-- Compliance content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Maintenance Tab Content -->
            <div id="fleetTabContentMaintenance" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">ğŸ”§ Maintenance Management & Work Orders</h3>
                        <button onclick="if(window.fleetManager){window.fleetManager.createWorkOrder();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-plus"></i> New Work Order
                        </button>
                    </div>
                    <div id="fleetMaintenanceContent">
                        <!-- Maintenance content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Messaging Tab Content -->
            <div id="fleetTabContentMessaging" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <h3 style="margin-bottom: 1.5rem;">ğŸ’¬ Driver Messaging & Communication</h3>
                    <div id="fleetMessagingContent">
                        <!-- Messaging content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Reports Tab Content -->
            <div id="fleetTabContentReports" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">ğŸ“Š Advanced Reporting & Analytics</h3>
                        <button onclick="if(window.fleetManager){window.fleetManager.createCustomReport();}" class="btn btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-plus"></i> Custom Report
                        </button>
                    </div>
                    <div id="fleetReportsContent">
                        <!-- Reports content will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Advanced Feature Tabs -->
            <div id="fleetTabContentGeofencing" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetGeofencingContent">
                        <!-- Geofencing content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentAssets" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetAssetsContent">
                        <!-- Assets content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentDispatch" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetDispatchContent">
                        <!-- Dispatch content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentELD" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetELDContent">
                        <!-- ELD content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentInspections" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetInspectionsContent">
                        <!-- Inspections content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentFuel" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetFuelContent">
                        <!-- Fuel content will be added here -->
                    </div>
                </div>
            </div>
            
            <div id="fleetTabContentEnergy" class="fleet-tab-content" style="display: none;">
                <div class="glass-card">
                    <div id="fleetEnergyContent">
                        <!-- Energy content will be added here -->
                    </div>
                </div>
            </div>
                </div>
            </div>
        </div>

        <!-- ML Routes Section -->
        <div id="routes" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">ML Route Optimization</h1>
            
            <!-- ML Optimization Panel -->
            <div class="ml-panel">
                <div class="ml-header">
                    <div class="ml-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0;">AI-Powered Route Optimization</h3>
                        <p style="margin: 0.5rem 0 0 0; color: #94a3b8;">Using machine learning to optimize collection routes</p>
                    </div>
                </div>
                
                <div class="optimization-metrics">
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--primary); margin-bottom: 0.5rem;">
                            <i class="fas fa-route"></i>
                        </div>
                        <div class="stat-value" id="distanceReduction">-0%</div>
                        <div class="stat-label">Distance Reduced</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--success); margin-bottom: 0.5rem;">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                        <div class="stat-value" id="fuelSaved">-0%</div>
                        <div class="stat-label">Fuel Saved</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--warning); margin-bottom: 0.5rem;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="timePerRoute">0min</div>
                        <div class="stat-label">Time Per Route</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--secondary); margin-bottom: 0.5rem;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="efficiencyScore">0%</div>
                        <div class="stat-label">Efficiency Score</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Efficiency Chart -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Route Efficiency Trends</h3>
                <div class="chart-container">
                    <canvas id="routeChart"></canvas>
                </div>
            </div>
            
            <!-- Predictive Fill Chart -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Predictive Fill Levels</h3>
                <div class="chart-container">
                    <canvas id="predictiveChart"></canvas>
                </div>
            </div>
            
            <!-- Optimized Routes List -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Today's Optimized Routes</h3>
                <div id="optimizedRoutesList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Complaints Section -->
        <div id="complaints" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Complaint Management</h1>
            
            <!-- Complaint Stats -->
            <div class="stats-grid">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--danger);">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="openComplaintsCount">0</div>
                    <div class="stat-label">Open Complaints</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="pendingComplaintsCount">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="resolvedComplaintsCount">0</div>
                    <div class="stat-label">Resolved Today</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgResolutionTime">0h</div>
                    <div class="stat-label">Avg Resolution Time</div>
                </div>
            </div>
            
            <!-- New Complaint Button -->
            <div style="margin: 2rem 0;">
                <button class="btn btn-primary" onclick="showNewComplaintForm()">
                    <i class="fas fa-plus"></i> Register New Complaint
                </button>
            </div>
            
            <!-- Complaints List -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1.5rem;">Active Complaints</h3>
                <div id="complaintsList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- AI/ML Dashboard Section -->
        <div id="ai-dashboard" class="content-section" style="display: none;">
            <div class="ai-dashboard-header">
                <div class="ai-header-content">
                    <div class="ai-title-section">
                        <div class="ai-icon-large">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <h1 style="font-size: 2.5rem; margin: 0; color: var(--primary);">AI/ML Control Center</h1>
                            <p style="margin: 0.5rem 0 0 0; font-size: 1.2rem; color: #94a3b8;">World-Class Artificial Intelligence & Machine Learning Platform</p>
                        </div>
                    </div>
                    
                    <div class="ai-status-indicator">
                        <div class="ai-status-light" id="aiStatusLight"></div>
                        <div class="ai-status-text">
                            <div class="ai-status-label">AI System Status</div>
                            <div class="ai-status-value" id="aiStatusValue">Initializing...</div>
                        </div>
                    </div>
                    <div id="aiLiveConnectionRow" class="ai-live-connection-row" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                        <span style="display: inline-flex; align-items: center; gap: 0.35rem;"><span class="ai-live-dot" style="width: 8px; height: 8px; border-radius: 50%; background: #64748b;"></span> <span id="aiLastEventAgo" style="font-size: 0.85rem; color: #94a3b8;">â€”</span></span>
                        <button type="button" id="aiReconnectBtn" style="display: none; padding: 0.35rem 0.75rem; font-size: 0.8rem; border-radius: 8px; border: 1px solid rgba(248, 250, 252, 0.3); background: rgba(248, 250, 252, 0.08); color: #e2e8f0; cursor: pointer;" title="Reconnect real-time connection">Reconnect</button>
                    </div>
                </div>
            </div>

            <!-- AI System Overview - World Class UI -->
            <div class="ai-overview-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                
                <!-- Route Optimizer Card -->
                <div class="glass-card ai-module-card ai-control-card" style="background: linear-gradient(135deg, rgba(0, 212, 255, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 20px; padding: 2.5rem;">
                    <div class="ai-module-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1.25rem; flex: 1;">
                            <div class="ai-module-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(0, 212, 255, 0.35) 0%, rgba(0, 212, 255, 0.25) 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 24px rgba(0, 212, 255, 0.5); border: 2px solid rgba(0, 212, 255, 0.5);">
                                <i class="fas fa-route" style="color: #00d4ff; font-size: 2.25rem;"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.35rem; font-weight: 700; color: #f1f5f9;">Route Optimizer</h3>
                                <p style="margin: 0.4rem 0 0 0; color: #94a3b8; font-size: 0.9rem;">ML-Powered Routing</p>
                            </div>
                        </div>
                        <div class="ai-module-status" id="routeOptimizerStatus">
                            <div class="status-indicator active" style="width: 14px; height: 14px; background: #10b981; border-radius: 50%; box-shadow: 0 0 16px rgba(16, 185, 129, 0.8);"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div class="ai-metric" style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="routeEfficiencyImprovement" style="font-size: 2.25rem; font-weight: 800; color: #00d4ff; line-height: 1; margin-bottom: 0.75rem;">+18.5%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Efficiency Gain</div>
                        </div>
                        <div class="ai-metric" style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="distanceOptimization" style="font-size: 2.25rem; font-weight: 800; color: #00d4ff; line-height: 1; margin-bottom: 0.75rem;">-12.3%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Distance Reduced</div>
                        </div>
                    </div>
                </div>

                <!-- Predictive Analytics Card -->
                <div class="glass-card ai-module-card ai-control-card" style="background: linear-gradient(135deg, rgba(124, 58, 237, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(124, 58, 237, 0.3); border-radius: 20px; padding: 2.5rem;">
                    <div class="ai-module-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1.25rem; flex: 1;">
                            <div class="ai-module-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.35) 0%, rgba(124, 58, 237, 0.25) 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 24px rgba(124, 58, 237, 0.5); border: 2px solid rgba(124, 58, 237, 0.5);">
                                <i class="fas fa-chart-line" style="color: #a78bfa; font-size: 2.25rem;"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.35rem; font-weight: 700; color: #f1f5f9;">Predictive Analytics</h3>
                                <p style="margin: 0.4rem 0 0 0; color: #94a3b8; font-size: 0.9rem;">Future Forecasting</p>
                            </div>
                        </div>
                        <div class="ai-module-status" id="predictiveStatus">
                            <div class="status-indicator active" style="width: 14px; height: 14px; background: #10b981; border-radius: 50%; box-shadow: 0 0 16px rgba(16, 185, 129, 0.8);"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div class="ai-metric" style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="predictionAccuracy" style="font-size: 2.25rem; font-weight: 800; color: #a78bfa; line-height: 1; margin-bottom: 0.75rem;">94.7%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Accuracy</div>
                        </div>
                        <div class="ai-metric" style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="anomaliesDetected" style="font-size: 2.25rem; font-weight: 800; color: #a78bfa; line-height: 1; margin-bottom: 0.75rem;">17</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Anomalies Found</div>
                        </div>
                    </div>
                </div>

                <!-- Driver Assistant Card -->
                <div class="glass-card ai-module-card ai-control-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 20px; padding: 2.5rem;">
                    <div class="ai-module-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1.25rem; flex: 1;">
                            <div class="ai-module-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.35) 0%, rgba(16, 185, 129, 0.25) 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 24px rgba(16, 185, 129, 0.5); border: 2px solid rgba(16, 185, 129, 0.5);">
                                <i class="fas fa-user-cog" style="color: #34d399; font-size: 2.25rem;"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.35rem; font-weight: 700; color: #f1f5f9;">Driver Assistant</h3>
                                <p style="margin: 0.4rem 0 0 0; color: #94a3b8; font-size: 0.9rem;">Intelligent Guidance</p>
                            </div>
                        </div>
                        <div class="ai-module-status" id="driverAssistantStatus">
                            <div class="status-indicator active" style="width: 14px; height: 14px; background: #10b981; border-radius: 50%; box-shadow: 0 0 16px rgba(16, 185, 129, 0.8);"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div class="ai-metric" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="driverPerformanceBoost" style="font-size: 2.25rem; font-weight: 800; color: #34d399; line-height: 1; margin-bottom: 0.75rem;">+22.1%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Performance</div>
                        </div>
                        <div class="ai-metric" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="aiRecommendations" style="font-size: 2.25rem; font-weight: 800; color: #34d399; line-height: 1; margin-bottom: 0.75rem;">189</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Recommendations</div>
                        </div>
                    </div>
                </div>

                <!-- Deep Learning Card -->
                <div class="glass-card ai-module-card ai-control-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.12) 0%, rgba(30, 41, 59, 0.9) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 20px; padding: 2.5rem;">
                    <div class="ai-module-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1.25rem; flex: 1;">
                            <div class="ai-module-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.35) 0%, rgba(245, 158, 11, 0.25) 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 24px rgba(245, 158, 11, 0.5); border: 2px solid rgba(245, 158, 11, 0.5);">
                                <i class="fas fa-brain" style="color: #fbbf24; font-size: 2.25rem;"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 1.35rem; font-weight: 700; color: #f1f5f9;">Deep Learning</h3>
                                <p style="margin: 0.4rem 0 0 0; color: #94a3b8; font-size: 0.9rem;">Neural Networks</p>
                            </div>
                        </div>
                        <div class="ai-module-status" id="deepLearningStatus">
                            <div class="status-indicator active" style="width: 14px; height: 14px; background: #10b981; border-radius: 50%; box-shadow: 0 0 16px rgba(16, 185, 129, 0.8);"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div class="ai-metric" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="modelAccuracy" style="font-size: 2.25rem; font-weight: 800; color: #fbbf24; line-height: 1; margin-bottom: 0.75rem;">97.2%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Model Accuracy</div>
                        </div>
                        <div class="ai-metric" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.25); border-radius: 14px; padding: 1.5rem; text-align: center; transition: all 0.3s ease;">
                            <div class="ai-metric-value" id="learningProgress" style="font-size: 2.25rem; font-weight: 800; color: #fbbf24; line-height: 1; margin-bottom: 0.75rem;">92%</div>
                            <div class="ai-metric-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700;">Learning</div>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- AI Performance Charts -->
            <div class="ai-charts-section">
                <div class="charts-grid">
            <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">AI Performance Metrics</h4>
                        <div class="chart-container">
                            <canvas id="ai-performance-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Machine Learning Accuracy</h4>
                        <div class="chart-container">
                            <canvas id="ml-accuracy-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Real-time AI Monitoring</h4>
                    <div class="ai-monitoring-dashboard">
                        <div class="monitoring-grid">
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiProcessingSpeed">2.3ms</div>
                                    <div class="monitoring-label">Processing Speed</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-memory"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiMemoryUsage">73.2%</div>
                                    <div class="monitoring-label">Memory Usage</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-microchip"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiCpuUsage">45.8%</div>
                                    <div class="monitoring-label">CPU Usage</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiThroughput">1.2K/s</div>
                                    <div class="monitoring-label">Throughput</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Analytics Section -->
        <div id="analytics" class="content-section" style="display: none;">
            <div class="analytics-header">
                <div class="analytics-header-content">
                    <div class="analytics-title-section">
                        <div class="analytics-icon-large">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div>
                            <h1 style="font-size: 2.5rem; margin: 0;">Advanced Analytics Dashboard</h1>
                            <p style="margin: 0.5rem 0 0 0; font-size: 1.2rem; color: #94a3b8;">AI-Powered Business Intelligence & Data Analytics</p>
                            <p id="analyticsDataSource" style="margin: 0.25rem 0 0 0; font-size: 0.85rem; color: #64748b;"></p>
                            <div id="analyticsLiveRow" class="analytics-live-row" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <span style="display: inline-flex; align-items: center; gap: 0.35rem;"><span class="analytics-live-dot" style="width: 8px; height: 8px; border-radius: 50%; background: #64748b;"></span> <span id="analyticsLastEventAgo" style="font-size: 0.85rem; color: #94a3b8;">â€”</span></span>
                                <button type="button" id="analyticsReconnectBtn" style="display: none; padding: 0.35rem 0.75rem; font-size: 0.8rem; border-radius: 8px; border: 1px solid rgba(248, 250, 252, 0.3); background: rgba(248, 250, 252, 0.08); color: #e2e8f0; cursor: pointer;" title="Reconnect real-time">Reconnect</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-actions">
                        <button class="btn btn-primary" onclick="refreshAnalytics()">
                            <i class="fas fa-sync"></i> Refresh Data
                        </button>
                        <button class="btn btn-success" onclick="exportAnalytics()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="btn btn-info" onclick="toggleRealTimeAnalytics()">
                            <i class="fas fa-play"></i> Real-Time Mode
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Real-Time System Overview - World Class UI -->
            <div class="analytics-overview" style="margin-bottom: 2rem;">
                <div class="glass-card system-health-card" style="background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 1) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 18px; padding: 2rem;">
                    <h3 style="margin-bottom: 2rem; font-size: 1.5rem; font-weight: 700; color: #f1f5f9; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-chart-line" style="color: #3b82f6;"></i>
                        System Health & Performance
                    </h3>
                    <div class="system-metrics-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem;">
                        
                        <!-- System Efficiency Card -->
                        <div class="system-metric analytics-metric-card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(30, 41, 59, 0.85) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s ease; min-height: 180px; display: flex; flex-direction: column;">
                            <div class="metric-icon" style="width: 64px; height: 64px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem auto; box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); border: 2px solid rgba(59, 130, 246, 0.4);">
                                <i class="fas fa-tachometer-alt" style="color: #60a5fa; font-size: 2rem;"></i>
                            </div>
                            <div class="metric-data" style="text-align: center;">
                                <div class="stat-value" id="analyticsSystemEfficiency" style="font-size: 2.25rem; font-weight: 800; color: #60a5fa; margin-bottom: 0.75rem; line-height: 1;">â€”</div>
                                <div class="stat-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700; margin-bottom: 0.75rem;">System Efficiency</div>
                                <div class="progress-bar" style="height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden;">
                                    <div class="progress-fill" id="analyticsEfficiencyProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%); border-radius: 3px;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Monthly Collections Card -->
                        <div class="system-metric analytics-metric-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(30, 41, 59, 0.85) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s ease; min-height: 180px; display: flex; flex-direction: column;">
                            <div class="metric-icon" style="width: 64px; height: 64px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem auto; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4); border: 2px solid rgba(16, 185, 129, 0.4);">
                                <i class="fas fa-recycle" style="color: #34d399; font-size: 2rem;"></i>
                            </div>
                            <div class="metric-data" style="text-align: center;">
                                <div class="stat-value" id="analyticsMonthlyCollected" style="font-size: 2.25rem; font-weight: 800; color: #34d399; margin-bottom: 0.75rem; line-height: 1;">â€”</div>
                                <div class="stat-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700; margin-bottom: 0.5rem;">Monthly Collections</div>
                                <div class="metric-trend" id="analyticsTrendMonthly" style="display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 700;">â€”</div>
                            </div>
                        </div>
                        
                        <!-- Avg Response Time Card -->
                        <div class="system-metric analytics-metric-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.12) 0%, rgba(30, 41, 59, 0.85) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s ease; min-height: 180px; display: flex; flex-direction: column;">
                            <div class="metric-icon" style="width: 64px; height: 64px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem auto; box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4); border: 2px solid rgba(245, 158, 11, 0.4);">
                                <i class="fas fa-clock" style="color: #fbbf24; font-size: 2rem;"></i>
                            </div>
                            <div class="metric-data" style="text-align: center;">
                                <div class="stat-value" id="analyticsAvgResponseTime" style="font-size: 2.25rem; font-weight: 800; color: #fbbf24; margin-bottom: 0.75rem; line-height: 1;">â€”</div>
                                <div class="stat-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700; margin-bottom: 0.5rem;">Avg Response Time</div>
                                <div class="metric-trend" id="analyticsTrendResponse" style="display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 700;">â€”</div>
                            </div>
                        </div>
                        
                        <!-- Driver Rating Card -->
                        <div class="system-metric analytics-metric-card" style="background: linear-gradient(135deg, rgba(124, 58, 237, 0.12) 0%, rgba(30, 41, 59, 0.85) 100%); border: 1px solid rgba(124, 58, 237, 0.3); border-radius: 16px; padding: 2rem; transition: all 0.3s ease; min-height: 180px; display: flex; flex-direction: column;">
                            <div class="metric-icon" style="width: 64px; height: 64px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(124, 58, 237, 0.2) 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem auto; box-shadow: 0 6px 16px rgba(124, 58, 237, 0.4); border: 2px solid rgba(124, 58, 237, 0.4);">
                                <i class="fas fa-star" style="color: #a78bfa; font-size: 2rem;"></i>
                            </div>
                            <div class="metric-data" style="text-align: center;">
                                <div class="stat-value" id="analyticsAvgDriverRating" style="font-size: 2.25rem; font-weight: 800; color: #a78bfa; margin-bottom: 0.75rem; line-height: 1;">â€”</div>
                                <div class="stat-label" style="font-size: 0.8rem; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700; margin-bottom: 0.5rem;">Driver Rating</div>
                                <div class="metric-trend" id="analyticsTrendRating" style="display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 700;">â€”</div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
            <!-- Advanced Analytics Navigation -->
            <div class="analytics-navigation">
                <div class="analytics-tabs">
                    <button class="analytics-tab active" data-tab="overview">
                        <i class="fas fa-chart-line"></i> Overview
                </button>
                    <button class="analytics-tab" data-tab="performance">
                        <i class="fas fa-tachometer-alt"></i> Performance
                </button>
                    <button class="analytics-tab" data-tab="drivers-detail">
                        <i class="fas fa-user-tie"></i> Drivers
                    </button>
                    <button class="analytics-tab" data-tab="bins-detail">
                        <i class="fas fa-dumpster"></i> Bins
                    </button>
                    <button class="analytics-tab" data-tab="sensors-detail">
                        <i class="fas fa-broadcast-tower"></i> Sensors
                    </button>
                    <button class="analytics-tab" data-tab="predictive">
                        <i class="fas fa-crystal-ball"></i> Predictive
                    </button>
                    <button class="analytics-tab" data-tab="operational">
                        <i class="fas fa-cogs"></i> Operational
                </button>
                <button class="analytics-tab" data-tab="environmental">
                    <i class="fas fa-leaf"></i> Environmental
                </button>
                    <button class="analytics-tab" data-tab="financial">
                        <i class="fas fa-dollar-sign"></i> Financial
                </button>
                </div>
            </div>
            
            <!-- Tab Contents -->
            <div class="analytics-content active" id="overview-content">
                <div class="charts-grid">
                <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Collection Trends (Last 30 Days)</h4>
                    <div class="chart-container">
                            <canvas id="collections-trend-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Bin Fill Distribution</h4>
                        <div class="chart-container">
                            <canvas id="fill-distribution-chart"></canvas>
                    </div>
                </div>
            </div>
            
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Real-Time Activity Feed</h4>
                    <div class="activity-feed" id="analyticsActivityFeed">
                        <!-- Real-time activities will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="performance-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Driver Performance Analysis</h4>
                        <div class="chart-container">
                            <canvas id="driver-performance-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Route Efficiency Metrics</h4>
                        <div class="chart-container">
                            <canvas id="route-efficiency-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Per-Driver Performance (world-class detail) -->
            <div class="analytics-content" id="drivers-detail-content" style="display: none;">
                <div class="glass-card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;"><i class="fas fa-user-tie"></i> Driver Performance Details</h4>
                    <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">Per-driver metrics from live data (MongoDB synced).</p>
                    <div class="analytics-table-wrapper" style="overflow-x: auto;">
                        <table class="analytics-detail-table" id="analyticsDriverPerformanceTable">
                            <thead>
                                <tr>
                                    <th>Driver</th>
                                    <th>Status</th>
                                    <th>Rating</th>
                                    <th>Collections (MTD)</th>
                                    <th>Avg Response (min)</th>
                                    <th>Completed Routes</th>
                                </tr>
                            </thead>
                            <tbody id="analyticsDriverPerformanceBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="glass-card">
                    <h4 style="margin-bottom: 1rem;">Driver Performance Comparison</h4>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="drivers-detail-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Bin Performance (world-class detail) -->
            <div class="analytics-content" id="bins-detail-content" style="display: none;">
                <div class="glass-card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;"><i class="fas fa-dumpster"></i> Bin Performance Details</h4>
                    <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">Fill levels, status, and collection frequency by bin.</p>
                    <div class="analytics-table-wrapper" style="overflow-x: auto;">
                        <table class="analytics-detail-table" id="analyticsBinPerformanceTable">
                            <thead>
                                <tr>
                                    <th>Bin ID</th>
                                    <th>Location</th>
                                    <th>Fill %</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                    <th>Last Collection</th>
                                </tr>
                            </thead>
                            <tbody id="analyticsBinPerformanceBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="glass-card">
                    <h4 style="margin-bottom: 1rem;">Bin Fill Levels Distribution</h4>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="bins-detail-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Sensor Performance (world-class detail) -->
            <div class="analytics-content" id="sensors-detail-content" style="display: none;">
                <div class="glass-card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;"><i class="fas fa-broadcast-tower"></i> Sensor Performance Details</h4>
                    <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">Sensor health, battery, signal strength per bin/sensor.</p>
                    <div class="analytics-table-wrapper" style="overflow-x: auto;">
                        <table class="analytics-detail-table" id="analyticsSensorPerformanceTable">
                            <thead>
                                <tr>
                                    <th>Bin / Sensor</th>
                                    <th>Status</th>
                                    <th>Battery %</th>
                                    <th>Signal (dBm)</th>
                                    <th>Temperature</th>
                                    <th>Fill Reading</th>
                                </tr>
                            </thead>
                            <tbody id="analyticsSensorPerformanceBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="glass-card">
                    <h4 style="margin-bottom: 1rem;">Sensor Health Summary</h4>
                    <div class="sensor-summary-grid" id="analyticsSensorSummary" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="predictive-content" style="display: none;">
                <div class="glass-card">
                    <h4 style="margin-bottom: 1rem;">Predictive Analytics Dashboard</h4>
                    <div class="predictive-analytics-grid">
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <h5>Demand Forecasting</h5>
                                <div class="prediction-accuracy" id="analyticsDemandAccuracy">94.7% Accurate</div>
                            </div>
                    <div class="chart-container">
                                <canvas id="demand-forecast-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <h5>Bin Overflow Prediction</h5>
                                <div class="prediction-accuracy" id="analyticsOverflowAccuracy">96.2% Accurate</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="overflow-prediction-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="operational-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Operational Efficiency</h4>
                        <div class="chart-container">
                            <canvas id="operational-efficiency-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Resource Utilization</h4>
                        <div class="chart-container">
                            <canvas id="resource-utilization-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="environmental-content" style="display: none;">
                <div class="environmental-impact-dashboard">
                <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Environmental Impact Metrics</h4>
                        <div class="environmental-metrics-grid">
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #10b981;">
                                    <i class="fas fa-tree"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="treesSaved">234</div>
                            <div class="stat-label">Trees Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +18 this month
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #3b82f6;">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="co2Reduction">-15.7%</div>
                            <div class="stat-label">CO2 Reduction</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-down"></i> 2.4 tons saved
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #06b6d4;">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="waterSaved">12,450L</div>
                            <div class="stat-label">Water Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +1,200L
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #f59e0b;">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="energySaved">8,932 kWh</div>
                            <div class="stat-label">Energy Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +890 kWh
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card" style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Sustainability Progress</h4>
                        <div class="chart-container">
                            <canvas id="sustainability-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="financial-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Cost Analysis</h4>
                        <div class="chart-container">
                            <canvas id="cost-analysis-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">ROI & Savings</h4>
                        <div class="chart-container">
                            <canvas id="roi-savings-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Export Options -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h4 style="margin-bottom: 1rem;">Export Reports</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="analyticsManager.generatePDFReport()">
                        <i class="fas fa-file-pdf"></i> Generate PDF Report
                    </button>
                    <button class="btn btn-secondary" onclick="analyticsManager.exportToCSV()">
                        <i class="fas fa-file-csv"></i> Export to CSV
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Admin Control Panel</h1>
            
            <!-- Admin Action Buttons -->
            <div class="glass-card" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem;">
                    <i class="fas fa-cogs"></i> Admin Actions
                </h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-danger" onclick="showErrorLogsModal()">
                        <i class="fas fa-exclamation-triangle"></i>
                        View Error Logs
                    </button>
                    <button class="btn btn-danger" onclick="showClientConsoleErrorsModal()" style="background: #b91c1c;">
                        <i class="fas fa-bug"></i>
                        Console Errors (All Users)
                    </button>
                    <button class="btn btn-warning" onclick="clearErrorLogs()">
                        <i class="fas fa-trash"></i>
                        Clear Error Logs
                    </button>
                    <button class="btn btn-secondary" onclick="exportSystemData()">
                        <i class="fas fa-download"></i>
                        Export System Data
                    </button>
                    <button class="btn btn-primary" onclick="generateComprehensiveSampleData()">
                        <i class="fas fa-database"></i>
                        Generate Sample Data
                    </button>
                    <button class="btn btn-success" onclick="generateComprehensiveReport()">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF Report
                    </button>
                </div>
            </div>
            
            <!-- Pending Registrations -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-user-plus"></i> Pending User Registrations
                </h3>
                <div id="pendingRegistrationsList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- User Management -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-users"></i> User Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on users to remove them</span>
                </h3>
                <div id="userManagementList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

             <!-- Vehicle Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-truck"></i> Vehicle Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on vehicles to remove them</span>
                 </h3>
                 <div id="vehicleManagementList">
                     <!-- Will be populated dynamically -->
                 </div>
             </div>

             <!-- Sensor Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-satellite-dish"></i> Sensor Management (Findy IoT)
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Manage 3000+ sensors with bulk import</span>
                 </h3>
                 
                <!-- Sensor Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.75rem 1.5rem; border-radius: 16px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;"><i class="fas fa-satellite-dish"></i></div>
                        <div style="font-size: 0.85rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Total Sensors</div>
                        <div style="font-size: 2.5rem; font-weight: 800; margin: 0.75rem 0; text-shadow: 0 4px 12px rgba(0,0,0,0.3);" id="adminTotalSensors">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Registered</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 1.75rem 1.5rem; border-radius: 16px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3); transition: all 0.3s ease;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;"><i class="fas fa-check-circle"></i></div>
                        <div style="font-size: 0.85rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Online</div>
                        <div style="font-size: 2.5rem; font-weight: 800; margin: 0.75rem 0; text-shadow: 0 4px 12px rgba(0,0,0,0.3);" id="adminOnlineSensors">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Connected</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 1.75rem 1.5rem; border-radius: 16px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3); transition: all 0.3s ease;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;"><i class="fas fa-times-circle"></i></div>
                        <div style="font-size: 0.85rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Offline</div>
                        <div style="font-size: 2.5rem; font-weight: 800; margin: 0.75rem 0; text-shadow: 0 4px 12px rgba(0,0,0,0.3);" id="adminOfflineSensors">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Disconnected</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 1.75rem 1.5rem; border-radius: 16px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3); transition: all 0.3s ease;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;"><i class="fas fa-link"></i></div>
                        <div style="font-size: 0.85rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Linked</div>
                        <div style="font-size: 2.5rem; font-weight: 800; margin: 0.75rem 0; text-shadow: 0 4px 12px rgba(0,0,0,0.3);" id="adminLinkedSensors">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        </div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">To Bins</div>
                    </div>
                </div>
                 
                 <!-- Sensor Management Buttons -->
                 <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                     <button class="btn btn-primary" onclick="window.open('/sensor-management.html', '_blank')">
                         <i class="fas fa-cog"></i> Full Management Panel
                     </button>
                     <button class="btn btn-success" onclick="window.open('/sensor-management.html#add', '_blank')">
                         <i class="fas fa-plus"></i> Add Sensor
                     </button>
                     <button class="btn btn-info" onclick="window.open('/sensor-management.html#import', '_blank')">
                         <i class="fas fa-file-import"></i> Bulk Import
                     </button>
                     <button class="btn btn-secondary" onclick="updateAdminSensorStats()">
                         <i class="fas fa-sync"></i> Refresh Stats
                     </button>
                 </div>
                 
                 <!-- API Status -->
                 <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3b82f6;">
                     <div style="display: flex; justify-content: space-between; align-items: center;">
                         <div>
                             <strong>Findy IoT API Status:</strong>
                             <span id="adminFindyAPIStatus" style="margin-left: 0.5rem;">Checking...</span>
                         </div>
                         <a href="https://higps.org/new_test/" target="_blank" style="color: #3b82f6; text-decoration: none;">
                             <i class="fas fa-external-link-alt"></i> Findy Portal
                         </a>
                     </div>
                 </div>
                 
                 <!-- Sensor List Table -->
                 <div style="margin-top: 2rem;">
                     <h4 style="margin-bottom: 1rem; color: #1e40af; display: flex; align-items: center; gap: 0.5rem;">
                         <i class="fas fa-list"></i> Registered Sensors & Linked Bins
                     </h4>
                     <div style="overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                         <table style="width: 100%; border-collapse: collapse;">
                             <thead>
                                 <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">#</th>
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">Sensor / IMEI</th>
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">Status</th>
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">Linked Bin</th>
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">Battery</th>
                                     <th style="padding: 1rem; text-align: left; font-weight: 600;">Last Seen</th>
                                     <th style="padding: 1rem; text-align: center; font-weight: 600;">Actions</th>
                                 </tr>
                             </thead>
                             <tbody id="adminSensorTableBody" style="font-size: 0.9rem;">
                                 <tr>
                                     <td colspan="7" style="padding: 2rem; text-align: center; color: #94a3b8;">
                                         <i class="fas fa-spinner fa-spin"></i> Loading sensors...
                                     </td>
                                 </tr>
                             </tbody>
                         </table>
                     </div>
                 </div>
             </div>
             
             <script>
             // Update admin sensor statistics with enhanced status checking
             async function updateAdminSensorStats() {
                 try {
                     console.log('ğŸ”„ Updating admin sensor statistics...');
                     
                     // Get sensors from database
                     const response = await fetch('/api/sensors/list');
                     const result = await response.json();
                     const sensors = result.sensors || [];
                     
                     console.log(`ğŸ“Š Found ${sensors.length} sensors in database`);
                     
                     // Update total count
                     const totalEl = document.getElementById('adminTotalSensors');
                     if (totalEl) totalEl.textContent = sensors.length;
                     
                     // If we have sensors, check their actual status from Findy API
                     if (sensors.length > 0 && typeof findyClient !== 'undefined') {
                         console.log('ğŸ“¡ Checking sensor status from Findy API...');
                         
                         let onlineCount = 0;
                         let offlineCount = 0;
                         let linkedCount = sensors.filter(s => s.binId).length;
                         
                         // Check status for each sensor (with rate limiting)
                         for (let i = 0; i < Math.min(sensors.length, 10); i++) {
                             const sensor = sensors[i];
                             try {
                                 const statusResult = await findyClient.getDevice(sensor.imei);
                                 
                                if (statusResult && statusResult.success && statusResult.data) {
                                    onlineCount++;
                                    // Status is being checked, no need to update database here
                                } else {
                                    offlineCount++;
                                }
                             } catch (error) {
                                 console.warn(`Status check failed for ${sensor.imei}:`, error.message);
                                 offlineCount++;
                             }
                             
                             // Small delay to avoid overwhelming API
                             if (i < sensors.length - 1) {
                                 await new Promise(resolve => setTimeout(resolve, 500));
                             }
                         }
                         
                         // For remaining sensors (if >10), use cached status
                         if (sensors.length > 10) {
                             for (let i = 10; i < sensors.length; i++) {
                                 const sensor = sensors[i];
                                 if (sensor.status === 'online') onlineCount++;
                                 else offlineCount++;
                             }
                         }
                         
                         // Update display
                         const onlineEl = document.getElementById('adminOnlineSensors');
                         const offlineEl = document.getElementById('adminOfflineSensors');
                         const linkedEl = document.getElementById('adminLinkedSensors');
                         
                         if (onlineEl) onlineEl.textContent = onlineCount;
                         if (offlineEl) offlineEl.textContent = offlineCount;
                         if (linkedEl) linkedEl.textContent = linkedCount;
                         
                         console.log(`âœ… Stats updated: ${onlineCount} online, ${offlineCount} offline, ${linkedCount} linked`);
                     } else {
                         // No sensors or API not available
                         const onlineEl = document.getElementById('adminOnlineSensors');
                         const offlineEl = document.getElementById('adminOfflineSensors');
                         const linkedEl = document.getElementById('adminLinkedSensors');
                         
                         if (onlineEl) onlineEl.textContent = sensors.filter(s => s.status === 'online').length;
                         if (offlineEl) offlineEl.textContent = sensors.filter(s => s.status === 'offline' || !s.status).length;
                         if (linkedEl) linkedEl.textContent = sensors.filter(s => s.binId).length;
                     }
                     
                    // Populate sensor table
                    const tableBody = document.getElementById('adminSensorTableBody');
                    if (tableBody && sensors.length > 0) {
                        // Wait for dataManager to be available
                        const bins = (typeof dataManager !== 'undefined' && dataManager.bins) ? dataManager.bins : [];
                        
                        tableBody.innerHTML = sensors.map((sensor, index) => {
                            const statusBadge = sensor.status === 'online' 
                                ? '<span style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-circle" style="font-size: 0.5rem;"></i> Online</span>'
                                : '<span style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-circle" style="font-size: 0.5rem;"></i> Offline</span>';
                            
                            // Get bin name (with safety check)
                            let binName = '<span style="color: #94a3b8; font-style: italic;"><i class="fas fa-circle-notch" style="font-size: 0.65rem; opacity: 0.5;"></i> Not linked</span>';
                            
                            if (sensor.binId) {
                                const bin = bins.find(b => b.id === sensor.binId);
                                if (bin) {
                                    const fillColor = bin.fillLevel >= 80 ? '#ef4444' : bin.fillLevel >= 50 ? '#f59e0b' : '#10b981';
                                    const fillIcon = bin.fillLevel >= 80 ? 'fa-exclamation-circle' : 'fa-check-circle';
                                    
                                    binName = `
                                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <i class="fas fa-trash-alt" style="color: #3b82f6;"></i>
                                                <span style="font-weight: 600; color: #1e293b;">${bin.id}</span>
                                                <i class="fas ${fillIcon}" style="color: ${fillColor}; font-size: 0.7rem;"></i>
                                            </div>
                                            ${bin.location && bin.location.address ? `
                                                <div style="font-size: 0.75rem; color: #64748b; padding-left: 1.25rem;">
                                                    <i class="fas fa-map-marker-alt" style="font-size: 0.6rem;"></i> ${bin.location.address}
                                                </div>
                                            ` : ''}
                                            <div style="font-size: 0.75rem; padding-left: 1.25rem;">
                                                Fill: <span style="color: ${fillColor}; font-weight: 600;">${bin.fillLevel}%</span>
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    // Bin ID exists but bin not found in dataManager
                                    binName = `<span style="color: #3b82f6; font-weight: 600;"><i class="fas fa-trash-alt"></i> ${sensor.binId}</span>`;
                                }
                            }
                            
                            const battery = sensor.battery ? `${sensor.battery}%` : 'N/A';
                            
                            // Format last seen date
                            let lastSeenDisplay = 'Unknown';
                            if (sensor.lastSeen) {
                                try {
                                    const date = new Date(sensor.lastSeen);
                                    if (!isNaN(date.getTime())) {
                                        if (typeof formatSensorDatePlain === 'function') {
                                            lastSeenDisplay = formatSensorDatePlain(sensor.lastSeen);
                                        } else {
                                            lastSeenDisplay = date.toLocaleDateString();
                                        }
                                    }
                                } catch (e) {
                                    lastSeenDisplay = 'Invalid';
                                }
                            }
                            
                            const unlinkBtn = sensor.binId 
                                ? `<button onclick="adminUnlinkSensor('${sensor.imei}', '${sensor.binId}')" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(245, 158, 11, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(245, 158, 11, 0.3)'" title="Unlink from bin"><i class="fas fa-unlink"></i> Unlink</button>`
                                : '';
                            
                            return `
                                <tr style="border-bottom: 1px solid #e2e8f0; transition: all 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                    <td style="padding: 1rem; color: #64748b; font-weight: 600;">${index + 1}</td>
                                    <td style="padding: 1rem;">
                                        <div style="font-weight: 600; color: #1e293b;">${sensor.name || 'Unnamed Sensor'}</div>
                                        <div style="font-size: 0.8rem; color: #94a3b8; font-family: monospace;">${sensor.imei}</div>
                                    </td>
                                    <td style="padding: 1rem;">${statusBadge}</td>
                                    <td style="padding: 1rem;">${binName}</td>
                                    <td style="padding: 1rem; color: #64748b; font-weight: 600;">${battery}</td>
                                    <td style="padding: 1rem; color: #64748b;">${lastSeenDisplay}</td>
                                    <td style="padding: 1rem; text-align: center;">
                                        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                                            ${unlinkBtn}
                                            <button onclick="adminOpenSensorManagement()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)'" title="Open full management"><i class="fas fa-cog"></i> Manage</button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    } else if (tableBody) {
                        tableBody.innerHTML = '<tr><td colspan="7" style="padding: 2rem; text-align: center; color: #94a3b8;"><i class="fas fa-info-circle"></i> No sensors found. Click "Add Sensor" to get started.</td></tr>';
                    }
                    
                    // Update API status
                    const health = await fetch('/api/findy/health').then(r => r.json()).catch(err => ({ authenticated: false }));
                    const statusEl = document.getElementById('adminFindyAPIStatus');
                    if (statusEl) {
                        if (health.authenticated) {
                            statusEl.innerHTML = '<span style="color: #10b981; font-weight: 600;"><i class="fas fa-check-circle"></i> Connected</span>';
                        } else {
                            statusEl.innerHTML = '<span style="color: #ef4444; font-weight: 600;"><i class="fas fa-times-circle"></i> Not Connected</span>';
                        }
                    }
                     
                 } catch (error) {
                     console.error('âŒ Failed to load sensor stats:', error);
                     
                     // Show error in UI
                     const statusEl = document.getElementById('adminFindyAPIStatus');
                     if (statusEl) {
                         statusEl.innerHTML = '<span style="color: #ef4444; font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> Error</span>';
                     }
                 }
             }
             
             // Initial load
             // Unlink sensor from bin (Admin Panel) - WORLD-CLASS
             async function adminUnlinkSensor(imei, binId) {
                 console.log(`ğŸ”“ Admin unlink requested: ${imei} from ${binId}`);
                 
                 // Get bin details for better confirmation message
                 let binDetails = binId;
                 if (typeof dataManager !== 'undefined' && dataManager.bins && Array.isArray(dataManager.bins)) {
                     const bin = dataManager.bins.find(b => b.id === binId);
                     if (bin && bin.location && bin.location.address) {
                         binDetails = `${binId} (${bin.location.address})`;
                     }
                 }
                 
                 // Confirm with user
                 const confirmed = confirm(
                     `ğŸ”“ Unlink Sensor from Bin?\n\n` +
                     `Sensor: ${imei}\n` +
                     `Bin: ${binDetails}\n\n` +
                     `This will stop receiving sensor data for this bin.\n\n` +
                     `Are you sure you want to continue?`
                 );
                 
                 if (!confirmed) {
                     console.log('âŒ Unlink cancelled by user');
                     return;
                 }
                 
                 try {
                     console.log(`ğŸ”„ Unlinking sensor ${imei} from bin ${binId}...`);
                     
                     // Update sensor in database
                     const response = await fetch('/api/sensors/update', {
                         method: 'POST',
                         headers: { 'Content-Type': 'application/json' },
                         body: JSON.stringify({
                             imei: imei,
                             binId: null,
                             unlinkedAt: new Date().toISOString()
                         })
                     });
                     
                     if (!response.ok) {
                         throw new Error(`Server error: ${response.status}`);
                     }
                     
                     const result = await response.json();
                     console.log('âœ… Sensor unlinked in database:', result);
                     
                     // Update bin if dataManager is available
                     if (typeof dataManager !== 'undefined' && dataManager.bins && Array.isArray(dataManager.bins)) {
                         const bin = dataManager.bins.find(b => b.id === binId);
                         if (bin) {
                             bin.sensorId = null;
                             if (typeof dataManager.saveBin === 'function') {
                                 await dataManager.saveBin(bin);
                                 console.log(`âœ… Updated bin ${binId} to remove sensor link`);
                             }
                         }
                     }
                     
                     // Show success notification
                     if (typeof realtimeStatusNotifier !== 'undefined' && typeof realtimeStatusNotifier.showToast === 'function') {
                         realtimeStatusNotifier.showToast(`âœ… Sensor ${imei.slice(-4)} unlinked from ${binId}`, 'success');
                     } else {
                         alert(`âœ… Sensor unlinked successfully from ${binId}!`);
                     }
                     
                     // Trigger custom event for cross-page updates
                     window.dispatchEvent(new CustomEvent('sensor:unlinked', {
                         detail: { imei, binId }
                     }));
                     
                     // Refresh stats and table
                     console.log('ğŸ”„ Refreshing admin sensor stats...');
                     updateAdminSensorStats();
                     
                 } catch (error) {
                     console.error('âŒ Failed to unlink sensor:', error);
                     alert(`âŒ Failed to unlink sensor: ${error.message}\n\nPlease try again or check the console for details.`);
                 }
             }
             
             // Open sensor management page (Admin Panel)
             function adminOpenSensorManagement() {
                 console.log('ğŸ“‚ Opening sensor management page...');
                 const newWindow = window.open('/sensor-management.html', '_blank');
                 
                 if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                     alert('âš ï¸ Pop-up blocked!\n\nPlease allow pop-ups for this site to open the sensor management page.');
                     console.warn('âš ï¸ Pop-up blocked - user needs to allow pop-ups');
                 } else {
                     console.log('âœ… Sensor management page opened in new tab');
                 }
             }
             
             // âœ… REGISTER FUNCTION GLOBALLY
             window.updateAdminSensorStats = updateAdminSensorStats;
             
             // NOTE: adminUnlinkSensor and adminOpenSensorManagement are loaded from admin-buttons-worldclass.js
             
             // Initial load with delay for dependencies
             setTimeout(() => { updateAdminSensorStats(); }, 3000); // 3 seconds to ensure all dependencies are ready
             
             // Update every 30 seconds
             setInterval(() => {
                 if (!document.hidden) {
                     updateAdminSensorStats();
                 }
             }, 30000);
             
             // Initial load when admin panel is shown
             document.addEventListener('DOMContentLoaded', () => {
                 const adminSection = document.getElementById('admin');
                 if (adminSection && adminSection.style.display !== 'none') {
                     setTimeout(() => updateAdminSensorStats(), 1000);
                 }
             });
             </script>

             <!-- Bin Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-trash"></i> Bin Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on bins to remove them</span>
                 </h3>
                 <div id="binManagementList">
                     <!-- Will be populated dynamically -->
                 </div>
             </div>

             <!-- Issue Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-exclamation-circle"></i> Issue Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on issues to manage them</span>
                 </h3>
                 <div id="issueManagementList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- System Statistics -->
            <div class="stats-grid" style="margin-top: 2rem;">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalUsersCount">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalBinsCount">0</div>
                    <div class="stat-label">Total Bins</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeDriversCount">0</div>
                    <div class="stat-label">Active Drivers</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeAlertsCount">0</div>
                    <div class="stat-label">Active Alerts</div>
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-file-alt"></i> Recent System Logs
                </h3>
                <div id="systemLogsList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- System Controls -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-cogs"></i> System Controls
                </h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="resetSystemBtn">
                        <i class="fas fa-sync"></i> Reset System Data
                    </button>
                    <button class="btn btn-secondary" id="exportDataBtn">
                        <i class="fas fa-download"></i> Export System Data
                    </button>
                    <button class="btn btn-secondary" id="viewLogsBtn">
                        <i class="fas fa-file-alt"></i> Download Full Logs
                    </button>
                    <button class="btn btn-warning" onclick="dataManager.fixCorruptedAccounts()">
                        <i class="fas fa-wrench"></i> Fix Corrupted Accounts
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container" id="fabContainer" style="display: none;">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-option" id="reportIssueFab">
                <div class="fab-option-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <span class="fab-option-label">Report Issue</span>
            </div>
            <div class="fab-option" id="addBinFab">
                <div class="fab-option-icon">
                    <i class="fas fa-trash"></i>
                </div>
                <span class="fab-option-label">Add New Bin</span>
            </div>
            <div class="fab-option" id="addVehicleFab">
                <div class="fab-option-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <span class="fab-option-label">Add Vehicle</span>
            </div>
        </div>
        <div class="fab" id="mainFab">
            <i class="fas fa-plus"></i>
        </div>
    </div>

<!-- Vehicle Registration Modal -->
<div id="vehicleRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-truck"></i> Register New Vehicle</h2>
            <span class="close" onclick="closeVehicleRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="vehicleRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="vehicleId"><i class="fas fa-id-card"></i> Vehicle ID</label>
                        <input type="text" id="vehicleId" name="vehicleId" required placeholder="e.g., TRUCK-001">
                    </div>
                    <div class="form-group">
                        <label for="vehicleType"><i class="fas fa-truck"></i> Vehicle Type</label>
                        <select id="vehicleType" name="vehicleType" required>
                            <option value="">Select Type</option>
                            <option value="garbage_truck">Garbage Truck</option>
                            <option value="pickup_truck">Pickup Truck</option>
                            <option value="compact_truck">Compact Truck</option>
                            <option value="van">Van</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="licensePlate"><i class="fas fa-car"></i> License Plate</label>
                        <input type="text" id="licensePlate" name="licensePlate" required placeholder="e.g., ABC-123">
                    </div>
                    <div class="form-group">
                        <label for="capacity"><i class="fas fa-weight"></i> Capacity (kg)</label>
                        <input type="number" id="capacity" name="capacity" required placeholder="e.g., 5000" min="100" max="50000">
                    </div>
                    <div class="form-group">
                        <label for="fuelType"><i class="fas fa-gas-pump"></i> Fuel Type</label>
                        <select id="fuelType" name="fuelType" required>
                            <option value="">Select Fuel Type</option>
                            <option value="diesel">Diesel</option>
                            <option value="electric">Electric</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="cng">CNG</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="yearManufactured"><i class="fas fa-calendar"></i> Year Manufactured</label>
                        <input type="number" id="yearManufactured" name="yearManufactured" required min="1990" max="2024" placeholder="e.g., 2020">
                    </div>
                    <div class="form-group">
                        <label for="vehicleStatus"><i class="fas fa-check-circle"></i> Status</label>
                        <select id="vehicleStatus" name="vehicleStatus" required>
                            <option value="active">Active</option>
                            <option value="maintenance">Under Maintenance</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignedDriver"><i class="fas fa-user"></i> Assigned Driver</label>
                        <select id="assignedDriver" name="assignedDriver">
                            <option value="">No Driver Assigned</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="vehicleNotes"><i class="fas fa-clipboard"></i> Notes</label>
                    <textarea id="vehicleNotes" name="vehicleNotes" placeholder="Additional notes about the vehicle..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeVehicleRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Register Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bin Registration Modal -->
<div id="binRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-trash"></i> Register New Bin</h2>
            <span class="close" onclick="closeBinRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="binRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="binId"><i class="fas fa-id-card"></i> Bin ID</label>
                        <input type="text" id="binId" name="binId" required placeholder="e.g., BIN-001">
                    </div>
                    <div class="form-group">
                        <label for="binType"><i class="fas fa-recycle"></i> Bin Type</label>
                        <select id="binType" name="binType" required>
                            <option value="">Select Type</option>
                            <option value="paper">Paper</option>
                            <option value="plastic">Plastic</option>
                            <option value="glass">Glass</option>
                            <option value="organic">Organic</option>
                            <option value="metal">Metal</option>
                            <option value="general">General Waste</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="binCapacity"><i class="fas fa-expand-arrows-alt"></i> Capacity (L)</label>
                        <input type="number" id="binCapacity" name="binCapacity" required placeholder="e.g., 240" min="50" max="1100">
                    </div>
                    <div class="form-group">
                        <label for="binLocation"><i class="fas fa-map-marker-alt"></i> Location</label>
                        <input type="text" id="binLocation" name="binLocation" required placeholder="e.g., Main Street Corner">
                    </div>
                    <div class="form-group">
                        <label for="binLatitude"><i class="fas fa-globe"></i> Latitude</label>
                        <input type="number" id="binLatitude" name="binLatitude" required step="0.000001" placeholder="e.g., 25.2854">
                    </div>
                    <div class="form-group">
                        <label for="binLongitude"><i class="fas fa-globe"></i> Longitude</label>
                        <input type="number" id="binLongitude" name="binLongitude" required step="0.000001" placeholder="e.g., 51.5310">
                    </div>
                    <div class="form-group">
                        <label for="sensorEnabled"><i class="fas fa-wifi"></i> IoT Sensor</label>
                        <select id="sensorEnabled" name="sensorEnabled" required>
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="binNeighborhood"><i class="fas fa-building"></i> Neighborhood</label>
                        <input type="text" id="binNeighborhood" name="binNeighborhood" placeholder="e.g., Downtown">
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="binDescription"><i class="fas fa-clipboard"></i> Description</label>
                    <textarea id="binDescription" name="binDescription" placeholder="Additional details about the bin location..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeBinRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Register Bin
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Issue Reporting Modal -->
<div id="issueReportingModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> Report Issue</h2>
            <span class="close" onclick="closeIssueReportingModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="issueReportingForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="issueType"><i class="fas fa-tags"></i> Issue Type</label>
                        <select id="issueType" name="issueType" required>
                            <option value="">Select Issue Type</option>
                            <option value="bin_overflow">Bin Overflow</option>
                            <option value="bin_damage">Bin Damage</option>
                            <option value="missed_collection">Missed Collection</option>
                            <option value="vehicle_breakdown">Vehicle Breakdown</option>
                            <option value="route_obstruction">Route Obstruction</option>
                            <option value="safety_concern">Safety Concern</option>
                            <option value="equipment_malfunction">Equipment Malfunction</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issuePriority"><i class="fas fa-exclamation"></i> Priority</label>
                        <select id="issuePriority" name="issuePriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issueLocation"><i class="fas fa-map-marker-alt"></i> Location</label>
                        <input type="text" id="issueLocation" name="issueLocation" required placeholder="e.g., Main Street, Downtown">
                    </div>
                    <div class="form-group">
                        <label for="relatedBin"><i class="fas fa-trash"></i> Related Bin (Optional)</label>
                        <select id="relatedBin" name="relatedBin">
                            <option value="">Select Bin (if applicable)</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="issueDescription"><i class="fas fa-edit"></i> Description</label>
                    <textarea id="issueDescription" name="issueDescription" required placeholder="Describe the issue in detail..." rows="4"></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="issueImage"><i class="fas fa-camera"></i> Attach Image (Optional)</label>
                    <input type="file" id="issueImage" name="issueImage" accept="image/*">
                    <small style="color: #94a3b8;">Upload an image to help explain the issue</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeIssueReportingModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-paper-plane"></i> Submit Report
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Error Logs Modal -->
<div id="errorLogsModal" class="modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 80vh;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> System Error Logs</h2>
            <span class="close" onclick="closeErrorLogsModal()">&times;</span>
        </div>
        <div class="modal-body" style="padding: 1.5rem;">
            <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <div style="color: #94a3b8;">
                    <i class="fas fa-info-circle"></i> 
                    Showing system errors with user context and timing
                </div>
                <button class="btn btn-sm btn-warning" onclick="clearErrorLogs()" style="font-size: 0.8rem;">
                    <i class="fas fa-trash"></i> Clear All Logs
                </button>
            </div>
            <div id="errorLogsList" style="max-height: 500px; overflow-y: auto;">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Console Errors (All Users) Modal - from database -->
<div id="clientConsoleErrorsModal" class="modal">
    <div class="modal-content" style="max-width: 1100px; max-height: 90vh;">
        <div class="modal-header">
            <h2><i class="fas fa-bug"></i> Console Errors (All Users)</h2>
            <span class="close" onclick="closeClientConsoleErrorsModal()">&times;</span>
        </div>
        <div class="modal-body" style="padding: 1.5rem;">
            <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                <div style="color: #94a3b8;">
                    <i class="fas fa-database"></i> Errors from all users, stored in database. Filter by user or refresh to load latest.
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="clientErrorsFilterUser" placeholder="Filter by user ID..." style="padding: 0.4rem 0.6rem; border-radius: 6px; border: 1px solid #334155; background: #1e293b; color: #e2e8f0; min-width: 140px;" />
                    <button class="btn btn-sm btn-primary" onclick="populateClientConsoleErrors()" type="button">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="clearClientConsoleErrors()" type="button">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
            </div>
            <div id="clientConsoleErrorsList" style="max-height: 60vh; overflow-y: auto;">
                <div style="text-align: center; color: #94a3b8; padding: 2rem;">Loading...</div>
            </div>
        </div>
    </div>
</div>

<!-- Complaint Registration Modal -->
<div id="complaintRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-circle"></i> Register New Complaint</h2>
            <span class="close" onclick="closeComplaintRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="complaintRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="complaintType"><i class="fas fa-tags"></i> Complaint Type</label>
                        <select id="complaintType" name="complaintType" required>
                            <option value="">Select Complaint Type</option>
                            <option value="missed_collection">Missed Collection</option>
                            <option value="overflowing_bin">Overflowing Bin</option>
                            <option value="damaged_bin">Damaged Bin</option>
                            <option value="noise_complaint">Noise Complaint</option>
                            <option value="service_quality">Service Quality</option>
                            <option value="billing_issue">Billing Issue</option>
                            <option value="schedule_change">Schedule Change Request</option>
                            <option value="environmental_concern">Environmental Concern</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="complaintPriority"><i class="fas fa-exclamation"></i> Priority</label>
                        <select id="complaintPriority" name="complaintPriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="complainantName"><i class="fas fa-user"></i> Your Name</label>
                        <input type="text" id="complainantName" name="complainantName" required placeholder="Full Name">
                    </div>
                    <div class="form-group">
                        <label for="complainantContact"><i class="fas fa-phone"></i> Contact Number</label>
                        <input type="tel" id="complainantContact" name="complainantContact" required placeholder="Phone Number">
                    </div>
                    <div class="form-group">
                        <label for="complainantEmail"><i class="fas fa-envelope"></i> Email (Optional)</label>
                        <input type="email" id="complainantEmail" name="complainantEmail" placeholder="Email Address">
                    </div>
                    <div class="form-group">
                        <label for="complaintLocation"><i class="fas fa-map-marker-alt"></i> Location/Address</label>
                        <input type="text" id="complaintLocation" name="complaintLocation" required placeholder="Specific address or location">
                    </div>
                    <div class="form-group">
                        <label for="complaintNeighborhood"><i class="fas fa-building"></i> Neighborhood</label>
                        <input type="text" id="complaintNeighborhood" name="complaintNeighborhood" placeholder="Neighborhood or district">
                    </div>
                    <div class="form-group">
                        <label for="relatedBinComplaint"><i class="fas fa-trash"></i> Related Bin (Optional)</label>
                        <select id="relatedBinComplaint" name="relatedBinComplaint">
                            <option value="">Select bin if applicable</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="complaintDescription"><i class="fas fa-edit"></i> Complaint Description</label>
                    <textarea id="complaintDescription" name="complaintDescription" required placeholder="Please describe the issue in detail..." rows="4"></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="complaintImage"><i class="fas fa-camera"></i> Attach Image (Optional)</label>
                    <input type="file" id="complaintImage" name="complaintImage" accept="image/*">
                    <small style="color: #94a3b8;">Upload an image to help explain the complaint</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeComplaintRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-paper-plane"></i> Submit Complaint
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Complaint Details Modal -->
<div id="complaintDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2><i class="fas fa-file-alt"></i> Complaint Details</h2>
            <span class="close" onclick="closeComplaintDetailsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Complaint Overview -->
            <div class="complaint-overview">
                <div class="complaint-badge-container">
                    <div class="complaint-type-badge" id="complaintTypeBadge">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="complaintTypeText">Loading...</span>
                    </div>
                    <div class="complaint-priority-badge" id="complaintPriorityBadge">
                        <i class="fas fa-flag"></i>
                        <span id="complaintPriorityText">Loading...</span>
                    </div>
                    <div class="complaint-status-badge" id="complaintStatusBadge">
                        <i class="fas fa-info-circle"></i>
                        <span id="complaintStatusText">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Complaint Information -->
            <div class="form-section-header">
                <i class="fas fa-info"></i>
                <span>Complaint Information</span>
            </div>

            <div class="complaint-details-grid">
                <div class="detail-item">
                    <label><i class="fas fa-hashtag"></i> Complaint ID</label>
                    <span id="complaintDetailsId">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-calendar"></i> Submitted Date</label>
                    <span id="complaintDetailsDate">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-map-marker-alt"></i> Location</label>
                    <span id="complaintDetailsLocation">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-building"></i> Neighborhood</label>
                    <span id="complaintDetailsNeighborhood">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-trash"></i> Related Bin</label>
                    <span id="complaintDetailsRelatedBin">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-clock"></i> Response Time</label>
                    <span id="complaintDetailsResponseTime">-</span>
                </div>
            </div>

            <!-- Description -->
            <div class="form-section-header">
                <i class="fas fa-edit"></i>
                <span>Description</span>
            </div>
            <div class="complaint-description">
                <p id="complaintDetailsDescription">Loading complaint description...</p>
            </div>

            <!-- Complainant Information -->
            <div class="form-section-header">
                <i class="fas fa-user"></i>
                <span>Complainant Information</span>
            </div>

            <div class="complainant-details-grid">
                <div class="detail-item">
                    <label><i class="fas fa-user"></i> Name</label>
                    <span id="complainantDetailsName">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-phone"></i> Contact</label>
                    <span id="complainantDetailsContact">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <span id="complainantDetailsEmail">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-user-shield"></i> Submitted By</label>
                    <span id="complainantDetailsSubmittedBy">-</span>
                </div>
            </div>

            <!-- Image Attachment -->
            <div class="form-section-header" id="imageAttachmentSection" style="display: none;">
                <i class="fas fa-image"></i>
                <span>Attached Image</span>
            </div>
            <div class="complaint-image-container" id="complaintImageContainer" style="display: none;">
                <div class="image-preview">
                    <img id="complaintDetailsImage" src="" alt="Complaint Image" />
                    <div class="image-overlay">
                        <button class="btn btn-secondary btn-sm" onclick="viewFullImage()">
                            <i class="fas fa-expand"></i> View Full Size
                        </button>
                    </div>
                </div>
                <p class="image-caption" id="complaintImageCaption">Attached complaint image</p>
            </div>

            <!-- Resolution Section (if resolved) -->
            <div class="form-section-header" id="resolutionSection" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <span>Resolution</span>
            </div>
            <div class="resolution-details" id="resolutionDetails" style="display: none;">
                <div class="detail-item">
                    <label><i class="fas fa-calendar-check"></i> Resolved Date</label>
                    <span id="complaintResolvedDate">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-user-cog"></i> Resolved By</label>
                    <span id="complaintResolvedBy">-</span>
                </div>
                <div class="resolution-description">
                    <label><i class="fas fa-comment"></i> Resolution Notes</label>
                    <p id="complaintResolutionNotes">-</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeComplaintDetailsModal()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-warning" id="editComplaintBtn" onclick="editComplaint()">
                    <i class="fas fa-edit"></i> Edit Complaint
                </button>
                <button class="btn btn-success" id="resolveComplaintBtn" onclick="resolveComplaintFromDetails()">
                    <i class="fas fa-check"></i> Mark as Resolved
                </button>
                <button class="btn btn-info" onclick="printComplaintDetails()">
                    <i class="fas fa-print"></i> Print Details
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Full Image Modal -->
<div id="fullImageModal" class="modal">
    <div class="modal-content" style="max-width: 90%; max-height: 90%; padding: 0; background: transparent; border: none; box-shadow: none;">
        <div class="full-image-container">
            <span class="close" onclick="closeFullImageModal()" style="position: absolute; top: 20px; right: 20px; z-index: 2001; background: rgba(0,0,0,0.8); color: white; border-radius: 50%; width: 50px; height: 50px;">&times;</span>
            <img id="fullSizeImage" src="" alt="Full Size Complaint Image" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 12px;" />
        </div>
    </div>
</div>

<!-- Smart Assignment Modal -->
<div id="customModal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; background: #0f172a; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 20px;">
        <div id="modalBody" style="padding: 0; border-radius: 20px;">
            <!-- Smart assignment content will be inserted here -->
        </div>
    </div>
</div>

<!-- Driver Details Modal -->
<div id="driverDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h2><i class="fas fa-user-circle"></i> Driver Details & History</h2>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <button type="button" class="btn btn-primary btn-sm" onclick="printDriverDetailsReport()" style="white-space: nowrap;">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <span class="close" onclick="closeDriverDetailsModal()">&times;</span>
            </div>
        </div>
        <div class="modal-body">
            <!-- Driver Overview -->
            <div class="driver-overview-section">
                <div class="driver-profile-header">
                    <div class="driver-avatar-large" id="driverAvatarLarge">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="driver-basic-info">
                        <h3 id="driverDetailsName">Loading...</h3>
                        <p id="driverDetailsId">ID: Loading...</p>
                        <div class="driver-status-badges">
                            <span class="status-badge" id="driverLiveStatus">Online</span>
                            <span class="vehicle-badge" id="driverVehicleInfo">Vehicle: Loading...</span>
                        </div>
                    </div>
                    <div class="driver-quick-stats">
                        <div class="stat-item">
                            <i class="fas fa-road"></i>
                            <span id="driverTotalTrips">0</span>
                            <small>Total Trips</small>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-trash"></i>
                            <span id="driverTotalCollections">0</span>
                            <small>Collections</small>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-gas-pump"></i>
                            <span id="driverFuelLevelModal">75%</span>
                            <small>Fuel Level</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Status Section -->
            <div class="form-section-header">
                <i class="fas fa-satellite-dish"></i>
                <span>Live Status & Location</span>
            </div>
            
            <div class="driver-live-status">
                <div class="status-grid">
                    <div class="status-item">
                        <label><i class="fas fa-circle"></i> Current Status</label>
                        <span id="driverCurrentStatus" class="status-indicator">Active</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-map-marker-alt"></i> Last Location</label>
                        <span id="driverLastLocation">Loading...</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-clock"></i> Last Update</label>
                        <span id="driverLastUpdate">Just now</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-route"></i> Current Route</label>
                        <span id="driverCurrentRoute">No active route</span>
                    </div>
                </div>
                
                <div class="fuel-status-section">
                    <label><i class="fas fa-gas-pump"></i> Fuel Status</label>
                    <div class="fuel-gauge">
                        <div class="fuel-bar">
                            <div class="fuel-level" id="driverFuelBar" style="width: 75%;"></div>
                        </div>
                        <span id="driverFuelPercentage">75%</span>
                    </div>
                    <button class="btn btn-warning btn-sm" onclick="updateDriverFuel()">
                        <i class="fas fa-edit"></i> Update Fuel Level
                    </button>
                </div>
            </div>

            <!-- Today's Activity -->
            <div class="form-section-header">
                <i class="fas fa-calendar-day"></i>
                <span>Today's Activity</span>
            </div>
            
            <div class="today-activity-grid">
                <div class="activity-metric">
                    <i class="fas fa-check-circle"></i>
                    <span id="todayCollectionsCount">0</span>
                    <small>Collections Today</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-road"></i>
                    <span id="todayDistance">0 km</span>
                    <small>Distance Covered</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-clock"></i>
                    <span id="todayWorkingTime">0h 0m</span>
                    <small>Working Time</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-star"></i>
                    <span id="todayEfficiency">100%</span>
                    <small>Efficiency</small>
                </div>
            </div>

            <!-- Recent Trips History -->
            <div class="form-section-header">
                <i class="fas fa-history"></i>
                <span>Recent Trips & Collections</span>
            </div>
            
            <div class="driver-trips-history" id="driverTripsHistory">
                <!-- Will be populated dynamically -->
            </div>

            <!-- Driver Performance Analysis -->
            <div class="form-section-header">
                <i class="fas fa-chart-bar"></i>
                <span>Driver Performance Analysis</span>
            </div>
            
            <div class="driver-performance-analysis">
                <!-- Performance Overview Cards - World-class layout -->
                <div class="performance-metrics-grid" id="performanceMetricsGrid">
                    <div class="performance-metric-card">
                        <div class="metric-icon efficiency">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="metric-content">
                            <h4>Efficiency Score</h4>
                            <div class="metric-value" id="driverEfficiencyScore">85%</div>
                            <div class="metric-trend positive" id="driverEfficiencyTrend">
                                <i class="fas fa-arrow-up"></i> +5% vs last week
                            </div>
                        </div>
                    </div>
                    
                    <div class="performance-metric-card">
                        <div class="metric-icon safety">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="metric-content">
                            <h4>Safety Score</h4>
                            <div class="metric-value" id="driverSafetyScore">92%</div>
                            <div class="metric-trend positive" id="driverSafetyTrend">
                                <i class="fas fa-check-circle"></i> Excellent
                            </div>
                        </div>
                    </div>
                    
                    <div class="performance-metric-card">
                        <div class="metric-icon punctuality">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="metric-content">
                            <h4>Punctuality</h4>
                            <div class="metric-value" id="driverPunctualityScore">88%</div>
                            <div class="metric-trend positive" id="driverPunctualityTrend">
                                <i class="fas fa-arrow-up"></i> On Time
                            </div>
                        </div>
                    </div>
                    
                    <div class="performance-metric-card">
                        <div class="metric-icon fuel">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                        <div class="metric-content">
                            <h4>Fuel Efficiency</h4>
                            <div class="metric-value" id="driverFuelEfficiency">7.2 L/100km</div>
                            <div class="metric-trend positive" id="driverFuelTrend">
                                <i class="fas fa-leaf"></i> Eco-friendly
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Single empty-state message (shown when driver has fewer than 3 collections) -->
                <div class="performance-metrics-empty-hint" id="performanceMetricsEmptyHint" aria-hidden="true" role="alert">
                    <i class="fas fa-chart-line"></i>
                    <span>Complete 3+ collections to see metrics. The scorecards above show N/A until then.</span>
                </div>
                
                <!-- Performance Chart with Enhanced Context -->
                <div class="performance-chart-section">
                    <div class="chart-header">
                        <h4>Performance Trends (Last 7 Days)</h4>
                        <div class="chart-header-right">
                            <span class="chart-summary-accuracy" id="driverAvgAccuracySummary" aria-label="Average accuracy for the period">â€”</span>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-dot" style="background: #3b82f6;"></span> Collections per Day</span>
                            </div>
                        </div>
                    </div>
                    <div class="driver-performance-chart-container">
                        <canvas id="driverPerformanceTrendChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- AI-Powered Insights -->
                <div class="performance-insights">
                    <div class="insights-header">
                        <i class="fas fa-brain"></i>
                        <h4>AI-Powered Insights & Recommendations</h4>
                    </div>
                    <div class="insights-list" id="driverPerformanceInsights">
                        <!-- AI insights will be populated here -->
                        <div class="insight-item positive">
                            <i class="fas fa-check-circle"></i>
                            <span>Analyzing driver performance patterns...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Benchmarking -->
                <div class="performance-benchmarking">
                    <h4><i class="fas fa-chart-line"></i> Performance vs Team Average</h4>
                    <div class="benchmark-bars">
                        <div class="benchmark-item">
                            <span class="benchmark-label">Collections per Day</span>
                            <div class="benchmark-bar-container">
                                <div class="benchmark-bar driver" id="benchmarkCollections" style="width: 85%;"></div>
                                <div class="benchmark-bar average" style="width: 70%; opacity: 0.3;"></div>
                            </div>
                            <span class="benchmark-value" id="benchmarkCollectionsValue">85% (+15%)</span>
                        </div>
                        
                        <div class="benchmark-item">
                            <span class="benchmark-label">Route Completion Rate</span>
                            <div class="benchmark-bar-container">
                                <div class="benchmark-bar driver" id="benchmarkCompletion" style="width: 92%;"></div>
                                <div class="benchmark-bar average" style="width: 88%; opacity: 0.3;"></div>
                            </div>
                            <span class="benchmark-value" id="benchmarkCompletionValue">92% (+4%)</span>
                        </div>
                        
                        <div class="benchmark-item">
                            <span class="benchmark-label">Customer Satisfaction</span>
                            <div class="benchmark-bar-container">
                                <div class="benchmark-bar driver" id="benchmarkSatisfaction" style="width: 88%;"></div>
                                <div class="benchmark-bar average" style="width: 85%; opacity: 0.3;"></div>
                            </div>
                            <span class="benchmark-value" id="benchmarkSatisfactionValue">88% (+3%)</span>
                        </div>
                    </div>
                    <div class="benchmark-legend">
                        <span><span class="legend-square driver"></span> This Driver</span>
                        <span><span class="legend-square average"></span> Team Average</span>
                    </div>
                </div>
            </div>

            <!-- ğŸ’¬ MANAGEMENT MESSAGING INTERFACE - Real-time Chat with Driver -->
            <div class="form-section-header">
                <h3><i class="fas fa-comments"></i> Driver Communication</h3>
                <p>Send messages and make calls to communicate with the driver in real-time</p>
            </div>
            
            <div class="management-messaging-system">
                <!-- Communication Header -->
                <div class="communication-header">
                    <div class="driver-online-status">
                        <div class="status-indicator online" id="driverOnlineStatus"></div>
                        <span id="driverOnlineText">Driver Online</span>
                        <small id="lastSeenTime">Last seen: Just now</small>
                    </div>
                    <div class="communication-actions">
                        <button type="button" class="comm-action-btn export-report" id="viewConversationReportBtn" onclick="typeof printDriverConversationReport==='function'&&printDriverConversationReport(true)" title="View driverâ€“manager audit report on this page">
                            <i class="fas fa-file-alt"></i>
                            <span>View Audit Report</span>
                        </button>
                        <button type="button" class="comm-action-btn export-report" onclick="printDriverConversationReport()" id="printConversationReportBtn" title="Print conversation for audit">
                            <i class="fas fa-print"></i>
                            <span>Print Report</span>
                        </button>
                        <button class="comm-action-btn call" onclick="callDriver()" id="callDriverBtn">
                            <i class="fas fa-phone"></i>
                            <span>Call Driver</span>
                        </button>
                        <button class="comm-action-btn video" onclick="startVideoCall()" id="videoCallBtn">
                            <i class="fas fa-video"></i>
                            <span>Video Call</span>
                        </button>
                    </div>
                </div>
                
                <!-- Messages History -->
                <div class="admin-messages-container" id="adminMessagesContainer">
                    <div class="messages-history" id="adminMessagesHistory">
                        <!-- Messages will be populated here -->
                        <div class="no-messages-state">
                            <i class="fas fa-comment-dots"></i>
                            <p>No messages yet</p>
                            <small>Start a conversation with the driver</small>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Message Input -->
                <div class="admin-message-input-container">
                    <div class="admin-message-input-wrapper">
                        <textarea id="adminMessageInput" 
                                  placeholder="Type your message to the driver..." 
                                  maxlength="1000"
                                  rows="3"
                                  autocomplete="off"></textarea>
                        <div class="admin-message-actions">
                            <button class="admin-tool-btn" onclick="attachFileToMessage()" title="Attach File">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="admin-tool-btn" onclick="sendLocationToDriver()" title="Send Location">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="admin-tool-btn priority" onclick="sendPriorityMessage()" title="Priority Message">
                                <i class="fas fa-star"></i>
                            </button>
                            <button class="admin-send-btn" onclick="sendAdminMessage()" id="adminSendBtn" disabled>
                                <i class="fas fa-paper-plane"></i>
                                Send
                            </button>
                        </div>
                    </div>
                    
                    <!-- Admin Quick Messages -->
                    <div class="admin-quick-messages">
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Please proceed to your next route')">
                            ğŸ“ Proceed to next route
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Emergency: Return to depot immediately')">
                            ğŸš¨ Return to depot
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Break approved - 30 minutes')">
                            â˜• Break approved
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Good job! Keep up the excellent work')">
                            ğŸ‘ Good job!
                        </button>
                    </div>
                </div>
                
                <!-- Message Statistics -->
                <div class="message-statistics">
                    <div class="stat-item">
                        <i class="fas fa-envelope"></i>
                        <span id="totalMessagesCount">0</span>
                        <label>Total Messages</label>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span id="avgResponseTime">-</span>
                        <label>Avg Response</label>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-phone"></i>
                        <span id="totalCallsCount">0</span>
                        <label>Total Calls</label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeDriverDetailsModal()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-success" onclick="refreshDriverDetailsModal()" title="Refresh driver data in real-time">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-primary" onclick="assignRouteToDriver(currentDriverDetailsId)">
                    <i class="fas fa-route"></i> Assign Route
                </button>
                <button class="btn btn-info" onclick="contactDriver()">
                    <i class="fas fa-phone"></i> Contact Driver
                </button>
                <button class="btn btn-warning" onclick="sendDriverMessage()">
                    <i class="fas fa-comment"></i> Send Message
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Route Assignment Modal -->
<div id="routeAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2><i class="fas fa-route"></i> Smart Route Assignment</h2>
            <span class="close" onclick="closeRouteAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Driver Information -->
            <div class="form-section-header">
                <i class="fas fa-user"></i>
                <span>Driver Information</span>
            </div>
            
            <div id="routeAssignmentDriverInfo" class="route-driver-info">
                <!-- Will be populated dynamically -->
            </div>

            <!-- AI Recommendations -->
            <div class="form-section-header">
                <i class="fas fa-brain"></i>
                <span>ğŸ¤– AI Recommendations</span>
            </div>
            
            <div class="ai-recommendations-section">
                <div class="ai-recommendation-header">
                    <div class="ai-brain-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="ai-text">
                        <p>Based on distance, fill levels, and priority, here are the smartest collection suggestions:</p>
                    </div>
                </div>
                
                <div id="aiRecommendedBins" class="recommended-bins-grid">
                    <!-- Will be populated with AI suggestions -->
                </div>
            </div>

            <!-- Available Bins -->
            <div class="form-section-header">
                <i class="fas fa-trash"></i>
                <span>All Available Bins</span>
            </div>
            
            <div class="bins-selection-container">
                <div class="search-filter-bar">
                    <input type="text" id="binSearchInput" placeholder="Search bins by ID or location..." class="form-input">
                    <select id="binFilterSelect" class="form-input">
                        <option value="all">All Bins</option>
                        <option value="high-priority">High Priority (>75%)</option>
                        <option value="medium-priority">Medium Priority (50-75%)</option>
                        <option value="low-priority">Low Priority (<50%)</option>
                    </select>
                </div>
                <!-- #8 Bulk actions toolbar -->
                <div id="bulkBinsToolbar" class="bulk-bins-toolbar" style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; margin-bottom: 0.75rem;">
                    <button type="button" class="btn btn-sm btn-secondary" id="bulkSelectAllBins" onclick="typeof selectAllBinsInList==='function'&&selectAllBinsInList()" style="padding: 0.4rem 0.75rem;"><i class="fas fa-check-double"></i> Select all</button>
                    <button type="button" class="btn btn-sm" id="bulkDeselectAllBins" onclick="typeof deselectAllBinsInList==='function'&&deselectAllBinsInList()" style="padding: 0.4rem 0.75rem; background: rgba(255,255,255,0.1); color: #94a3b8;">Deselect all</button>
                    <button type="button" class="btn btn-sm btn-secondary" id="bulkExportSelectedBins" onclick="typeof exportSelectedBinsCsv==='function'&&exportSelectedBinsCsv()" style="padding: 0.4rem 0.75rem;"><i class="fas fa-file-csv"></i> Export selected</button>
                    <span id="bulkSelectedCount" style="color: #94a3b8; font-size: 0.85rem; margin-left: 0.5rem;"></span>
                </div>
                
                <div id="availableBinsList" class="available-bins-list">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <!-- Selected Bins Summary -->
            <div class="form-section-header">
                <i class="fas fa-check-circle"></i>
                <span>Selected Route Summary</span>
            </div>
            
            <div class="selected-route-summary">
                <div class="route-metrics">
                    <div class="metric">
                        <i class="fas fa-trash"></i>
                        <span id="selectedBinsCount">0</span>
                        <small>Bins Selected</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-route"></i>
                        <span id="estimatedDistance">0 km</span>
                        <small>Total Distance</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-clock"></i>
                        <span id="estimatedTime">0 min</span>
                        <small>Estimated Time</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-gas-pump"></i>
                        <span id="estimatedFuel">0 L</span>
                        <small>Fuel Needed</small>
                    </div>
                </div>
                
                <div id="selectedBinsPreview" class="selected-bins-preview">
                    <p style="text-align: center; color: #94a3b8; padding: 2rem;">No bins selected yet. Choose from AI recommendations or browse all available bins above.</p>
                </div>
                <div id="selectedBinsList" class="selected-bins-list" style="margin-top: 0.75rem; max-height: 200px; overflow-y: auto;"></div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeRouteAssignmentModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-warning" onclick="clearSelectedBins()">
                    <i class="fas fa-eraser"></i> Clear Selection
                </button>
                <button class="btn btn-info" onclick="useAIRecommendations()">
                    <i class="fas fa-brain"></i> Use AI Suggestions
                </button>
                <button class="btn btn-success" onclick="confirmRouteAssignment()" id="confirmAssignmentBtn" disabled>
                    <i class="fas fa-check"></i> Assign Route
                </button>
            </div>
        </div>
        </div>
    </div>

    <!-- Application Scripts - Load in correct order with AI/ML Enhancement -->
    
    <!-- Production Logging - MUST BE FIRST to reduce console noise -->
    <script src="production-logging.js"></script>
    
    <!-- EMERGENCY FIX FOR LIVE MONITORING POPUP -->
    <script src="FIX_MONITORING_POPUP_IMMEDIATE.js"></script>
    
    <!-- NUCLEAR POPUP PROTECTION - DESTROYS ALL MICROSOFT POPUPS -->
    <script src="TEMP_POPUP_FIX.js"></script>
    <script src="SIMPLE_FIX_PREVENT_DUPLICATE_LOGIN.js"></script>
    <script src="force-hide-all-popups.js"></script>
    <script src="ultra-popup-blocker.js"></script>
    <script src="disable-microsoft-popup.js"></script>
    
    <!-- Wake-up Recovery System - Must load early to intercept timers -->
    <script src="wake-up-recovery.js"></script>
    
    <!-- Core System -->
    <script src="data-manager.js?v=20260206164500"></script>
    <script src="data-integrity-manager.js"></script>
    <script src="auth.js"></script>
    <script src="sync-manager.js?v=20260206170000"></script>
    
    <!-- Findy IoT Sensor Integration -->
    <script src="findy-client.js"></script>
    <script src="sensor-date-formatter.js"></script>
    <script src="sensor-status-manager.js"></script>
    <script src="realtime-status-notifier.js"></script>
    <script src="admin-buttons-worldclass.js"></script>
    <script src="admin-functions-test.js"></script>
    <script src="admin-button-fixer.js"></script>
    <script src="admin-complete-verification.js"></script>
    <script src="findy-bin-sensor-config-example.js"></script>
    <script src="findy-bin-sensor-integration.js"></script>
    <script src="findy-map-integration.js"></script>
    <script src="findy-driver-integration.js"></script>
    <script src="sensor-management-admin.js"></script>
    <script src="sensor-integration-enhanced.js"></script>
    <script src="add-sensor-menu-item.js"></script>
    <script src="force-refresh-bins-on-map.js"></script>
    <script src="map-initialization-fix.js"></script>
    <!-- map-bin-sensor-enhancement.js moved to load AFTER map-manager.js -->
    <script src="bin-sensor-diagnostic.js"></script>
    <script src="quick-add-sensor.js"></script>
    <script src="fix-bin-006-map-display.js"></script>
    <script src="force-save-bin-sensor-link.js"></script>
    
    <!-- ğŸ”§ Fix Driver Account Status -->
    <script src="FIX_DRIVER_ACCOUNT_STATUS.js"></script>
    
    <!-- Driver Performance Analysis Styles -->
    <link rel="stylesheet" href="driver-performance-analysis-styles.css">
    <link rel="stylesheet" href="driver-performance-ui-improvements.css">
    <link rel="stylesheet" href="driver-performance-layout-fix.css">
    
    <!-- FINAL ICON CENTER FIX - MUST LOAD LAST -->
    <link rel="stylesheet" href="FINAL_ICON_CENTER_FIX.css?v=2.1">
    
    <!-- Chart.js Error Prevention (Load Early) -->
    <script src="chartjs-error-fix.js"></script>
    <script src="chartjs-resize-error-fix.js"></script>
    <script src="enhanced-error-handler.js"></script>
    <script src="data-validation-fix.js"></script>
    
    <!-- AI/ML Engine Layer -->
    <script src="advanced-ai-engine.js"></script>
    <script src="predictive-analytics.js"></script>
    <script src="ml-route-optimizer.js"></script>
    <script src="intelligent-driver-assistant.js"></script>
    
    <!-- AI Integration Layer -->
    <script src="ai-driver-integration.js"></script>
    <script src="ai-integration-bridge.js"></script>
    
    <!-- Enhanced Analytics -->
    <script src="enhanced-analytics.js"></script>
    <script src="analytics-manager-v2.js"></script>
    <script src="analytics-worldclass-integration.js"></script>
    <script src="ai-chart-visualizer.js"></script>
    <script src="ai-analytics-integration.js"></script>
    <script src="ai-ml-master-integration.js"></script>
    <script src="verify-ai-connections.js"></script>
    
    <!-- Application Layer -->
    <script src="map-manager.js?v=5.0.0-worldclass"></script>
    <!-- ğŸš¨ CRITICAL: Resource Exhaustion Fix - MUST load immediately after map-manager -->
    <script src="CRITICAL_RESOURCE_EXHAUSTION_FIX.js"></script>
    <!-- ğŸ”§ FIX: Bin Popup Closing Issue -->
    <script src="FIX_BIN_POPUP_CLOSING.js"></script>
    <!-- ğŸ›°ï¸ ULTIMATE: Real GPS Fix - Nuclear option to force real GPS only -->
    <script src="ULTIMATE_REAL_GPS_FIX.js"></script>
    <!-- ğŸŒ WORLD-CLASS: Driver Location Display Fix - Shows exact location immediately on login -->
    <script src="WORLDCLASS_DRIVER_LOCATION_FIX.js"></script>
    <!-- ğŸ¯ FORCE: Always show exact coordinates on driver markers, never "Loading..." -->
    <script src="FORCE_DRIVER_LOCATION_DISPLAY.js"></script>
    <!-- ğŸ§¹ CLEANUP: Remove any 'Checking...' or 'Loading...' text from markers -->
    <script src="REMOVE_CHECKING_TEXT_FIX.js"></script>
    <!-- ğŸ¨ WORLD-CLASS: Premium driver marker UI design (3D, animated, professional) -->
    <script src="WORLDCLASS_DRIVER_MARKER_UI.js"></script>
    <!-- ğŸ”§ Bin popup enhancement - MUST load after map-manager.js -->
    <!-- TEMPORARILY DISABLED - Conflicts with FORCE_POPUP_FIX.js -->
    <!-- <script src="map-bin-sensor-enhancement.js?v=3.0.1"></script> -->
    <!-- ğŸŒ‰ Sensor-Bin-Map Bridge - Connect sensors to bins and map -->
    <script src="sensor-bin-map-bridge.js"></script>
    <!-- Note: findy-client.js already loaded above with other Findy scripts -->
    <script src="bin-modals.js"></script>
    <script src="driver-performance-analysis.js"></script>
    <script src="driver-system-v3.js?v=20260206190000"></script>
    
    <!-- ğŸŒŸ World-Class Driver & WebSocket Enhancement -->
    <script src="WORLDCLASS_DRIVER_WEBSOCKET_ENHANCEMENT.js"></script>
    
    <!-- ğŸ”§ Start Route Button Complete Fix -->
    <script src="START_ROUTE_BUTTON_FIX.js"></script>
    <script src="COMPLETE_START_ROUTE_FIX.js"></script>
    <!-- DISABLED: Duplicate driver system - causes race conditions and duplicate event handlers
    <script src="enhanced-driver-buttons-new.js"></script>
    -->
    <script src="websocket-manager.js?v=20260206164500"></script>
    <script src="messaging-system.js"></script>
    
    <!-- Enhanced Messaging System -->
    <script src="enhanced-messaging-system.js"></script>
    
    <script src="enterprise-fleet-core.js"></script>
    <!-- samsara-fleet-features.js removed - file does not exist -->
    <script src="worldclass-fleet-manager.js"></script>
    <script src="fleet-live-operations.js"></script>
    <script src="fleet-tabs-worldclass-enhancements.js"></script>
    <script src="MAPBOX_FLEET_MAP.js"></script>
    <script src="CLEAN_FLEET_MAP_VEHICLES_ONLY.js"></script>
    <script src="FLEET_PAGE_COMPLETE_CHECK.js"></script>
    <script src="FIX_FLEET_MAP_VIEWING.js"></script>
    <script src="number-formatter.js"></script>
    <script src="persistent-ui-fix.js"></script>
    <script src="deleted-bins-filter.js"></script>
    <script src="bin-deletion-listener.js"></script>
    <script src="realtime-update-broadcaster.js"></script>
    <script src="app.js?v=20260206165000"></script>
    <script src="driver-at-bin-collection-reminder.js"></script>
    <script src="auto-collection-test-helper.js"></script>
    <script src="event-handlers.js"></script>
    
    <!-- ğŸ¨ Enhanced Live Monitoring Features -->
    <script src="enhanced-live-monitoring.js"></script>
    
    <!-- ===== ENHANCED REAL-TIME STATUS MANAGEMENT ===== -->
    <!-- Fixes immediate status updates and visual map indicators -->
    <script src="enhanced-realtime-status-manager.js"></script>
    <!-- DISABLED: Duplicate driver system - causes race conditions and duplicate event handlers
    <script src="enhanced-driver-interface-v2.js"></script>
    -->
    <script src="enhanced-map-status-integration.js"></script>
    
    <!-- ===== INTEGRATION FIXES ===== -->
    <!-- World-class driver-main app integration with Update Coordinator -->
    <script src="UPDATE_COORDINATOR.js"></script>
    <script src="INTEGRATION_FIXES_IMPLEMENTATION.js"></script>
    
    <!-- ===== ENHANCED DRIVER SYSTEM COMPLETE ===== -->
    <!-- All buttons functional + GPS proximity-based auto-collection -->
    <script src="ENHANCED_DRIVER_SYSTEM_COMPLETE.js"></script>
    
    <!-- ===== DRIVER SYSTEMS COMPATIBILITY ===== -->
    <!-- Ensures both driver systems work together -->
    <script src="DRIVER_SYSTEMS_COMPATIBILITY_LAYER.js"></script>
    
    <!-- ===== CRITICAL DRIVER FIX ===== -->
    <!-- Fixes end route button and infinite waiting loop -->
    <script src="CRITICAL_DRIVER_FIX.js"></script>
    
    <!-- ===== FINAL DRIVER POLISH ===== -->
    <!-- Removes all remaining errors and warnings -->
    <script src="FINAL_DRIVER_POLISH.js"></script>
    
    <!-- ğŸš¨ EMERGENCY POPUP FIX v4.0 - MUST LOAD FIRST -->
    <script src="FORCE_POPUP_FIX.js"></script>
    
    <!-- ===== CRITICAL FIXES PATCH ===== -->
    <!-- Fixes driver popup, map emojis, and route optimization issues -->
    <script src="critical-fixes-patch.js"></script>
    <script src="debug-status-tester.js"></script>
    
    <!-- Driver Modal Chart Fix -->
    <script src="driver-modal-chart-fix.js"></script>
    <script src="driver-history-button-fix.js?v=20260206174500"></script>
    
    <!-- Enhanced AI Route Manager -->
    <script src="enhanced-ai-route-manager.js"></script>
    <script src="ai-route-testing.js"></script>

    <!-- Comprehensive Driver & Map Integration Fix -->
    <script>
        // Comprehensive System Integration and Initialization Fix
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ Starting COMPLETE system integration and fixes...');
            
            // Phase 1: Force critical system initialization
            function initializeCriticalSystems() {
                // Force data manager demo user creation
                if (window.dataManager) {
                    console.log('ğŸ”§ Force initializing demo users...');
                    window.dataManager.initializeDefaultData();
                    
                    // Verify users were created
                    const users = window.dataManager.getUsers();
                    console.log('âœ… Available users after initialization:', users.map(u => u.username + ' (' + u.type + ')'));
                    
                    if (users.length === 0) {
                        console.warn('âš ï¸ No users found, forcing creation...');
                        window.dataManager.setData('initialized', false);
                        window.dataManager.initializeDefaultData();
                    }
                }
                
                // Show demo account info to user
                setTimeout(() => {
                    const demoInfo = document.createElement('div');
                    demoInfo.id = 'demo-account-info';
                    demoInfo.style.cssText = `
                        position: fixed; 
                        top: 20px; 
                        right: 20px; 
                        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); 
                        color: white; 
                        padding: 15px 20px; 
                        border-radius: 10px; 
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3); 
                        z-index: 10001; 
                        max-width: 300px; 
                        font-size: 12px; 
                        line-height: 1.4;
                        font-family: system-ui;
                    `;
                    demoInfo.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 8px; color: #fbbf24;">ğŸ” Demo Accounts Available:</div>
                        <div><strong>Admin:</strong> admin / admin123</div>
                        <div><strong>Manager:</strong> manager1 / manager123</div>
                        <div><strong>Driver:</strong> driver1 / driver123</div>
                        <div><strong>Driver:</strong> driver2 / driver123</div>
                        <div style="margin-top: 8px; color: #94a3b8; font-size: 10px;">Click anywhere to dismiss</div>
                    `;
                    
                    demoInfo.onclick = () => demoInfo.remove();
                    document.body.appendChild(demoInfo);
                    
                    // Auto remove after 15 seconds
                    setTimeout(() => {
                        if (demoInfo.parentNode) demoInfo.remove();
                    }, 15000);
                }, 2000);
            }
            
            // Phase 2: Wait for all systems to be available
            function waitForSystems() {
                if (typeof window.mapManager !== 'undefined' && 
                    typeof window.enhancedDriverButtons !== 'undefined' && 
                    typeof window.authManager !== 'undefined' &&
                    typeof window.dataManager !== 'undefined') {
                    
                    console.log('âœ… All critical systems loaded, performing integration...');
                    
                    // Initialize critical systems
                    initializeCriticalSystems();
                    
                    // Phase 3: Enhanced Map Initialization - CRITICAL DIMENSION FORCING
                    setTimeout(() => {
                        console.log('ğŸ—ºï¸ Starting CRITICAL map dimension forcing...');
                        
                        // FORCE MAP CONTAINER DIMENSIONS AT MULTIPLE LEVELS
                        const mapContainer = document.getElementById('map');
                        const mapParent = mapContainer ? mapContainer.closest('.map-container') : null;
                        const contentSection = mapContainer ? mapContainer.closest('.content-section') : null;
                        
                        if (mapContainer) {
                            console.log('ğŸ”§ FORCING map container dimensions at ALL levels...');
                            
                            // Force parent container dimensions
                            if (mapParent) {
                                mapParent.style.cssText += `
                                    width: 100% !important; 
                                    height: 600px !important; 
                                    min-height: 600px !important;
                                    display: grid !important;
                                    position: absolute !important;
                                    top: -10000px !important;
                                    left: -10000px !important;
                                    visibility: hidden !important;
                                `;
                            }
                            
                            // Force content section to be present but hidden
                            if (contentSection) {
                                contentSection.style.cssText += `
                                    display: block !important;
                                    visibility: hidden !important;
                                    position: absolute !important;
                                    top: -10000px !important;
                                    left: -10000px !important;
                                `;
                            }
                            
                            // CRITICAL: Force map element dimensions
                            const originalStyle = mapContainer.style.cssText;
                            mapContainer.style.cssText = `
                                width: 800px !important; 
                                height: 600px !important; 
                                min-width: 800px !important;
                                min-height: 600px !important;
                                max-width: 800px !important;
                                max-height: 600px !important;
                                display: block !important; 
                                position: relative !important; 
                                visibility: hidden !important;
                                z-index: 1 !important;
                            `;
                            
                            // Wait for DOM to apply styles
                            setTimeout(() => {
                                // Verify dimensions are actually applied
                                const rect = mapContainer.getBoundingClientRect();
                                console.log('ğŸ” Map dimensions after forcing:', {
                                    width: rect.width,
                                    height: rect.height,
                                    computed: window.getComputedStyle(mapContainer)
                                });
                                
                                // Initialize map with VERIFIED dimensions
                                if (window.mapManager && !window.mapManager.map) {
                                    console.log('ğŸ—ºï¸ Initializing map with VERIFIED dimensions...');
                                    const mapInstance = window.mapManager.initializeMainMap('map');
                                
                                    if (mapInstance) {
                                        console.log('âœ… Map initialized successfully');
                                        
                                        // Restore original styling AFTER successful initialization
                                        setTimeout(() => {
                                            mapContainer.style.cssText = originalStyle;
                                            if (mapParent) mapParent.style.cssText = '';
                                            if (contentSection) contentSection.style.cssText = '';
                                            
                                            if (window.mapManager.map && typeof window.mapManager.map.invalidateSize === 'function') {
                                                window.mapManager.map.invalidateSize();
                                            }
                                        }, 200);
                                    } else {
                                        console.warn('âš ï¸ Map initialization failed, using fallback');
                                        mapContainer.style.cssText = originalStyle;
                                        if (mapParent) mapParent.style.cssText = '';
                                        if (contentSection) contentSection.style.cssText = '';
                                    }
                                }
                            }, 100); // End dimension verification timeout
                        }
                        
                        // Update driver count display
                        const activeDrivers = window.dataManager?.getDrivers?.() || [];
                        const driverCount = document.getElementById('activeDriverCount');
                        if (driverCount) {
                            driverCount.textContent = activeDrivers.length;
                            console.log(`ğŸ“Š Updated driver count display: ${activeDrivers.length}`);
                        }
                        
                        // Refresh driver buttons state
                        if (window.enhancedDriverButtons) {
                            window.enhancedDriverButtons.checkUserStatus();
                            console.log('ğŸ”„ Refreshed driver buttons state');
                        }
                        
                        // Final system health check
                        setTimeout(() => {
                            console.log('ğŸ” Final system health check...');
                            const systems = {
                                'Data Manager': !!window.dataManager,
                                'Map Manager': !!window.mapManager,
                                'Auth Manager': !!window.authManager,
                                'Enhanced Buttons': !!window.enhancedDriverButtons,
                                'Analytics Manager': !!window.analyticsManagerV2,
                                'AI Integration': !!window.aiIntegrationBridge
                            };
                            
                            console.table(systems);
                            console.log('âœ… COMPLETE system integration finished!');
                        }, 500);
                        
                    }, 1000);
                    
                } else {
                    // Reduce console spam - only log every 10 seconds
            if (!window.lastSystemLoadLog || Date.now() - window.lastSystemLoadLog > 10000) {
                console.log('â³ Waiting for critical systems to load...');
                window.lastSystemLoadLog = Date.now();
            }
                    setTimeout(waitForSystems, 100);
                }
            }
            
            // Start the initialization process
            waitForSystems();
        });
    </script>
    
    <!-- AI Integration Script -->
    <script>
        // Initialize AI integration after all components are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§  Initializing World-Class AI Integration...');
            
            // Wait for all AI components to be available
            setTimeout(() => {
                if (window.advancedAI && window.predictiveAnalytics && 
                    window.mlRouteOptimizer && window.intelligentDriverAssistant) {
                    
                    console.log('âœ… All AI components loaded successfully');
                    console.log('ğŸ¯ AI Capabilities:');
                    console.log('   - Advanced Route Optimization with ML');
                    console.log('   - Predictive Analytics & Forecasting');
                    console.log('   - Intelligent Driver Assistant');
                    console.log('   - Real-time Anomaly Detection');
                    console.log('   - Computer Vision Analytics');
                    console.log('   - Natural Language Processing');
                    console.log('   - Deep Learning Insights');
                    console.log('ğŸš€ World-Class Waste Management AI System Ready!');
                    
                    // Dispatch AI ready event
                    document.dispatchEvent(new CustomEvent('aiSystemReady', {
                        detail: {
                            components: ['advancedAI', 'predictiveAnalytics', 'mlRouteOptimizer', 'intelligentDriverAssistant'],
                            capabilities: [
                                'route_optimization', 'predictive_analytics', 'driver_assistance',
                                'anomaly_detection', 'computer_vision', 'nlp', 'deep_learning'
                            ]
                        }
                    }));
                    
                } else {
                    console.warn('âš ï¸ Some AI components failed to load, using fallback functionality');
                }
            }, 2000);
        });
    </script>

<!-- Bin Details Modal with 3D Visualization -->
<div id="binDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 1200px;">
        <div class="modal-header">
            <h2 id="modalBinTitle">Paper Bin Details</h2>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <button type="button" class="btn btn-primary btn-sm" onclick="typeof printBinDetailsReport==='function'&&printBinDetailsReport()" id="binDetailsPrintReportBtn" title="Print full bin report (history, chart, sensor)">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <span class="close" onclick="closeBinDetailsModal()">&times;</span>
            </div>
        </div>
        <div class="modal-body">
            <!-- Visual Bin Representation -->
            <div class="bin-visual-container">
                <div class="bin-3d-visual">
                    <div class="bin-3d">
                        <div class="bin-body">
                            <div class="bin-fill-level" id="binFillVisual">
                                <span id="fillPercentText">0%</span>
                                <span id="fillDistanceBadge" class="fill-distance-badge" style="display: none;" title="Ultrasonic distance to waste surface">ğŸ“ <span id="fillDistanceValue">â€”</span> cm</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="circular-progress">
                    <svg viewBox="0 0 200 200">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--primary);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:var(--primary-dark);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-circle-bg" cx="100" cy="100" r="80"/>
                        <circle class="progress-circle" id="progressCircle" cx="100" cy="100" r="80"
                                stroke-dasharray="502.4" stroke-dashoffset="502.4"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%;">
                        <div style="font-size: 2rem; font-weight: bold;" id="circularFillText">0%</div>
                        <div style="font-size: 0.875rem; color: #94a3b8;">Fill Level</div>
                        <div id="circularDistancePill" class="circular-distance-pill" style="display: none; margin-top: 0.5rem;" title="Ultrasonic: distance from sensor to waste surface">
                            <i class="fas fa-ruler-vertical" style="font-size: 0.7rem; opacity: 0.9;"></i>
                            <span id="circularDistanceValue">â€”</span> cm
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Prediction with Visual -->
            <div class="ai-prediction-container">
                <div class="ai-header">
                    <div class="ai-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0;">AI Prediction Engine</h3>
                        <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;">Machine Learning Analysis</p>
                    </div>
                </div>
                
                <div class="prediction-visual">
                    <div class="prediction-card">
                        <i class="fas fa-clock" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="timeToFull">--</div>
                        <div class="stat-label">Time to Full</div>
                    </div>
                    <div class="prediction-card">
                        <i class="fas fa-tachometer-alt" style="font-size: 2rem; color: var(--secondary); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="fillRate">--</div>
                        <div class="stat-label">Fill Rate/Hour</div>
                    </div>
                    <div class="prediction-card">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; color: var(--warning); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="optimalCollection">--</div>
                        <div class="stat-label">Optimal Collection</div>
                    </div>
                </div>
            </div>

            <!-- Sensor Information -->
            <div class="glass-card sensor-info-card">
                <h3 class="sensor-info-title">Sensor Information</h3>
                <div class="sensor-info-grid">
                    <div class="sensor-info-item sensor-info-item--name">
                        <i class="fas fa-microchip sensor-info-icon" aria-hidden="true"></i>
                        <div class="sensor-info-meta">
                            <span class="sensor-info-label">Sensor</span>
                            <span id="modalSensorName" class="sensor-info-value">â€”</span>
                        </div>
                    </div>
                    <div class="sensor-info-item" data-metric="battery">
                        <i class="fas fa-battery-three-quarters sensor-info-icon" aria-hidden="true"></i>
                        <div class="sensor-info-meta">
                            <span class="sensor-info-label">Battery</span>
                            <span id="modalBattery" class="sensor-info-value">â€”</span>
                        </div>
                    </div>
                    <div class="sensor-info-item">
                        <i class="fas fa-thermometer-half sensor-info-icon" aria-hidden="true"></i>
                        <div class="sensor-info-meta">
                            <span class="sensor-info-label">Temperature</span>
                            <span id="modalTemp" class="sensor-info-value">â€”</span>
                        </div>
                    </div>
                    <div class="sensor-info-item">
                        <i class="fas fa-tools sensor-info-icon" aria-hidden="true"></i>
                        <div class="sensor-info-meta">
                            <span class="sensor-info-label">Last report</span>
                            <span id="modalMaintenance" class="sensor-info-value">â€”</span>
                        </div>
                    </div>
                </div>
                <button type="button" class="sensor-history-charts-btn" onclick="showSensorHistoryChartsModal()" aria-label="View full sensor and fill history charts">
                    <i class="fas fa-chart-line"></i>
                    View full chart details
                </button>
            </div>

            <!-- Environmental Impact -->
            <div class="environmental-impact">
                <h3 style="margin-bottom: 1rem;">Environmental Impact</h3>
                <div class="impact-grid">
                    <div class="impact-item">
                        <div class="impact-icon">ğŸŒ³</div>
                        <div class="metric-value" id="treesEquivalent">0</div>
                        <div class="metric-label">Trees Saved</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">ğŸ’§</div>
                        <div class="metric-value" id="waterSaved">0 L</div>
                        <div class="metric-label">Water</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">âš¡</div>
                        <div class="metric-value" id="energySaved">0 kWh</div>
                        <div class="metric-label">Energy</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">ğŸŒ</div>
                        <div class="metric-value" id="co2Saved">0 kg</div>
                        <div class="metric-label">CO2</div>
                    </div>
                </div>
            </div>

            <!-- Collection Patterns & History -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem;">Collection Patterns</h3>
                <canvas id="binHistoryChart" style="max-height: 200px;"></canvas>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                <button class="btn btn-danger" onclick="showDriverAssignmentModal()">
                    <i class="fas fa-user-plus"></i>
                    Assign Driver
                </button>
                <button class="btn btn-primary" onclick="scheduleCollection()">
                    <i class="fas fa-calendar-plus"></i>
                    Schedule Collection
                </button>
                <button class="btn btn-success" onclick="markBinCollected(binModalManager.currentBin.id)">
                    <i class="fas fa-check"></i>
                    Mark as Collected
                </button>
                <button class="btn btn-info" onclick="showBinHistoryModal()">
                    <i class="fas fa-history"></i>
                    Bin History
                </button>
                <button class="btn btn-secondary" onclick="reportBinIssue()">
                    <i class="fas fa-exclamation-triangle"></i>
                    Report Issue
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Driver Assignment Modal -->
<div id="driverAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Assign Driver to Bin</h2>
            <span class="close" onclick="closeDriverAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Bin Info -->
            <div class="glass-card" style="background: rgba(0, 212, 255, 0.05);">
                <h3 style="margin-bottom: 1rem;">Bin Information</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-trash"></i>
                            <span id="assignBinId">Bin ID</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="assignBinLocation">Location</span>
                        </div>
                    </div>
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-percentage"></i>
                            <span id="assignBinFill">Fill Level</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="assignBinPriority">Priority</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendation -->
            <div id="aiRecommendation" class="recommendation-banner" style="display: none;">
                <i class="fas fa-lightbulb"></i>
                <span id="recommendationText"></span>
                <button class="btn btn-success btn-sm" onclick="quickAssignRecommended()">
                    <i class="fas fa-bolt"></i> Quick Assign
                </button>
            </div>

            <!-- Driver List -->
            <div class="glass-card" style="background: rgba(124, 58, 237, 0.05);">
                <h3 style="margin-bottom: 1rem;">Available Drivers</h3>
                <div id="driverAssignmentList" class="driver-assignment-list">
                    <!-- Drivers will be populated here -->
                </div>
            </div>

            <!-- Selected Driver Preview -->
            <div id="selectedDriverPreview" class="glass-card" style="background: rgba(16, 185, 129, 0.05); display: none;">
                <h3 style="margin-bottom: 1rem;">Selected Driver</h3>
                <div id="selectedDriverInfo">
                    <!-- Selected driver info will appear here -->
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="btn btn-success" onclick="confirmDriverAssignment()">
                        <i class="fas fa-check"></i> Confirm Assignment
                    </button>
                    <button class="btn btn-secondary" onclick="cancelDriverSelection()">
                        <i class="fas fa-times"></i> Cancel Selection
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Simple Route Assignment Modal (Legacy) -->
<div id="simpleRouteAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2>Assign Route to Driver</h2>
            <span class="close" onclick="closeSimpleRouteAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Driver Info -->
            <div class="glass-card" style="background: rgba(0, 212, 255, 0.05); margin-bottom: 1rem;">
                <h3 style="margin-bottom: 1rem;">Driver Information</h3>
                <div id="routeAssignmentDriverInfo">
                    <!-- Driver info will be populated here -->
                </div>
            </div>

            <!-- AI Recommendation -->
            <div id="routeAIRecommendation" class="recommendation-banner" style="display: none; margin-bottom: 1rem;">
                <i class="fas fa-lightbulb"></i>
                <span id="routeRecommendationText"></span>
                <button class="btn btn-success btn-sm" onclick="assignRecommendedBins()">
                    <i class="fas fa-bolt"></i> Assign All Recommended
                </button>
            </div>

            <!-- Available Bins -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem;">Available Bins for Collection</h3>
                <div id="availableBinsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Bins will be populated here -->
                </div>
            </div>

            <!-- Selected Bins -->
            <div class="glass-card" style="margin-top: 1rem;">
                <h3 style="margin-bottom: 1rem;">Selected Bins for Route</h3>
                <div id="simpleRouteSelectedBinsList">
                    <p style="text-align: center; color: #94a3b8;">No bins selected</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeSimpleRouteAssignmentModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="confirmSimpleRouteAssignment()">
                    <i class="fas fa-check"></i> Confirm Assignment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Sensor History Charts Modal (full fill, battery, temperature) -->
<div id="sensorHistoryChartsModal" class="modal sensor-charts-modal">
    <div class="modal-content">
        <div class="sensor-charts-header">
            <h2 class="sensor-charts-title">
                <i class="fas fa-chart-area"></i>
                Sensor & fill history
            </h2>
            <span class="close" onclick="closeSensorHistoryChartsModal()" aria-label="Close">&times;</span>
        </div>
        <div class="sensor-charts-body">
            <div class="sensor-chart-block" id="sensorChartBlockFill">
                <h4><i class="fas fa-fill-drip"></i> Bin fill level (%)</h4>
                <div class="chart-wrap"><canvas id="sensorHistoryChartFill"></canvas></div>
                <div id="sensorChartEmptyFill" class="sensor-chart-empty" style="display: none;">No fill history yet. Collections and sensor updates will appear here.</div>
            </div>
            <div class="sensor-chart-block" id="sensorChartBlockBattery">
                <h4><i class="fas fa-battery-three-quarters"></i> Battery (%)</h4>
                <div class="chart-wrap"><canvas id="sensorHistoryChartBattery"></canvas></div>
                <div id="sensorChartEmptyBattery" class="sensor-chart-empty" style="display: none;">No battery history yet. Current reading will appear as history is recorded.</div>
            </div>
            <div class="sensor-chart-block" id="sensorChartBlockTemp">
                <h4><i class="fas fa-thermometer-half"></i> Temperature (Â°C)</h4>
                <div class="chart-wrap"><canvas id="sensorHistoryChartTemp"></canvas></div>
                <div id="sensorChartEmptyTemp" class="sensor-chart-empty" style="display: none;">No temperature history yet. Current reading will appear as history is recorded.</div>
            </div>
        </div>
    </div>
</div>

<!-- Bin History Modal -->
<div id="binHistoryModal" class="modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <h2 style="margin: 0; color: #1e40af;">
                <i class="fas fa-history"></i>
                Bin Collection History
            </h2>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <button type="button" class="btn btn-primary btn-sm" onclick="printBinCollectionHistoryReport()" style="white-space: nowrap;">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <span class="close" onclick="closeBinHistoryModal()">&times;</span>
            </div>
        </div>
        
        <div style="padding: 2rem;">
            <!-- Bin Information Header -->
            <div id="binHistoryHeader" class="glass-card" style="margin-bottom: 1.5rem;">
                <!-- Will be populated dynamically -->
            </div>
            
            <!-- Collection History -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #059669;">
                    <i class="fas fa-trash-alt"></i> Collection History
                </h3>
                <div id="collectionHistoryList">
                    <p style="text-align: center; color: #94a3b8;">Loading collection history...</p>
                </div>
            </div>
            
            <!-- Sensor History -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #7c3aed;">
                    <i class="fas fa-chart-line"></i> Sensor History
                </h3>
                <div id="sensorHistoryList">
                    <p style="text-align: center; color: #94a3b8;">Loading sensor history...</p>
                </div>
            </div>
            
            <!-- History Chart -->
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #dc2626;">
                        <i class="fas fa-chart-area"></i> Fill Level Trends
                    </h3>
                    <button class="btn btn-sm btn-secondary" onclick="generateSampleBinTrend(binModalManager.currentBin.id)" style="font-size: 0.8rem;">
                        <i class="fas fa-flask"></i> Generate Sample Data
                    </button>
                </div>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 0.5rem; border-radius: 6px; margin-bottom: 1rem;">
                    <div style="display: flex; gap: 1rem; font-size: 0.8rem;">
                        <span style="color: #dc2626;"><i class="fas fa-circle"></i> Collections</span>
                        <span style="color: #f59e0b;"><i class="fas fa-circle"></i> Pre-Collection</span>
                        <span style="color: #10b981;"><i class="fas fa-circle"></i> Current Status</span>
                        <span style="color: #3b82f6;"><i class="fas fa-circle"></i> Sensor Readings</span>
                    </div>
                </div>
                <canvas id="binHistoryDetailChart" style="max-height: 350px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Driver History Modal -->
<div id="driverHistoryModal" class="modal driver-history-modal">
    <div class="modal-content driver-history-modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header driver-history-modal-header">
            <h2 class="driver-history-modal-title" style="margin: 0; color: #1e40af;">
                <i class="fas fa-user-clock"></i>
                My Collection History
            </h2>
            <span class="close driver-history-close" onclick="closeDriverHistoryModal()" aria-label="Close">&times;</span>
        </div>
        
        <div class="driver-history-modal-body" style="padding: 2rem;">
            <!-- Driver Stats Header -->
            <div id="driverHistoryHeader" class="glass-card driver-history-header" style="margin-bottom: 1.5rem;">
                <!-- Will be populated dynamically -->
            </div>
            
            <!-- Collection Timeline -->
            <div class="glass-card driver-history-section" style="margin-bottom: 1.5rem;">
                <h3 class="driver-history-section-title" style="margin-bottom: 1rem; color: #059669;">
                    <i class="fas fa-timeline"></i> Collection Timeline
                </h3>
                <div id="driverCollectionTimeline" class="driver-collection-timeline">
                    <p style="text-align: center; color: #94a3b8;">Loading collection timeline...</p>
                </div>
            </div>
            
            <!-- Route History -->
            <div class="glass-card driver-history-section" style="margin-bottom: 1.5rem;">
                <h3 class="driver-history-section-title" style="margin-bottom: 1rem; color: #7c3aed;">
                    <i class="fas fa-route"></i> Completed Routes
                </h3>
                <div id="driverRouteHistory" class="driver-route-history">
                    <p style="text-align: center; color: #94a3b8;">Loading route history...</p>
                </div>
            </div>
            
            <!-- Performance Chart -->
            <div class="glass-card driver-history-section driver-history-chart-wrap">
                <h3 class="driver-history-section-title" style="margin-bottom: 1rem; color: #dc2626;">
                    <i class="fas fa-chart-bar"></i> Performance Metrics
                </h3>
                <div class="driver-history-chart-container">
                    <canvas id="driverPerformanceChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="comprehensive-reporting-system.js?v=20260206181500"></script>
    <script src="demo-data-populator.js"></script>
    <script src="enhanced-analytics-dashboard.js"></script>
    <script src="report-ui-integration.js"></script>
    <script src="websocket-fix.js"></script>
    <script src="error-handler-fix.js"></script>
    
    <!-- Connection Verifier - Verifies all system connections on startup -->
    <script src="connection-verifier.js"></script>
    
    <!-- ğŸ”§ Manual Driver Marker Refresh Tool -->
    <script src="refreshDriverMarkers.js"></script>
    
    <!-- ğŸš€ Application Initialization Monitor -->
    <script>
        (function() {
            const loader = document.getElementById('app-loader');
            const loaderStatus = document.getElementById('loader-status');
            const loaderDetails = document.getElementById('loader-details');
            const loaderError = document.getElementById('loader-error');
            const loaderErrorMessage = document.getElementById('loader-error-message');
            
            let initStartTime = Date.now();
            let checkCount = 0;
            const maxWaitTime = 15000; // 15 seconds max wait
            
            // Update status messages
            function updateStatus(status, details) {
                if (loaderStatus) loaderStatus.textContent = status;
                if (loaderDetails) loaderDetails.textContent = details;
                console.log(`ğŸš€ Loader: ${status} - ${details}`);
            }
            
            // Show error
            function showError(message) {
                console.error('âŒ Initialization error:', message);
                if (loaderError) loaderError.style.display = 'block';
                if (loaderErrorMessage) loaderErrorMessage.textContent = message;
            }
            
            // Hide loader with fade out and ensure main UI is visible if user is logged in
            function hideLoader() {
                console.log('âœ… Application initialized successfully in', Date.now() - initStartTime, 'ms');
                if (loader) {
                    loader.style.transition = 'opacity 0.3s ease-out';
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                        loader.remove();
                        // If user is logged in, ensure main content is visible (fixes empty screen after load)
                        if (window.authManager && window.authManager.getCurrentUser()) {
                            const mainContainer = document.getElementById('mainContainer');
                            const mainNav = document.getElementById('mainNav');
                            const loginOverlay = document.getElementById('loginOverlay');
                            const dashboard = document.getElementById('dashboard');
                            if (loginOverlay) loginOverlay.style.display = 'none';
                            if (mainNav) mainNav.style.display = 'block';
                            if (mainContainer) {
                                mainContainer.style.display = 'block';
                                mainContainer.style.visibility = 'visible';
                                mainContainer.style.opacity = '1';
                            }
                            if (dashboard) {
                                dashboard.style.display = 'block';
                                dashboard.style.visibility = 'visible';
                            }
                            if (window.app && typeof window.app.refreshDashboard === 'function') {
                                setTimeout(function() { window.app.refreshDashboard(); }, 100);
                            }
                        }
                    }, 300);
                }
            }
            
            // Check if app is ready
            function checkAppReady() {
                checkCount++;
                const elapsed = Date.now() - initStartTime;
                
                // Timeout check
                if (elapsed > maxWaitTime) {
                    showError('Application took too long to initialize. Please refresh the page.');
                    return;
                }
                
                // Update progress message
                if (checkCount < 5) {
                    updateStatus('Loading dependencies...', 'Initializing core modules');
                } else if (checkCount < 10) {
                    updateStatus('Starting system...', 'Loading data managers');
                } else if (checkCount < 20) {
                    updateStatus('Connecting services...', 'Establishing real-time connections');
                } else {
                    updateStatus('Almost ready...', 'Finalizing initialization');
                }
                
                // Check for critical dependencies
                const hasDataManager = typeof window.dataManager !== 'undefined';
                const hasMapManager = typeof window.mapManager !== 'undefined';
                const hasApp = typeof window.app !== 'undefined';
                const hasSyncManager = typeof window.syncManager !== 'undefined';
                
                console.log(`ğŸ” Init check #${checkCount}: DataManager=${hasDataManager}, MapManager=${hasMapManager}, App=${hasApp}, SyncManager=${hasSyncManager}`);
                
                // Check if app is fully initialized
                if (hasApp && window.app) {
                    // Check if app has critical properties
                    const hasMapInstance = window.app.map || (window.mapManager && window.mapManager.map);
                    const hasDataLoaded = hasDataManager && window.dataManager.initialized;
                    
                    console.log(`ğŸ” App instance found. MapInstance=${!!hasMapInstance}, DataLoaded=${hasDataLoaded}`);
                    
                    if (hasMapInstance || hasDataLoaded || elapsed > 5000) {
                        // App is ready enough - hide loader
                        updateStatus('Ready!', 'Application loaded successfully');
                        setTimeout(hideLoader, 500);
                        return;
                    }
                }
                
                // Try again
                setTimeout(checkAppReady, 200);
            }
            
            // Start checking after a brief delay to let scripts start loading
            setTimeout(() => {
                console.log('ğŸš€ Starting application initialization monitor...');
                updateStatus('Loading system...', 'Please wait while we prepare your dashboard');
                checkAppReady();
            }, 100);
            
            // Emergency fallback - hide loader after 20 seconds no matter what
            setTimeout(() => {
                if (loader && loader.style.display !== 'none') {
                    console.warn('âš ï¸ Emergency loader hide after 20s timeout');
                    hideLoader();
                }
            }, 20000);
        })();
    </script>
</body>
</html>